(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8682],{54719:function(e,t,n){"use strict";n.r(t),n.d(t,{DO_NOT_IMPORT_ContextConnectorCitationCards:function(){return f},DO_NOT_IMPORT_ContextConnectorDocumentParser:function(){return S},DO_NOT_IMPORT_ContextConnectorPicker:function(){return F}});var r=n(86685),s=n(61888),a=n(82920),l=n(35805),i=n.n(l),o=n(93040),c=n(80615),u=n(80910),d=n(35250);function m(e){let t,{citationMetadata:n}=e;switch(n.text){case"Google Drive":t=c.Z.src;break;case"Google Docs":t=o.Z.src;break;case"Notion":t=u.Z.src;break;default:(0,a.ZP)(n.text)}return(0,d.jsx)("a",{href:n.url,target:"_blank",children:(0,d.jsxs)("div",{className:"flex flex-col gap-[2px] overflow-clip rounded-lg border border-gray-200 px-[16px] py-[12px]",children:[(0,d.jsxs)("div",{className:"flex items-center gap-2",children:[(0,d.jsx)(i(),{src:t,width:16,height:16,alt:n.text,className:"object-contain"}),(0,d.jsx)("p",{className:"pb-1 text-xs leading-normal text-token-text-secondary",children:n.text})]}),(0,d.jsx)("p",{className:"text-token -text-primary line-clamp-1 text-sm",children:n.title})]})})}let p=["Google Drive","Google Docs","Notion"];function h(e){if(!e)return!1;let{type:t,text:n}=e;return"webpage"===t&&p.includes(null!=n?n:"")}function f(e){let{messages:t}=e,n=(0,s.compact)(t.flatMap(e=>{var t,n;return null!==(t=null==e||null===(n=e.message)||void 0===n||null===(n=n.metadata)||void 0===n?void 0:n.citations)&&void 0!==t?t:[]}).flatMap(e=>e.metadata)),a=(0,s.uniqBy)(n.map(e=>(0,r.gP)(!0,e)).filter(h),e=>e.url);return(0,d.jsx)("div",{className:"mt-4 grid w-full grid-cols-[50%,50%] gap-3",children:a.map(e=>(0,d.jsx)(m,{citationMetadata:e},e.url))})}var g=n(49305),x=n(70079);let v="AIzaSyBjWFkxENpfA2b0Leq9VtNLumQs4u2VbkA",b=null;function j(e){return null==b&&(b=new Promise((e,t)=>{let n=document.createElement("script");n.src="https://apis.google.com/js/api.js",n.onload=e,n.onerror=t,document.documentElement.appendChild(n)}).then(()=>Promise.all([new Promise(e=>gapi.load("client",e)),new Promise(e=>gapi.load("client:picker",e))])).then(()=>(gapi.client.setToken({access_token:e}),gapi.client.init({apiKey:v,scope:"https://www.googleapis.com/auth/drive.file",discoveryDocs:["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"]})))),b}async function y(e){return await j(e),new Promise(t=>{async function n(e){switch(e.action){case google.picker.Action.PICKED:t(e.docs.map(e=>({connector:g.PO.GDRIVE,id:e.id,title:e.name,mimeType:e.mimeType,url:e.url})));break;case google.picker.Action.CANCEL:t(null)}}new google.picker.PickerBuilder().enableFeature(google.picker.Feature.MULTISELECT_ENABLED).enableFeature(google.picker.Feature.SUPPORT_DRIVES).setDeveloperKey(v).setAppId("77377267392").setOAuthToken(e).addView(new google.picker.DocsView(google.picker.ViewId.DOCS).setIncludeFolders(!0).setSelectFolderEnabled(!1).setMode(google.picker.DocsViewMode.LIST)).setCallback(n).build().setVisible(!0)})}async function w(e){let t=await gapi.client.drive.files.get({fileId:e,fields:"name,mimeType,webViewLink"});if(200!==t.status)return Promise.reject("HTTP ".concat(t.status," for ").concat(e));let{name:n,mimeType:r,webViewLink:s}=t.result;return{connector:g.PO.GDRIVE,id:e,title:null!=n?n:"",mimeType:null!=r?r:"",url:null!=s?s:""}}var A=n(53362),O=n(61236);function k(){let{0:e,1:t}=(0,x.useState)([]),n=(0,O.a)({queryKey:["fetchConnectorData"],queryFn:N});return(0,x.useEffect)(()=>{n.isSuccess&&t(n.data)},[n]),e}function N(e){let{queryKey:t}=e,[n]=t;return A.Z.checkConnectorAPI().then(e=>e.connectors.filter(_))}function _(e){return e.type===g.PO.GDRIVE}function S(e){let{inputValue:t,parsedDocumentHandler:n}=e,r=k();return(0,x.useEffect)(()=>{n(function(e,t){let n=[];for(let r of t){let{type:t,access_token:s}=r;if(null!=s)switch(t){case g.PO.GDRIVE:n.push(...function(e,t){return[...e.matchAll(P)].map(e=>({url:e[0],id:e[2],type:g.PO.GDRIVE,tryFetch:function(e,t){return async()=>(await j(t),w(e))}(e[2],t)}))}(e,s));case g.PO.O365:}}return n}(t,r))},[t,r,n]),null}let P=/\bhttps:\/\/docs\.google\.com\/(document|spreadsheets|presentation)\/d\/([\w-]+)\//gm;var E=n(29287),C=n(58819),D=n(14551),R=n(8718),M=n(36180),T=n(7137),Z=n(1454),L=n(9063),I=n(84692);function F(e){let{displayType:t,modelSupportedImageMimeTypes:r,attachmentsProductFeature:s}=e,a=k(),l=(0,L.Z)(),i=(0,x.useRef)(null),o=(0,x.useCallback)(()=>{i.current&&i.current.click()},[]),c=(0,x.useCallback)(()=>{var e;let t=null===(e=i.current)||void 0===e?void 0:e.files;Array.from(null!=t?t:[]).forEach(e=>(function(e){let{file:t,modelSupportedImageMimeTypes:n,intl:r,attachmentsProductFeature:s}=e;M.Dw.uploadFile((0,R.W7)(t),t,D.A.Retrieval,n,r,void 0,s)})({file:e,modelSupportedImageMimeTypes:r,attachmentsProductFeature:s,intl:l}))},[r,s,l]);return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("input",{type:"file",ref:i,onChange:c,className:"hidden"}),(0,d.jsxs)(C.Z.Root,{children:[(0,d.jsx)(C.Z.Trigger,{children:"button"===t?(0,d.jsx)(E.z,{size:"medium",children:(0,d.jsx)(Z.wzc,{})}):(0,d.jsx)(Z.OvN,{className:"icon-sm md:icon-md rounded-full bg-gray-500 text-white outline-none hover:bg-black"})}),(0,d.jsx)(C.Z.Portal,{children:(0,d.jsxs)(C.Z.Content,{children:[a.map(e=>(0,d.jsx)(C.Z.Item,{onClick:async()=>{let{access_token:t}=e;if(t){let n=await function(e,t){switch(e){case g.PO.GDRIVE:return y(t);case g.PO.O365:return Promise.resolve(null)}}(e.type,t);null!=n&&n.forEach(t=>{null!=t&&M.Dw.uploadConnectorFile(t.id,t.title,e.type,l)})}else{let{doOauthRedirect:t}=await Promise.resolve().then(n.bind(n,42405));t({id:e.id},"#settings")}},children:(0,d.jsxs)("div",{className:"flex space-x-2",children:[e.type===g.PO.GDRIVE&&(0,d.jsx)(T.dv9,{}),e.type===g.PO.O365&&(0,d.jsx)(T.oV6,{}),(0,d.jsx)("div",{children:e.access_token?l.formatMessage(U.uploadFromMessage,{connector_name:e.name}):l.formatMessage(U.signinWithMessage,{connector_name:e.name})})]})},e.id)),(0,d.jsx)(C.Z.Item,{onClick:o,children:(0,d.jsx)("div",{className:"flex space-x-2",children:(0,d.jsx)(I.Z,{id:"ContextConnectorPicker.uploadFile",defaultMessage:"Upload local file"})})},"upload")]})})]})]})}let U=(0,n(68498).vU)({signinWithMessage:{id:"ContextConnectorPicker.signInWithMessage",defaultMessage:"Sign in with {connector_name}"},uploadFromMessage:{id:"ContextConnectorPicker.uploadWithMessage",defaultMessage:"Upload from {connector_name}"}})},13888:function(e,t,n){"use strict";n.r(t),n.d(t,{ConversationTurnMessages:function(){return l},ConversationTurnName:function(){return a},ConversationTurnSender:function(){return s}});var r=n(35250);function s(e){let{isUserTurn:t,children:n}=e;return t?null:(0,r.jsx)(r.Fragment,{children:n})}function a(){return null}function l(e){let{isUserTurn:t,children:n}=e;return t?(0,r.jsx)("div",{className:"flex justify-end",children:(0,r.jsx)("div",{className:"max-w-[90%] rounded-3xl bg-token-main-surface-secondary px-5 py-2.5",children:n})}):(0,r.jsx)(r.Fragment,{children:n})}},70173:function(e,t,n){"use strict";n.r(t),n.d(t,{GizmosDropdownItems:function(){return R},HistoryPopover:function(){return D},ProfileDropdown:function(){return C}});var r=n(94079),s=n(41922),a=n(55837),l=n(58819),i=n(86263),o=n(5427),c=n(99392),u=n(9182),d=n(70187),m=n(72207),p=n(74346),h=n(89899),f=n(85062),g=n(2343),x=n(27550),v=n(27570),b=n(47712),j=n(63605),y=n(78253),w=n(99715),A=n(22189),O=n(96056),k=n(38801),N=n(67852),_=n(41409),S=n(84692),P=n(35250);function E(e){let{href:t,children:n,icon:r}=e,s=(0,_.useRouter)();return(0,P.jsx)(l.Z.Item,{icon:r,onSelect:()=>s.push(t),children:n})}function C(){let{data:e}=(0,b.rk)(),t=(0,b.t)(),{openSettings:n}=(0,v.Fr)();if(!t||!e)return null;let s=e.accountItems.length>1,a=t.isWorkspaceAccount();return(0,P.jsxs)(l.Z.Root,{children:[(0,P.jsx)(l.Z.Trigger,{className:"px-2",children:(0,P.jsx)(r.zf,{iconSize:"gizmoConversation"})}),(0,P.jsx)(l.Z.Portal,{children:(0,P.jsxs)(l.Z.Content,{collisionPadding:20,children:[s&&(0,P.jsx)(g.S,{menuItemComponent:l.Z.Item}),(0,P.jsx)(l.Z.Separator,{}),a?(0,P.jsx)(x.b,{menuItemComponent:l.Z.Item,routedMenuItemComponent:E}):(0,P.jsx)(f.W,{menuItemComponent:l.Z.Item}),(0,P.jsx)(l.Z.Item,{icon:d.RR,onClick:()=>n(),children:(0,P.jsx)(S.Z,{defaultMessage:"Settings",id:"navigation.settings.0"})}),(0,P.jsx)(l.Z.Separator,{}),(0,P.jsx)(l.Z.Item,{onClick:()=>{k.A.logEvent(N.M.clickLogOut,{eventSource:"mouse"}),(0,O.w7)()},icon:d.N_,children:(0,P.jsx)(S.Z,{defaultMessage:"Log out",id:"navigation.logOut.0"})})]})})]})}function D(e){let{clientThreadId:t}=e,n=(0,s.V_)(),r=(0,j.XK)(t);return(0,P.jsxs)(A.fC,{children:[(0,P.jsx)(A.xz,{className:"rounded-lg p-2 hover:bg-token-main-surface-secondary",children:(0,P.jsx)(i.Oqj,{className:"icon-md text-token-text-secondary"})}),(0,P.jsx)(A.h_,{children:(0,P.jsx)(A.VY,{sideOffset:10,collisionPadding:20,className:"max-h-[600px] max-w-xs overflow-auto rounded-xl border border-token-border-light bg-token-main-surface-primary pl-2 shadow-xl",children:(0,P.jsx)(a.Z,{activeId:n?void 0:r,isPrimaryBackgroundColor:!0})})})]})}function R(e){let{clientThreadId:t}=e,n=(0,j.eV)(t),r=(0,b.t)(),{listItems:s}=(0,p._f)(!1),a=(0,_.useRouter)();return null!=r&&r.canInteractWithGizmos?(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(h.Cl,{}),s.map(e=>{let{gizmo:r,section:s}=e;return(0,P.jsx)(M,{gizmo:r,section:s,clientThreadId:t,isActive:r.gizmo.id===n},r.gizmo.id)}),(0,P.jsx)(h.UA,{onSelect:()=>{a.push((0,y.cy)())},children:(0,P.jsxs)("div",{className:"flex items-center gap-3",children:[(0,P.jsx)(d.hk,{className:"icon-md"}),(0,P.jsx)(S.Z,{defaultMessage:"Explore GPTs",id:"navigation.exploreGPTs.0"})]})})]}):null}function M(e){let{gizmo:t,isActive:n,clientThreadId:r}=e,s=(0,_.useRouter)(),a=(0,P.jsxs)(h.tc,{$as:n?w.fF:w.Xi,className:"justify-between",onSelect:()=>s.push((0,u.m_)(t)),children:[(0,P.jsxs)("div",{className:"flex items-center gap-3",children:[(0,P.jsx)(o.Z,{src:t.gizmo.display.profile_picture_url,isFirstParty:!1,className:"icon-md flex-shrink-0"}),t.gizmo.display.name||c.zf]}),(0,P.jsxs)("div",{className:"flex items-center gap-2",children:[n&&(0,P.jsx)(i.nQG,{className:"icon-md"}),n&&(0,P.jsx)(i.ob9,{className:"icon-md text-token-text-tertiary"})]})]});return n?(0,P.jsxs)(w.Tr,{children:[a,(0,P.jsx)(w.Uv,{children:(0,P.jsx)(w.tu,{className:"mt-2 max-h-[calc(100vh-300px)] min-w-[100px] max-w-xs overflow-auto rounded-lg border border-token-border-light bg-token-main-surface-primary shadow-lg",sideOffset:-10,alignOffset:-15,children:(0,P.jsx)(m.ys,{gizmoResource:t,clientThreadId:r,showReportModal:function(){throw Error("Function not implemented.")}})})})]}):a}},98834:function(e,t,n){"use strict";n.r(t),n.d(t,{GizmoContactsEditor:function(){return v}});var r=n(18450),s=n(49305),a=n(5427),l=n(9182),i=n(10342),o=n(70187),c=n(89899),u=n(32870),d=n(67680),m=n(19841),p=n(70079),h=n(9063),f=n(35250);function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function x(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function v(e){var t,n,r;let{gizmoEditorData:a,updateGizmo:l}=e,o=null==a||null===(t=a.tools)||void 0===t?void 0:t.find(e=>e.type===s.qK.CONTACTS),{0:u,1:m}=(0,p.useState)(null!==(n=null==o||null===(r=o.settings)||void 0===r?void 0:r.contacts)&&void 0!==n?n:[]),{0:g,1:v}=(0,p.useState)(!1),j=(0,h.Z)(),y=e=>{l(t=>x(x({},t),{},{tools:o?t.tools.map(t=>t.type===s.qK.CONTACTS?x(x({},t),{},{settings:x(x({},t.settings),{},{contacts:e})}):t):[...t.tools,{type:s.qK.CONTACTS,settings:{contacts:e}}]}))};return(0,f.jsxs)(i.hj,{children:[g&&(0,f.jsx)(d.ZP,{onClick:e=>{null!=e&&e.gizmo.id&&(u.includes(e.gizmo.id)?m(u.filter(t=>t!==e.gizmo.id)):m([...u,e.gizmo.id]))},onClose:()=>{v(!1),y(u)}}),(0,f.jsx)(i.lX,{label:"Contacts",description:j.formatMessage({id:"gizmo.contactsExplanation",defaultMessage:"Other GPTs that this GPT can talk to."})}),(0,f.jsx)("div",{className:"mb-2 space-y-1",children:u.map((e,t)=>(0,f.jsx)(b,{gizmoId:e,onRemove:()=>{let t=u.filter(t=>t!==e);m(t),y(t)}},t))}),(0,f.jsx)(c.cY,{onClick:()=>v(!0),children:"Add Contact"})]})}function b(e){var t;let{gizmoId:n,onRemove:r}=e,{data:s}=(0,l.b9)(n),i=!!(null==s||null===(t=s.gizmo.tags)||void 0===t?void 0:t.includes(u.U9.FirstParty));return s?(0,f.jsxs)("div",{className:"flex w-full flex-row items-center justify-between rounded-lg bg-token-main-surface-secondary px-2",children:[(0,f.jsxs)("div",{className:(0,m.default)("group flex h-10 items-center gap-2 rounded-lg px-2 font-medium"),children:[(0,f.jsx)(a.Z,{isFirstParty:i,src:s.gizmo.display.profile_picture_url,className:"h-6 w-6 flex-shrink-0"}),(0,f.jsxs)("div",{className:"space-x-2 overflow-hidden text-ellipsis text-sm font-light text-token-text-secondary",children:[(0,f.jsx)("span",{className:"font-medium text-token-text-primary",children:s.gizmo.display.name}),(0,f.jsx)("span",{className:"flex-grow truncate text-sm font-light text-token-text-secondary sm:max-w-xs lg:max-w-md",children:s.gizmo.display.description})]})]}),(0,f.jsx)("button",{className:"text-sm font-bold",onClick:r,children:(0,f.jsx)(o.v7,{className:"icon-md text-token-text-secondary hover:text-token-text-primary"})})]}):null}},63577:function(e,t,n){"use strict";n.r(t),n.d(t,{GizmoRolodex:function(){return x}});var r=n(18450),s=n(5427),a=n(94063),l=n(67680),i=n(11655),o=n(61236),c=n(19841),u=n(70079),d=n(1454),m=n(84692),p=n(35250);function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let g=()=>(0,o.a)({queryKey:["gizmoRolodex"],queryFn:async()=>a.U.getRolodex()});function x(){let{0:e,1:t}=(0,u.useState)(!1),{0:n,1:r}=(0,u.useState)(null),{data:s}=g();return(0,p.jsxs)(i.ZR,{children:[(0,p.jsx)("div",{className:"mb-2",children:(0,p.jsx)(m.Z,{id:"personalizationSettings.rolodexLabel",defaultMessage:"Rolodex"})}),n?(0,p.jsx)("div",{className:"animate-slideDownAndFadeLong",children:(0,p.jsx)(b,f(f({},n),{},{onBack:()=>{r(null)}}))}):e?(0,p.jsx)("div",{className:"animate-slideDownAndFadeLong",children:(0,p.jsx)(l.ZP,{onClick:async e=>{null!=e&&e.gizmo.id&&(await a.U.upsertToRolodex({gizmoId:e.gizmo.id}),t(!1))},onClose:()=>{t(!1)}})}):(0,p.jsxs)("div",{role:"button",className:"grid grid-cols-3 items-center gap-1",children:[(null!=s?s:[]).map((e,t)=>(0,p.jsx)(v,{gizmo:e.gizmo,rolodex:e.rolodex,onClick:async()=>{r(e)}},t)),(null!=s?s:[]).length<3&&(0,p.jsx)(v,{onClick:()=>{t(!0)}})]})]})}function v(e){let{gizmo:t,rolodex:n,onClick:r}=e,{0:l,1:i}=(0,u.useState)(!1),o=null==n?void 0:n.is_rolodex;return(0,p.jsx)("div",{className:(0,c.default)("relative flex max-w-32 flex-col items-center space-y-1 rounded-xl font-medium",o?"border border-brand-green-800":"",l?"border border-token-border-heavy":""),onMouseOverCapture:()=>{i(!0)},onMouseOutCapture:()=>{i(!1)},children:l&&t?(0,p.jsxs)("div",{className:"flex items-center space-x-6 p-7",children:[o&&(0,p.jsx)(d.vPQ,{onClick:r,className:"icon-xl opacity-50 hover:opacity-100"}),o?(0,p.jsx)(d.faY,{onClick:async()=>{await a.U.upsertToRolodex({gizmoId:t.id,remove:!0})},className:"icon-xl opacity-50 hover:opacity-100"}):(0,p.jsx)(d.tUt,{onClick:async()=>{await a.U.upsertToRolodex({gizmoId:t.id})},className:"icon-xl opacity-50 hover:opacity-100"})]}):t?(0,p.jsx)(p.Fragment,{children:(0,p.jsxs)("div",{className:"flex flex-col items-center p-3 hover:opacity-50",children:[(0,p.jsx)(s.Z,{className:"mb-2 h-10 w-10",isFirstParty:!1,src:t.display.profile_picture_url}),(0,p.jsx)("div",{className:"truncate font-medium",children:t.display.name})]})}):(0,p.jsxs)("div",{className:"flex flex-col items-center p-5",children:[(0,p.jsx)(d.O9D,{className:"icon-lg mb-2"}),(0,p.jsx)("span",{children:(0,p.jsx)(m.Z,{id:"gizmoRolodex.emptyLabel",defaultMessage:"GPT"})})]})})}function b(e){var t;let{gizmo:n,rolodex:r,onBack:l}=e,{0:i,1:o}=(0,u.useState)(null!==(t=null==r?void 0:r.usage_description)&&void 0!==t?t:"");return(0,p.jsxs)("div",{className:"flex flex-col items-center p-3",children:[(0,p.jsx)(s.Z,{className:"mb-2 h-10 w-10",isFirstParty:!1,src:n.display.profile_picture_url}),(0,p.jsx)("div",{className:"truncate font-medium",children:n.display.name}),(0,p.jsx)("div",{className:"w-full",children:(0,p.jsx)("textarea",{rows:5,value:i,onChange:e=>o(e.target.value),placeholder:"When should your assistant talk to this GPT?",className:"m-2 w-full resize-none rounded bg-token-main-surface-secondary text-xs text-token-text-primary"})}),(0,p.jsxs)("div",{className:"mt-2 flex space-x-32",children:[(0,p.jsx)("div",{onClick:l,role:"button",children:(0,p.jsx)(d.YFh,{className:"icon-md"})}),(0,p.jsx)("div",{onClick:()=>{a.U.upsertToRolodex({gizmoId:n.id,usageDescription:i}),l()},role:"button",children:(0,p.jsx)(d.mW3,{className:"icon-md"})}),(0,p.jsx)("div",{onClick:async()=>{await a.U.upsertToRolodex({gizmoId:n.id,remove:!0}),l()},role:"button",children:(0,p.jsx)(d.Ybf,{className:"icon-md"})})]})]})}},94556:function(e,t,n){"use strict";n.r(t),n.d(t,{EditorEntryButton:function(){return ek},EditorModal:function(){return eN},EditorPageBody:function(){return e_}});var r,s=n(18450),a=n(99945),l=n(29287),i=n(11335),o=n(67217),c=n(70187),u=n(21643),d=n(30269),m=n(78103),p=n(51362);function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}let f={systemPrompt:"You are a helpful assistant.",userPrompt:"Make it better."},g=(0,m.ZP)((0,p.n)(()=>(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach(function(t){(0,s.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e})({},f))),x={setSystemPrompt:e=>{g.setState(t=>{t.systemPrompt=e})},setUserPrompt:e=>{g.setState(t=>{t.userPrompt=e})},setModel:e=>{g.setState(t=>{t.model=e})}};var v=n(25048),b=n(60581),j=n(99715),y=n(61888),w=n(70079),A=n(1454),O=n(35250);function k(){var e;let{0:t,1:n}=(0,w.useState)(!1),r=g(),s=(0,v.NX)(),a=async()=>{n(!0),await b.$.streamCompletion({completionRequest:r,onMessage:y.noop}),n(!1)};return(0,O.jsxs)("div",{className:"flex flex-col gap-2 p-2",children:[(0,O.jsxs)("div",{className:"flex flex-col space-y-1",children:[(0,O.jsx)("span",{children:"User Prompt"}),(0,O.jsx)(u.Z,{name:"userPrompt",placeholder:"Your prompt...",onChange:e=>{x.setUserPrompt(e.target.value)},value:r.userPrompt})]}),(0,O.jsxs)("div",{className:"flex flex-col space-y-1",children:[(0,O.jsx)("span",{children:"System Prompt"}),(0,O.jsx)(d.Z,{placeholder:"You are a helpful assistant",rows:8,onChange:e=>{x.setSystemPrompt(e.target.value)},value:r.systemPrompt})]}),(0,O.jsx)("div",{className:"self-start",children:(0,O.jsx)(N,{model:null!==(e=r.model)&&void 0!==e?e:"gpt-3.5-turbo",onChange:e=>{x.setModel(e)}})}),(0,O.jsx)(l.z,{loading:t,color:"primary",onClick:a,className:"max-w-xs grow-0",children:(0,O.jsx)(A.LbG,{className:"icon-sm"})}),(0,O.jsxs)("div",{className:"my-2 space-y-2 overflow-x-auto text-sm",children:[(0,O.jsx)("div",{children:"Last Request"}),(0,O.jsx)("pre",{className:"whitespace-pre-wrap",children:JSON.stringify(s.lastRequest,null,2)}),(0,O.jsx)("div",{children:"Last Response"}),(0,O.jsx)("pre",{className:"whitespace-pre-wrap",children:s.lastResponse.split("<br/>").map(e=>(0,O.jsxs)(O.Fragment,{children:[e,(0,O.jsx)("br",{})]}))})]})]})}function N(e){let{model:t,onChange:n}=e;return(0,O.jsxs)(j.fC,{children:[(0,O.jsx)(j.xz,{children:(0,O.jsx)("div",{role:"button",className:"rounded border-4 border-token-border-light px-4 py-2",children:t})}),(0,O.jsx)(j.Uv,{children:(0,O.jsxs)(j.VY,{sideOffset:7,children:[(0,O.jsx)(j.ck,{className:"border-2 bg-token-main-surface-tertiary px-4 py-2 hover:cursor-pointer hover:bg-token-main-surface-primary",onClick:()=>n("gpt-3.5-turbo"),children:"3.5T"}),(0,O.jsx)(j.ck,{className:"border-2 bg-token-main-surface-tertiary px-4 py-2 hover:cursor-pointer hover:bg-token-main-surface-primary",onClick:()=>n("gpt-4-turbo-preview"),children:"4T"})]})})]})}var _=n(55681),S=n(79134),P=n(3107),E=n.n(P);function C(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function D(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?C(Object(n),!0).forEach(function(t){(0,s.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):C(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let R=new S.V_({nodes:D(D({},_.fK.spec.nodes.toObject()),{},{generatedText:{inline:!0,group:"inline",content:"text*",attrs:{class:{default:"generated-text"}},parseDOM:[{tag:"span.generated-text"}],toDOM:()=>["span",{class:E()["generated-text"]},0]}}),marks:D({},_.fK.spec.marks.toObject())});function M(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function T(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?M(Object(n),!0).forEach(function(t){(0,s.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):M(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let Z=new _.xj(R,_.EU.tokenizer,T({},_.EU.tokens)),L=new _.nZ(T({},_.Dm.nodes),T({},_.Dm.marks));function I(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function F(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?I(Object(n),!0).forEach(function(t){(0,s.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):I(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let U={documentGoal:"",comments:[]},z=(0,m.ZP)((0,p.n)(()=>F({},U))),q={upsertComment:e=>{z.setState(t=>{let n=t.comments.findIndex(t=>t.id===e.id);-1===n?t.comments.push(e):t.comments[n]=F(F({},t.comments[n]),e)})},deleteComment:e=>{z.setState(t=>{t.comments=t.comments.filter(t=>t.id!==e)})},editGoal:e=>{z.setState(t=>{t.documentGoal=e})}};function V(e,t){let{original:n}=e,r=null;return t.doc.descendants((e,t)=>{if(r)return!1;if(e.text){let s=e.text.indexOf(n);if(-1!==s){let e=t+s,a=e+n.length;return r={from:e,to:a},!1}}}),r}function Q(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function B(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Q(Object(n),!0).forEach(function(t){(0,s.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Q(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let G=async(e,t,n,r)=>{let s,a="",{from:l}=e.state.selection,i=e.state.selection.content(),o=i.content.textBetween(0,i.content.size);try{await b.$.streamCompletion({completionRequest:B(B({},function(e){let{fullContent:t,selectedContent:n,completion:r}=e;return{systemPrompt:r.systemPrompt,userPrompt:"Here is the full draft:\n".concat(t,'\n\nThis is the text that is currently selected: "').concat(n,'"\n\nI want to rewrite the selected text with this guidance: ').concat(r.userPrompt,"\n\nRespond with the plain rewritten text without quotes, nothing else.")}}({fullContent:e.state.doc.textContent,selectedContent:o,completion:t})),{},{model:t.model}),onMessage:t=>{var n,r;let i=e.state.tr;0===a.length&&i.deleteSelection(),a+=t;let o=l+(null!==(n=null===(r=s)||void 0===r?void 0:r.nodeSize)&&void 0!==n?n:0);s=R.nodes.generatedText.create({},R.text(a)),i.replaceRangeWith(l,o,s),e.dispatch(i)}}),n(o,a)}catch(e){r(e)}};var H=n(25494),K=n(8844);function W(e){let{comment:t,onAccept:n,onReject:r}=e;return(0,O.jsxs)("div",{className:"relative flex max-w-sm flex-col space-y-2 rounded-lg border border-token-border-heavy bg-token-sidebar-surface-secondary p-4 drop-shadow-lg",children:[t.rationale&&(0,O.jsx)("div",{className:"overflow-ellipsis break-words text-xs font-bold",children:(0,O.jsxs)("span",{className:"font-medium",children:["Rationale: ",t.rationale]})}),(0,O.jsxs)("div",{className:"line-clamp-2 overflow-ellipsis break-words text-sm italic hover:line-clamp-none hover:overflow-visible",children:[(0,O.jsx)("span",{className:"font-medium",children:t.author}),"\xa0",'replaced "'.concat(t.original,'"')]}),(0,O.jsx)("p",{className:"text-sm",children:t.completion}),(0,O.jsxs)("div",{className:"flex space-x-2",children:[(0,O.jsx)("div",{role:"button",className:"text-xs text-token-text-secondary hover:underline",onClick:r,children:(0,O.jsx)(A.q5L,{className:"icon-sm"})}),(0,O.jsx)("div",{role:"button",className:"text-xs text-brand-green hover:underline",onClick:n,children:(0,O.jsx)(A.UgA,{className:"icon-sm"})})]})]},t.id)}function X(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function Y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?X(Object(n),!0).forEach(function(t){(0,s.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):X(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function J(e){let{getCurrentView:t}=e,n=z(),r=g(),s=(0,H.D)({mutationFn:e=>b.$.syncCompletion({completionRequest:e}),onSuccess:e=>{e.comments.forEach(e=>q.upsertComment({id:(0,K.Z)(),author:"Jidori",original:e.originalText,completion:e.replacementText,rationale:e.rationale,type:e.type}))}});return(0,O.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,O.jsx)(d.Z,{value:n.documentGoal,name:"document-goal",className:"rounded-md text-sm",onChange:e=>{q.editGoal(e.target.value)}}),(0,O.jsx)("div",{className:"mb-10 w-full space-y-2",children:n.comments.map(e=>(0,O.jsx)(W,{comment:e,onAccept:()=>{let n=t();n&&function(e,t){q.deleteComment(e.id);let n=V(e,t.state);if(!n)return;let r="delete"===e.type?t.state.tr.delete(n.from,n.to):t.state.tr.replaceWith(n.from,n.to,t.state.schema.text(e.completion));t.dispatch(r)}(e,n)},onReject:()=>{let n=t();n&&function(e,t){q.deleteComment(e.id);let n=V(e,t.state);if(!n)return;let r=t.state.tr.replaceWith(n.from,n.to,t.state.schema.text(e.original));t.dispatch(r)}(e,n)}},e.id))}),(0,O.jsxs)("div",{className:"absolute bottom-0 z-10 flex w-1/4 space-x-2 rounded-xl px-2",children:[(0,O.jsx)(u.Z,{value:r.userPrompt,onChange:e=>{x.setUserPrompt(e.target.value)},name:"prompt-jidori",color:"search",className:"grow bg-token-sidebar-surface-tertiary py-2.5 opacity-100"}),(0,O.jsx)(l.z,{color:"primary",className:"my-auto grow-0",loading:s.isPending,onClick:async()=>{var e,a,l;let i=null===(e=t())||void 0===e?void 0:e.state.doc;if(!i)return;let o=r.userPrompt,c=(a=n.documentGoal,l=L.serialize(i,{tightLists:!0}),{system:"You are an expert writer editing a draft of a piece of writing. The goal of this document is: ".concat(a,"\nCurrently, you are tasked with this job: ").concat(o,'\n\nThe document is written in markdown. Do not edit the markdown formatting, only make changes to the text itself. If no changes are required in a section of the document, leave it alone.\nComments can be either edits or deletions of existing material. Your response should be a list of comments in JSON format with the following structure:\n{\n  comments: {\n    type: "delete" | "edit" (if delete, leave replacementText empty);\n    rationale: "string (explain the rationale behind the edit in a few words or short phrase)";\n    originalText: "string (the original string verbatim in plaintext)";\n    replacementText: "string (your suggested string in plaintext)";\n  }[]\n}\n\nReturn a list of comment objects in JSON as you edit the user\'s rough draft, pointing out issues and suggesting improvements. Here is the draft:'),user:l});await s.mutateAsync(Y(Y({},r),{},{userPrompt:c.user,systemPrompt:c.system}))},children:(0,O.jsx)(A.LbG,{className:"icon-sm"})})]})]})}var $=n(85452),ee=n(95407);function et(e){let{visible:t,style:n,toggleBold:r,toggleItalic:s,view:a,onHide:l}=e,{0:i,1:o}=(0,w.useState)(!1),c=g();if(!t)return null;let u=(e,t)=>{o(!1),l(),q.upsertComment({id:(0,K.Z)(),completion:t,original:e,author:"Jidori"})};return(0,O.jsxs)("div",{style:n,className:"absolute flex items-center rounded-lg border border-token-border-heavy bg-token-sidebar-surface-secondary text-sm font-medium text-token-text-primary drop-shadow-md",children:[(0,O.jsx)("div",{role:"button",onClick:r,className:"border-r border-token-border-light p-2",children:"Bold"}),(0,O.jsx)("div",{role:"button",onClick:s,className:"border-l border-token-border-light p-2",children:"Italic"}),(0,O.jsx)("div",{role:"button",onClick:()=>{o(!0),G(a,c,u,e=>{ee.m.danger("Error replacing selection",e),o(!1)})},className:"border-l border-token-border-light p-2",children:i?(0,O.jsx)($.Z,{}):"Replace"})]})}var en=n(71307),er=n(60314);let es=(0,en.S0)(/^\s*([-+*])\s$/,R.nodes.bullet_list),ea=(0,en.S0)(/^\s*>\s$/,R.nodes.blockquote),el=(0,en.zK)(/^```$/,R.nodes.code_block),ei=(0,en.zK)(/^#\s$/,R.nodes.heading,()=>({level:1})),eo=(0,en.zK)(/^##\s$/,R.nodes.heading,()=>({level:2})),ec=(0,en.zK)(/^###\s$/,R.nodes.heading,()=>({level:3})),eu=new en.VK(/^---$/,(e,t,n,r)=>{let{tr:s}=e;if(t){let e=R.nodes.paragraph.create(),t=R.nodes.horizontal_rule.create();s.replaceWith(n-1,r,S.HY.from([t,e]));let a=s.mapping.map(r+1);s.setSelection(er.Bs.near(s.doc.resolve(a)))}return s}),ed=(0,en.Hw)({rules:[es,ea,el,ei,eo,ec,eu]});var em=n(12498),ep=n(81093);let eh={"Mod-z":ep.Yw,"Mod-y":ep.KX,"Mod-b":(0,em.w9)(R.marks.strong),"Mod-i":(0,em.w9)(R.marks.em)};var ef=n(56637);let eg=new er.H$("highlight"),ex=new er.Sy({key:eg,state:{init:()=>ef.EH.empty,apply:(e,t,n,r)=>{let s=e.getMeta(eg);if(s&&s.length>0){let e=[];return s.forEach(t=>{let n=V(t,r);if(!n)return;let s=ef.p.inline(n.from,n.to,{class:"delete"===t.type?E()["highlighted-delete"]:E()["highlighted-edit"]});e.push(s)}),ef.EH.create(r.doc,e)}return t.map(e.mapping,e.doc)}},props:{decorations(e){return this.getState(e)}}});var ev=n(19841),eb=n(18004),ej=n(88488),ey=n(84692);function ew(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function eA(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ew(Object(n),!0).forEach(function(t){(0,s.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ew(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let eO=n(21389).Z.button(r||(r=(0,a.Z)(["p-1 rounded-md text-token-text-tertiary hover:text-token-text-primary md:invisible md:group-hover:visible md:group-[.final-completion]:visible"])));function ek(e){let{onClick:t}=e;return(0,O.jsx)(i.u,{label:(0,O.jsx)(ey.Z,{id:"ConversationTurn.openEditorTooltip",defaultMessage:"Open in Editor"}),sideOffset:0,children:(0,O.jsx)(eO,{onClick:t,children:(0,O.jsx)(c.eu,{className:"icon-md"})})})}function eN(e){let{userMessage:t,assistantMessage:n,onClose:r}=e;if(!n||"text"!==n.content.content_type||0===n.content.parts.length)return null;let s="";t&&"text"===t.content.content_type&&t.content.parts.length>0&&(s=t.content.parts.join(""));let a=n.content.parts.join("");return(0,O.jsx)(o.Z,{type:"success",size:"custom",className:"max-w-7xl",isOpen:!0,onClose:r,primaryButton:(0,O.jsx)(l.z,{color:"primary",onClick:y.noop,children:"Save"}),secondaryButton:(0,O.jsx)(l.z,{color:"neutral",onClick:r,children:"Cancel"}),children:(0,O.jsx)(e_,{documentGoal:s,initialContent:a,classNames:"h-[80vh]"})})}function e_(e){let{documentGoal:t,initialContent:n,classNames:r}=e,s=(0,w.useRef)(null),{0:a,1:l}=(0,w.useState)(!1);return(0,w.useEffect)(()=>{let e=e=>{"9"===e.key&&(e.metaKey||e.ctrlKey)&&(e.preventDefault(),l(e=>!e))};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[]),(0,O.jsxs)("div",{className:(0,ev.default)("relative grid grid-flow-row grid-cols-8 overflow-y-auto",r),children:[(0,O.jsx)("div",{className:"no-scrollbar col-span-6 overflow-y-auto rounded-lg p-8",children:(0,O.jsx)(eS,{ref:s,init:{initialContent:n,documentGoal:t}})}),(0,O.jsx)("div",{className:"col-span-2 mt-8 flex flex-col overflow-y-auto px-2",children:a?(0,O.jsx)(k,{}):(0,O.jsx)(J,{getCurrentView:()=>{var e;return null===(e=s.current)||void 0===e?void 0:e.getCurrentView()}})})]})}let eS=(0,w.forwardRef)((e,t)=>{let{init:n}=e,r=(0,w.useRef)(null),{0:s,1:a}=(0,w.useState)(null),{0:l,1:i}=(0,w.useState)(!1),{0:o,1:c}=(0,w.useState)({}),u=(0,w.useCallback)(()=>{if(!s)return;let{anchor:e,head:t}=s.state.selection,n=r.current.getBoundingClientRect();if(e!==t){let e=s.coordsAtPos(t),r=Math.max(0,e.top-n.top-10),a=e.left-n.left;c({top:"".concat(r,"px"),left:"".concat(a,"px")}),i(!0)}else i(!1)},[s]);return(0,w.useEffect)(()=>{if(s)return s.dom.addEventListener("mouseup",u),s.dom.addEventListener("keyup",u),()=>{s.dom.removeEventListener("mouseup",u),s.dom.removeEventListener("keyup",u)}},[s,u]),(0,w.useImperativeHandle)(t,()=>({getCurrentView:()=>s||null})),(0,w.useEffect)(()=>{q.editGoal(n.documentGoal)},[]),(0,w.useEffect)(()=>{if(!r.current)return;let e=er.yy.create({schema:R,doc:(e=>{if(e&&0!==e.length)return Z.parse(e)})(n.initialContent),plugins:[(0,ep.m8)(),ed,(0,ej.h)(eA(eA({},em.YR),eh)),ex]}),t=new ef.tk(r.current,{state:e,attributes:{class:E()["jidori-editor"]}});return(0,eb.Z)(t),t.focus(),a(t),()=>{t.destroy()}},[n]),window.editor=s,!function(e){let t=z();(0,w.useEffect)(()=>{if(!e||0===t.comments.length)return;let n=e.state.tr.setMeta(eg,t.comments);e.dispatch(n)},[e,t.comments])}(s),(0,O.jsxs)("div",{className:"w-full",children:[(0,O.jsx)(et,{visible:l,style:o,toggleBold:()=>{s&&((0,em.w9)(R.marks.strong)(s.state,s.dispatch),s.focus())},toggleItalic:()=>{s&&((0,em.w9)(R.marks.em)(s.state,s.dispatch),s.focus())},onHide:()=>i(!1),view:s}),(0,O.jsx)("div",{className:(0,ev.default)("w-full cursor-text overflow-y-auto text-token-text-primary caret-token-text-primary"),ref:r})]})});eS.displayName="Editor"},80928:function(e,t,n){"use strict";n.r(t),n.d(t,{JidoriPromptControls:function(){return w}});var r,s=n(18450),a=n(99945),l=n(58819),i=n(29287),o=n(21643),c=n(30269),u=n(67217),d=n(70079),m=n(35250);function p(e){let{theme:t,onSave:n,onClose:r,onDelete:s}=e,{0:a,1:l}=(0,d.useState)(t.examples),{0:p,1:h}=(0,d.useState)(t.name);return(0,m.jsx)(u.Z,{type:"success",size:"custom",className:"max-w-4xl",isOpen:!0,onClose:r,title:"Editing theme: ".concat(p),hideSeparator:!0,showCloseButton:!0,primaryButton:(0,m.jsx)(i.z,{color:"primary",onClick:()=>{n({id:t.id,name:p,examples:a}),r()},children:"Save"}),secondaryButton:t.id?(0,m.jsx)(i.z,{color:"neutral",onClick:()=>{s(t.id),r()},children:"Delete"}):null,children:(0,m.jsxs)("div",{className:"m-8 mt-0 flex flex-col gap-2",children:[(0,m.jsx)("span",{children:"Name"}),(0,m.jsx)(o.Z,{name:"theme-name",type:"text",value:p,onChange:e=>h(e.target.value)}),(0,m.jsx)("span",{children:"Examples"}),(0,m.jsx)("div",{className:"flex flex-col gap-4",children:[...a,""].map((e,t)=>(0,m.jsx)(c.Z,{rows:5,value:e,onChange:e=>{let n=[...a];n[t]=e.target.value,l(n)}},t))})]})})}var h=n(60581),f=n(82473),g=n(25494),x=n(61236),v=n(1454);function b(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function j(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?b(Object(n),!0).forEach(function(t){(0,s.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let y=n(21389).Z.div(r||(r=(0,a.Z)(["py-1 bg-token-main-surface-primary rounded-md border border-token-border-light text-xs font-medium text-token-text-tertiary hover:bg-token-main-surface-secondary hover:text-token-text-primary px-2.5 radix-state-open:bg-token-main-surface-secondary radix-state-open:text-token-text-primary"])));function w(e){let{setPromptMetadataValue:t}=e,{data:n}=(0,x.a)({queryKey:["jidoriSettings"],queryFn:async()=>h.$.getSettings()}),{data:r}=(0,x.a)({queryKey:["jidoriThemes"],queryFn:async()=>h.$.getThemes()}),s=function(){let e=(0,f.NL)();return(0,g.D)({mutationFn:e=>h.$.postSettings(e),onSuccess:()=>{e.refetchQueries({queryKey:["jidoriSettings"]})}})}(),a=function(){let e=(0,f.NL)();return(0,g.D)({mutationFn:e=>h.$.postThemes(e),onSuccess:()=>{e.refetchQueries({queryKey:["jidoriThemes"]})}})}(),l=function(){let e=(0,f.NL)();return(0,g.D)({mutationFn:e=>h.$.deleteTheme(e),onSuccess:()=>{e.refetchQueries({queryKey:["jidoriThemes"]})}})}(),{0:i,1:o}=(0,d.useState)(null);return(0,d.useEffect)(()=>{n&&t(e=>j(j({},e),{},{jidori:j(j({},e.jidori),{},{language:n.language.value,length:n.length.value})}))},[n,t]),n?(0,m.jsx)("div",{className:"flex justify-between bg-gradient-to-t from-token-main-surface-primary to-transparent px-4 pb-3.5",children:(0,m.jsxs)("div",{className:"flex gap-2",children:[[n.language,n.length].map((e,n)=>(0,m.jsx)(O,{setting:e,onClick:async n=>{s.mutate({[e.type]:n}),t(t=>j(j({},t),{},{jidori:j(j({},t.jidori),{},{[e.type]:n})}))}},n)),r&&(0,m.jsx)(A,{themes:r,currentTheme:i,addTheme:e=>{a.mutate(e)},deleteTheme:e=>{l.mutate(e)},onClick:e=>{o(e),t(t=>j(j({},t),{},{jidori:j(j({},t.jidori),{},{theme:e.examples})}))}})]})}):null}function A(e){let{onClick:t,currentTheme:n,addTheme:r,deleteTheme:s,themes:a}=e,{0:i,1:o}=(0,d.useState)(!1),{0:c,1:u}=(0,d.useState)(null);return(0,m.jsxs)(l.Z.Root,{children:[(0,m.jsxs)(y,{$as:l.Z.Trigger,className:"pr-1.5",children:[n?n.name:"Themes",(0,m.jsx)(v.bTu,{})]}),(0,m.jsx)(l.Z.Portal,{children:(0,m.jsxs)(l.Z.Content,{side:"top",children:[a.map((e,n)=>(0,m.jsxs)(l.Z.Item,{className:"flex justify-between px-4",children:[(0,m.jsx)("div",{className:"grow",onClick:()=>t(e),children:e.name}),(0,m.jsx)("span",{className:"grow-0",onClick:()=>{u(e),o(!0)},children:(0,m.jsx)(v.vPQ,{className:"icon-sm"})})]},n)),(0,m.jsx)(l.Z.Item,{onClick:()=>{o(!0)},className:"px-4",children:"New Theme"})]})}),i&&(0,m.jsx)(p,{theme:null!=c?c:{examples:[],name:""},onSave:e=>{r(e)},onClose:()=>{o(!1)},onDelete:e=>{s(e)}})]})}function O(e){let{onClick:t,setting:n}=e;return(0,m.jsxs)(l.Z.Root,{children:[(0,m.jsxs)(y,{$as:l.Z.Trigger,className:"pr-1.5",children:[n.value?n.value:n.display_name,(0,m.jsx)(v.bTu,{})]}),(0,m.jsx)(l.Z.Portal,{children:(0,m.jsx)(l.Z.Content,{side:"top",children:n.options.map((e,n)=>(0,m.jsx)(l.Z.Item,{onClick:()=>t(e.value),children:e.value},n))})})]})}},25048:function(e,t,n){"use strict";n.d(t,{NX:function(){return o},q$:function(){return c}});var r=n(18450),s=n(51362),a=n(78103);function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}let i={lastRequest:{},lastResponse:""},o=(0,a.ZP)((0,s.n)(()=>(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e})({},i))),c={setLastRequest:e=>{o.setState(t=>{t.lastRequest=e})},setLastResponse:e=>{o.setState(t=>{t.lastResponse=e})},appendToResponse:e=>{o.setState(t=>{t.lastResponse+=e})}}},60581:function(e,t,n){"use strict";n.d(t,{$:function(){return u}});var r=n(18450),s=n(25048),a=n(4466),l=n(48879);function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let c="https://jidori.g1.internal.services.openai.org";class u{static healthcheck(){return a.c.get("".concat(c,"/api/completion"))}static async streamCompletion(e){let{completionRequest:t,onMessage:n}=e;s.q$.setLastRequest(t),s.q$.setLastResponse(""),await (0,l.L)("".concat(c,"/api/completion"),{method:"POST",headers:o({"Content-Type":"application/json",Accept:"text/event-stream",Connection:"keep-alive"},await a.c.getAuthedHeaders()),body:JSON.stringify({system_prompt:t.systemPrompt,user_prompt:t.userPrompt,model:t.model}),credentials:"include",onmessage(e){s.q$.appendToResponse(e.data),n(e.data)},onclose(){console.log("Connection closed by the server")},onerror(e){throw console.log("There was an error from server",e),e}})}static async getSettings(){return a.c.get("".concat(c,"/api/settings"))}static async syncCompletion(e){let{completionRequest:t}=e;s.q$.setLastRequest(t),s.q$.setLastResponse("");let n=await a.c.post("".concat(c,"/api/completion/lr"),{system_prompt:t.systemPrompt,user_prompt:t.userPrompt,model:t.model});return s.q$.setLastResponse(JSON.stringify(n.message,null,2)),n.message}static async postSettings(e){let{language:t,length:n}=e;return a.c.post("".concat(c,"/api/settings"),{language:t,length:n})}static async getThemes(){return a.c.get("".concat(c,"/api/settings/themes"))}static async postThemes(e){return a.c.post("".concat(c,"/api/settings/themes"),o({},e))}static async deleteTheme(e){return a.c.delete("".concat(c,"/api/settings/themes/").concat(e))}}},57670:function(e,t,n){"use strict";n.d(t,{e:function(){return t7}});var r,s,a,l,i,o,c,u,d,m,p,h,f,g,x,v,b,j=n(99945),y=n(73606),w=n(19841),A=n(21389),O=n(94079),k=n(58819),N=n(86263),_=n(70187),S=n(85252),P=n(41409),E=n(1454),C=n(67217),D=n(35805),R=n.n(D),M=n(70079),T={src:"https://cdn.oaistatic.com/_next/static/media/popup-blocked.a4e77057.png",height:40,width:118,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAADCAMAAACZFr56AAAAFVBMVEXx8/nq7PL8/P+7vsS+wcfe4enV2OEVeXw2AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAHklEQVR4nGNgZGQAQSYGZmZWFgZmNiYGRkYGBpAIAAIUACasMdr/AAAAAElFTkSuQmCC",blurWidth:8,blurHeight:3};function Z(){return(Z=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var L=e=>M.createElement("svg",Z({xmlns:"http://www.w3.org/2000/svg",width:24,height:24,fill:"none",viewBox:"0 0 24 24"},e),s||(s=M.createElement("path",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19.5 8V5.5a2 2 0 0 0-2-2h-11a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2H9"})),a||(a=M.createElement("circle",{cx:16,cy:16,r:4,stroke:"currentColor",strokeWidth:2})),l||(l=M.createElement("path",{stroke:"currentColor",strokeLinecap:"round",strokeWidth:2,d:"m19 19 2 2"}))),I=n(35250);function F(e){let{query:t}=e,n=(0,M.useRef)({}),{0:r,1:s}=(0,M.useState)(!1);function a(e,t){let r="compare_".concat(e),a=n.current[r];a&&(a.close(),delete n.current[r]);let l=Math.max(window.outerWidth/2,500),i=Math.max(window.outerHeight-300,500),o=window.screenY+300,c=window.screenX+e*l;(a=n.current[r]=window.open(t,r,"width=".concat(l,",height=").concat(i,",top=").concat(o,",left=").concat(c)))||s(!0)}return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)(z,{onClick:()=>{a(0,"https://google.com/search?q=".concat(t)),a(1,"https://perplexity.ai/search?q=".concat(t))},children:[(0,I.jsx)(L,{className:"icon-sm stroke-[3]"})," Compare"]}),r&&(0,I.jsx)(C.Z,{isOpen:!0,type:"danger",onClose:()=>s(!1),title:"Popup Blocked",description:(0,I.jsxs)("div",{children:["Your browser is blocking popups. Please allow popups for this site and try again.",(0,I.jsxs)("div",{className:"mt-3 text-xs",children:[(0,I.jsx)(R(),{className:"mx-auto",src:T,alt:"Popup blocked screenshot"}),"In Chrome, this setting can be accessed by clicking on the button in the locations bar (the left-most button in the image above)."]})]})})]})}var U=n(68399);let z=(0,A.Z)(k.Z.Item)(i||(i=(0,j.Z)(["flex items-center gap-2"])));function q(){let{theme:e,setTheme:t}=(0,S.F)();switch(e){case"system":return(0,I.jsxs)(z,{onClick:e=>{e.preventDefault(),t("dark")},children:[(0,I.jsx)(E.Y1U,{className:"stroke-[3]"}),"System Theme"]});case"dark":return(0,I.jsxs)(z,{onClick:e=>{e.preventDefault(),t("light")},children:[(0,I.jsx)(E.wOW,{className:"stroke-[3]"}),"Dark Mode"]});default:return(0,I.jsxs)(z,{onClick:e=>{e.preventDefault(),t("system")},children:[(0,I.jsx)(E.kXG,{className:"stroke-[3]"}),"Light"]})}}function V(e){let{className:t,iconSize:n,searchQuery:r}=e,s=(0,P.useRouter)();return(0,I.jsxs)(k.Z.Root,{children:[(0,I.jsx)(k.Z.Trigger,{className:"hover:bg-transparent! border-0 p-0",children:(0,I.jsx)(O.zf,{iconSize:n,className:t})}),(0,I.jsx)(k.Z.Portal,{children:(0,I.jsxs)(k.Z.Content,{collisionPadding:10,children:[(0,I.jsx)(q,{}),(0,I.jsxs)(z,{onClick:()=>U.vm.toggleDebugModalOpen(),children:[(0,I.jsx)(_.WP,{className:"icon-sm"}),"Debug"]}),(0,I.jsxs)(z,{onClick:()=>U.vm.toggleSettingsModalOpen(),children:[(0,I.jsx)(N.KAl,{className:"icon-sm"}),"Settings"]}),(0,I.jsx)(F,{query:r}),(0,I.jsx)(k.Z.Separator,{}),(0,I.jsxs)(z,{onClick:()=>s.push("/auth/logout",void 0,{shallow:!0}),children:[(0,I.jsx)(_.N_,{className:"icon-sm"}),"Log out"]})]})})]})}var Q=n(77799),B=n(83737);function G(){return(G=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var H=e=>M.createElement("svg",G({xmlns:"http://www.w3.org/2000/svg",width:22,height:22,fill:"none",viewBox:"0 0 22 22"},e),o||(o=M.createElement("g",{id:"arrow-send"},M.createElement("path",{id:"vector",fill:"currentcolor",fillRule:"evenodd",d:"M16.813 10.387a.867.867 0 0 1 0 1.226l-4.333 4.333a.867.867 0 0 1-1.226-1.226l2.854-2.853H5.8a.867.867 0 1 1 0-1.734h8.308L11.254 7.28a.867.867 0 0 1 1.226-1.226z",clipRule:"evenodd"}))));function K(e){let{currentQuery:t,onUpdateCurrentQuery:n,onSubmit:r}=e,s=(0,M.useRef)(null),a=(0,M.useRef)(null),{0:l,1:i}=(0,M.useState)("60%");(0,M.useEffect)(()=>{let e=s.current,t=a.current;if(!e||!t)return;let n=t.style.width,r=e.style.width;t.style.width="60%",e.style.width="100%",i(e.scrollWidth>e.clientWidth?"100%":"60%"),t.style.width=n,e.style.width=r},[t]);let o=(0,M.useCallback)(e=>{"Enter"===e.key&&r&&(e.preventDefault(),r(t))},[r,t]);return(0,M.useEffect)(()=>(0,Q.eR)(document,{keydown:e=>{e.metaKey&&"k"===e.key&&s.current&&(e.preventDefault(),s.current.focus())}}),[s]),(0,I.jsxs)(B.E.div,{className:"peer relative",initial:{width:"60%"},animate:{width:l},transition:{duration:.1},ref:a,children:[(0,I.jsx)("input",{type:"text",name:"query",id:"query",className:"peer w-full text-ellipsis rounded-full border-0 bg-token-main-surface-tertiary py-3 pl-12 pr-14 placeholder-gray-500 outline-none focus:border-token-border-medium focus:ring-0",value:t,autoComplete:"off",spellCheck:!1,onKeyDown:o,ref:s,onChange:e=>n(e.target.value)}),r&&(0,I.jsx)("button",{onClick:()=>null==r?void 0:r(t),className:(0,w.default)("absolute right-3 top-1/2 flex h-7 w-7 -translate-y-1/2 items-center justify-center rounded-full bg-gray-300 text-token-main-surface-tertiary hover:bg-token-border-light hover:text-token-text-secondary peer-focus:bg-token-text-primary peer-focus:text-token-main-surface-primary peer-focus:hover:opacity-80 dark:bg-gray-700"),children:(0,I.jsx)(H,{className:"icon-lg-heavy"})}),(0,I.jsx)("div",{className:"absolute left-5 top-1/2 -translate-y-1/2",children:(0,I.jsx)(E.jRj,{})})]})}var W=n(75388),X=n(15118),Y=n(45062),J=n(19216),$=n(78375);function ee(e){return"fatal_system_error"===e.execution_status}function et(e){return"title"in e&&"string"==typeof e.title&&"url"in e&&"string"==typeof e.url}function en(e){return"url"in e&&"string"==typeof e.url&&"content_url"in e&&"string"==typeof e.content_url}let er=(0,M.forwardRef)(function(e,t){let{readyState:n,hasSubmittedInitialQuery:r,currentQuery:s,onUpdateCurrentQuery:a,onSubmit:l}=e,i=(0,J.nn)(J.LW.firstTurn),o=null!=i&&ee(i),c=n!==X.kQ.OPEN||!s||o;return(0,I.jsx)(Y.X,{className:"snc-accent-border",disabled:o,autoFocus:!r,value:s,onChange:e=>{a(e.target.value)},onSubmit:()=>!c&&l(s),ref:t,keyEventFilter:e=>"u"===e.key&&e.metaKey,hint:"⌘U",placeholder:"Ask a follow-up...",buttonIcon:(0,I.jsx)(N.WmV,{className:"icon-lg-heavy"}),overflowDirection:"up"})});var es=n(18450),ea=n(11335);function el(e){let{label:t,labelSide:n="right",className:r,onClick:s,children:a}=e;return(0,I.jsx)(ea.E,{label:t,sideOffset:0,side:n,disabled:!t,children:(0,I.jsx)("button",{onClick:s,className:(0,w.default)("flex items-center justify-center p-1.5 text-token-text-tertiary hover:text-token-text-primary",r),children:a})})}function ei(){return(ei=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var eo=e=>M.createElement("svg",ei({xmlns:"http://www.w3.org/2000/svg",width:24,height:24,fill:"none",viewBox:"0 0 24 24"},e),c||(c=M.createElement("g",{id:"map-pin",stroke:"currentcolor",strokeWidth:2},M.createElement("path",{id:"Ellipse 32766",strokeLinecap:"round",strokeLinejoin:"round",d:"M20 11c0 6.329-8 10.5-8 10.5S4 17.28 4 11c0-4.57 3.582-8 8-8"}),M.createElement("circle",{id:"Ellipse 32767",cx:12,cy:11,r:3}),M.createElement("path",{id:"Vector 2883",strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 2 21 6.5M21 2l-4.5 4.5"}))));function ec(){return(ec=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var eu=e=>M.createElement("svg",ec({xmlns:"http://www.w3.org/2000/svg",width:24,height:24,fill:"none",viewBox:"0 0 24 24"},e),u||(u=M.createElement("g",{id:"map-pin",stroke:"currentcolor",strokeWidth:2},M.createElement("path",{id:"Ellipse 32766",strokeLinecap:"round",strokeLinejoin:"round",d:"M20 11c0 6.329-8 10.5-8 10.5S4 17.28 4 11c0-4.57 3.582-8 8-8"}),M.createElement("circle",{id:"Ellipse 32767",cx:12,cy:11,r:3}),M.createElement("path",{id:"Vector 2884",strokeLinecap:"round",strokeLinejoin:"round",d:"M16 5.095 17.667 7 21 2"})))),ed=n(90240);function em(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function ep(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?em(Object(n),!0).forEach(function(t){(0,es.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):em(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function eh(e){let{settings:t,onUpdateSettings:n}=e,{setTheme:r,resolvedTheme:s}=(0,S.F)();return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(el,{label:"Debug Modal (Internal)",onClick:()=>U.vm.toggleDebugModalOpen(),children:(0,I.jsx)(_.WP,{className:"icon-lg-heavy"})}),(0,I.jsx)(el,{label:t.useLocation?"Disable location services":"Enable location services",onClick:()=>{n(ep(ep({},t),{},{useLocation:!t.useLocation})),t.useLocation||(0,ed.XB)(!0)},children:t.useLocation?(0,I.jsx)(eu,{className:"icon-lg-heavy"}):(0,I.jsx)(eo,{className:"icon-lg-heavy"})}),(0,I.jsxs)(el,{label:"Set theme to ".concat("dark"===s?"light":"dark"),onClick:()=>{r("dark"===s?"light":"dark")},children:["dark"===s&&(0,I.jsx)(N.NWY,{className:"icon-lg-heavy"}),"light"===s&&(0,I.jsx)(N.kLh,{className:"icon-lg-heavy"})]}),(0,I.jsx)(el,{label:"Search Settings",onClick:()=>U.vm.toggleSettingsModalOpen(),children:(0,I.jsx)(N.KAl,{className:"icon-lg-heavy"})})]})}var ef=n(67739),eg=n(61082),ex=n(58734),ev=n(78253),eb=n(5099),ej=n(61888),ey=n(35601),ew=n(19323),eA=n.n(ew),eO=n(49593),ek=n(81479),eN=n(69920),e_=n(83216);function eS(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function eP(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?eS(Object(n),!0).forEach(function(t){(0,es.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eS(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let eE={calculator:"Calculator",finance:"Finance",news:"News","sports-schedule":"Sports Schedule","sports-standings":"Sports Standings","time-difference":"Timezone",weather:"Weather"},eC={turn:{thumbsDown:[{label:"Too verbose",group:"Response"},{label:"Not enough information",group:"Response"},{label:"Inaccurate",group:"Response"},{label:"Subject ambiguity",group:"Response"},{label:"Location issue",group:"Response"},{label:"Bad search results",group:"Response"},{label:"Bad response",group:"Response"},{label:"Issue with followup",group:"Response",match:e=>{var t;return(null!==(t=e.index)&&void 0!==t?t:0)>0}},...Object.keys(eE).map(function(e){return{label:"No ".concat(eE[e]," widget"),group:"Widget",match:t=>{var n;return(null===(n=(0,$.K)(t))||void 0===n?void 0:n.type)!==e}}}),{label:e=>"Shouldn't show ".concat(eE[(0,$.K)(e).type]," widget"),group:"Widget",match:e=>!!(0,$.K)(e)},{label:e=>"Issue with ".concat(eE[(0,$.K)(e).type]," widget"),group:"Widget",match:e=>!!(0,$.K)(e)}],thumbsUp:[{label:"Accurate",value:"Accurate"},{label:"Up-to-date",value:"Up-to-date"},{label:"Good search results",value:"Good search results"},{label:e=>"Like the ".concat(eE[(0,$.K)(e).type]," widget"),match:e=>!!(0,$.K)(e)}]},link:{thumbsDown:[{label:"Not relevant",value:"Not relevant"},{label:"Out-of-date",value:"Out-of-date"},{label:"Ranked too high",value:"Ranked too high"},{label:"Ranked too low",value:"Ranked too low"},{label:"Bad source",value:"Bad source"}],thumbsUp:[{label:"Relevant",value:"Relevant"},{label:"Up-to-date",value:"Up-to-date"},{label:"Ranked appropriately",value:"Ranked appropriately"},{label:"Good source",value:"Good source"}]}};async function eD(e){var t;let n=null!==(t=e.element)&&void 0!==t?t:document.getElementById("__next"),r=await eA()(n,{backgroundColor:e.isDarkMode?null:"#ffffff"}),s=document.createElement("canvas"),a=s.getContext("2d"),l=r.height/r.width*1440;return s.width=1440,s.height=l,null==a||a.drawImage(r,0,0,1440,l),new Promise(e=>{s.toBlob(t=>{e(t)},"image/jpeg",.8)})}function eR(e){let{onSubmit:t,turn:n,thumbsUpTooltip:r,thumbsDownTooltip:s,screenshotElement:a,type:l}=e,{0:i,1:o}=(0,M.useState)(null),{0:c,1:u}=(0,M.useState)(null),d=(0,eN.Gv)();return(0,I.jsxs)("div",{onClick:e=>{e.preventDefault(),e.stopPropagation()},children:[(0,I.jsx)("div",{className:"flex items-center gap-2",children:[{tooltip:null!=r?r:"Good",rating:"thumbsUp",Icon:_.ib,FilledIcon:_.go},{tooltip:null!=s?s:"Bad",rating:"thumbsDown",Icon:_.Q7,FilledIcon:_.W2}].map(e=>{let{tooltip:t,rating:n,Icon:r,FilledIcon:s}=e;return(0,I.jsx)(ea.u,{label:t,sideOffset:0,className:"flex",children:(0,I.jsx)("button",{className:"block text-token-text-secondary hover:text-token-text-primary",onClick:async()=>{o(await eD({element:a,isDarkMode:d})),u(n)},disabled:c===n,children:c===n?(0,I.jsx)(s,{className:"h-4 w-4"}):(0,I.jsx)(r,{className:"h-4 w-4"})})},n)})}),c&&(0,I.jsx)(ek.Z,{multiple:!0,onSubmit:e=>t(eP(eP({},e),{},{screenshot:i,currentRating:c})),onCancel:()=>{o(null),u(null)},tagOptions:function(e){let{type:t,turn:n,rating:r}=e;return eC[t][r].filter(e=>!e.match||!n||e.match(n)).map(e=>{var t;let r=e.label;if("function"==typeof r){if(!n)return null;r=r(n)}return eP(eP({},e),{},{label:r,value:null!==(t=e.value)&&void 0!==t?t:r})}).filter(e=>null!==e)}({type:l,rating:c,turn:n}),modalOnly:!0,modalTitle:(0,I.jsxs)("div",{className:"flex items-center gap-2",children:["thumbsUp"===c?(0,I.jsx)(_.go,{className:"mt-[-2px]"}):(0,I.jsx)(_.W2,{className:"mb-[-2px]"})," ","Provide feedback"]})},c)]})}function eM(e){let{turn:t}=e,n=(0,J.nn)(J.LW.threadId),{user:r}=(0,ey.A)();(0,M.useEffect)(()=>{if(n){if(null===t.index)throw Error();e_.Y.logEvent(e_.M.searchTurnFeedbackButtonShown,{turn_index:t.index,thread_id:n})}},[]);let s=async e=>{if(n&&e.currentRating){if(null===t.index)throw Error();e_.Y.logEvent(e_.M.searchTurnFeedbackSubmitted,{turn_index:t.index,thread_id:n,rating:e.currentRating,tags:e.tags,text:e.textFeedback}),await (0,eO.k4)({turnIndex:t.index,threadId:n,rating:e.currentRating,searchQuery:t.user_query,tags:e.tags,text:e.textFeedback,screenshot:e.screenshot,userEmail:null==r?void 0:r.email})}};return(0,I.jsx)(eR,{onSubmit:s,type:"turn",turn:t,thumbsUpTooltip:"Good response",thumbsDownTooltip:"Bad response"})}function eT(e){let{url:t,title:n,snippet:r,turnIndex:s}=e,a=(0,J.nn)(J.LW.threadId),{user:l,searchQuery:i}=(0,ey.A)(),o=async e=>{a&&e.currentRating&&l&&(e_.Y.logEvent(e_.M.searchLinkFeedbackSubmitted,{thread_id:a,rating:e.currentRating,url:t,tags:e.tags,text:e.textFeedback,turn_index:s}),await (0,eO.NK)({url:t,title:n,snippet:r,threadId:a,rating:e.currentRating,searchQuery:i,tags:e.tags,text:e.textFeedback,screenshot:e.screenshot,userEmail:null==l?void 0:l.email}))};return(0,I.jsx)(eR,{onSubmit:o,type:"link",thumbsUpTooltip:"Good link",thumbsDownTooltip:"Bad link"})}function eZ(){return(eZ=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var eL=e=>M.createElement("svg",eZ({xmlns:"http://www.w3.org/2000/svg",width:24,height:24,fill:"none",viewBox:"0 0 24 24"},e),d||(d=M.createElement("path",{fill:"currentColor",d:"M9.199 22v-.576c-.252.387-.846.675-1.63.675-1.7 0-2.951-1.35-2.951-3.294 0-1.953 1.278-3.366 3.078-3.366 1.413 0 2.34.747 2.736 1.935L9 17.833c-.144-.693-.612-1.089-1.296-1.089-.936 0-1.584.81-1.584 2.043s.648 2.043 1.61 2.043c.739 0 1.234-.495 1.315-1.161H7.615v-1.233h2.916V22zm4.228-6.462V22h-1.503v-6.462zM16.331 22h-1.476v-6.462h4.527v1.287h-3.05v1.467h2.537v1.26h-2.538z"})),m||(m=M.createElement("path",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 11V6a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v5"})),p||(p=M.createElement("path",{fill:"currentColor",d:"M6 5h2l-.862 1.724A.5.5 0 0 1 6.691 7H6zM9 5h3l-.862 1.724a.5.5 0 0 1-.447.276H8.566a.35.35 0 0 1-.313-.507zM13 5h3l-.862 1.724a.5.5 0 0 1-.447.276h-2.125a.35.35 0 0 1-.313-.507zM17 5h1v2h-1.434a.35.35 0 0 1-.313-.507z"})));function eI(){return(eI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var eF=e=>M.createElement("svg",eI({xmlns:"http://www.w3.org/2000/svg",width:24,height:24,fill:"none",viewBox:"0 0 24 24"},e),h||(h=M.createElement("path",{fill:"currentColor",d:"M4.7 21.097c-.51 0-.808-.303-.808-.84v-4.755c0-.536.299-.843.809-.843h1.938c1.362 0 2.285.883 2.285 2.245 0 1.354-.971 2.237-2.382 2.237H5.505v1.116c0 .537-.295.84-.804.84m.805-3.169h.699c.685 0 1.09-.356 1.09-1.02 0-.659-.405-1.014-1.082-1.014h-.707zM10.449 21c-.51 0-.809-.308-.809-.844v-4.654c0-.536.299-.843.809-.843h1.766c1.916 0 3.041 1.111 3.041 3.133 0 2.026-1.129 3.208-3.04 3.208zm.804-1.3h.751c1.05 0 1.613-.638 1.613-1.904 0-1.19-.593-1.836-1.613-1.836h-.751zm5.594 1.397c-.51 0-.808-.303-.808-.84v-4.755c0-.536.298-.843.808-.843h2.874c.435 0 .716.237.716.65s-.29.65-.716.65h-2.07v1.442h1.864c.408 0 .672.228.672.62 0 .386-.255.615-.672.615H17.65v1.621c0 .537-.294.84-.804.84"})),f||(f=M.createElement("path",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 11V6a2 2 0 0 1 2-2h7.172a2 2 0 0 1 1.414.586l2.828 2.828A2 2 0 0 1 19 8.828V11m-4-6v2.5a.5.5 0 0 0 .5.5H18m-2-1 .5-.5"})));function eU(){return(eU=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var ez=e=>M.createElement("svg",eU({xmlns:"http://www.w3.org/2000/svg",width:24,height:24,fill:"none",viewBox:"0 0 24 24"},e),g||(g=M.createElement("path",{stroke:"currentcolor",strokeLinecap:"round",strokeWidth:2,d:"M20 9v-.2c0-1.68 0-2.52-.327-3.162a3 3 0 0 0-1.311-1.311C17.72 4 16.88 4 15.2 4H11c-3.5 0-7 3.5-7 7v4.2c0 1.68 0 2.52.327 3.162a3 3 0 0 0 1.311 1.311C6.28 20 7.12 20 8.8 20H9m1.5-15-.558 2.512c-.16.72-.24 1.08-.422 1.372a2 2 0 0 1-.636.636c-.291.182-.651.262-1.372.422L5 10.5M17.76 20.355a2.202 2.202 0 0 1-3.115-3.114m5.71.518a2.202 2.202 0 0 0-3.114-3.114"})));let eq=["turnIndex","groupPosition","rawPosition"];function eV(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function eQ(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?eV(Object(n),!0).forEach(function(t){(0,es.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eV(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function eB(e){let{searchResult:t,className:n}=e,r=new URL(t.url).pathname.split(".").pop();return"application/pdf"===t.content_type||"pdf"===r?(0,I.jsx)(eF,{className:n}):"gif"===r?(0,I.jsx)(eL,{className:n}):null}function eG(e){let{searchResult:t}=e;return t.pub_date?(0,I.jsxs)("span",{className:"text-token-text-secondary",children:[new Date(1e3*t.pub_date).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})," — "]}):null}function eH(e){return{ease:"easeOut",duration:.15,delay:(e+1)*.09}}function eK(e){var t;let{secondaryResults:n,rawPosition:r,groupPosition:s,turnIndex:a,showFeedbackButtons:l,highlightUrl:i}=e,{0:o,1:c}=(0,M.useState)(n.length<=2),u=o?n:n.slice(0,1),d=(0,eb.d)(n[0].url).data,m=n[0];return(0,I.jsxs)("div",{className:"mt-5 flex flex-col gap-5",children:[u.map((e,t)=>(0,I.jsx)(B.E.div,{className:"group relative",initial:{opacity:0,translateY:4},animate:{opacity:1,translateY:0},transition:eH(t),children:(0,I.jsxs)(eX,{href:e.url,turnIndex:a,groupPosition:[s[0],t],rawPosition:r+t,target:"_blank",rel:"noreferrer",className:(0,w.default)("block group-hover:text-token-link",{"bg-yellow-100 dark:bg-yellow-900":i===e.url}),children:[(0,I.jsxs)("div",{className:"relative line-clamp-1 pr-[70px] text-sm font-medium group-hover:text-token-link",children:[e.title,l&&(0,I.jsx)("div",{className:"invisible absolute right-0 top-0 py-1 group-hover:visible",children:(0,I.jsx)(eT,{url:e.url,title:e.title,snippet:e.snippet,turnIndex:a})})]}),(0,I.jsxs)("div",{className:"line-clamp-1 text-sm font-normal text-token-text-secondary",children:[(0,I.jsx)(eB,{searchResult:e,className:"mr-2 inline"}),(0,I.jsx)(eG,{searchResult:e}),e.snippet]})]},t)},t)),!o&&n.length>1&&(0,I.jsxs)("button",{className:"flex text-sm font-medium hover:text-token-link",onClick:()=>c(!0),children:["More ",null!=d?d:(0,ex.p)(m.url,"short")," (",null!==(t=null==u?void 0:u.length)&&void 0!==t?t:-3,")"]})]})}function eW(e){var t;let{results:n,groupPosition:r,rawPosition:s,showFeedbackButtons:a,showUserHash:l,highlightUrl:i,turnIndex:o}=e,c=n[0],u=n.slice(1),d=(0,M.useRef)(null),{userHash:m}=(0,ey.A)(),p=l?(0,I.jsx)("div",{className:"h-[24px] w-[24px] flex-shrink-0 rounded-full border border-token-border-medium",style:{backgroundColor:"#"+m}}):(0,I.jsx)(eg.Z,{url:c.url,className:"icon-lg rounded-full border border-token-border-medium object-cover",size:32}),h=null!==(t=(0,eb.d)(c.url).data)&&void 0!==t?t:(0,ex.p)(c.url,"short"),f=i===c.url;return(0,M.useEffect)(()=>{f&&d.current&&d.current.scrollIntoView({behavior:"smooth",block:"center"})},[f]),(0,I.jsx)("div",{ref:d,className:"link-result pl-12",children:(0,I.jsxs)("div",{className:"link-text flex w-full min-w-0 flex-col overflow-y-auto",children:[(0,I.jsx)("div",{className:"flex flex-col",children:(0,I.jsxs)(eX,{turnIndex:o,href:c.url,groupPosition:r,rawPosition:s,target:"_blank",rel:"noreferrer",className:"group",children:[(0,I.jsx)("div",{className:"absolute left-0",children:p}),(0,I.jsx)("div",{className:"line-clamp-1 pr-[--snc-2] text-sm",children:h}),(0,I.jsxs)("div",{className:(0,w.default)("relative line-clamp-1 text-sm font-medium group-hover:pr-10 group-hover:text-token-link",{"bg-yellow-100 dark:bg-yellow-900":f}),children:[c.title,a&&(0,I.jsx)("div",{className:"invisible absolute right-0 top-0 py-1 group-hover:visible",children:(0,I.jsx)(eT,{url:c.url,title:c.title,snippet:c.snippet,turnIndex:o})})]}),(0,I.jsxs)("div",{className:"line-clamp-2 text-sm text-token-text-secondary",children:[(0,I.jsx)(eB,{searchResult:c,className:"mr-2 inline"}),(0,I.jsx)(eG,{searchResult:c}),c.snippet]})]})}),u&&u.length>0&&(0,I.jsx)(eK,{secondaryResults:u,rawPosition:s,groupPosition:r,turnIndex:o,showFeedbackButtons:a,highlightUrl:i})]})})}let eX=(0,M.forwardRef)(function(e,t){let n=(0,J.nn)(J.LW.threadId),{turnIndex:r,groupPosition:s,rawPosition:a}=e,l=(0,ef.Z)(e,eq);function i(t){e.href&&n&&e_.Y.logEvent(t,{url:e.href,thread_id:n,turn_index:r,group_position:s,raw_position:a})}return(0,M.useEffect)(()=>{i(e_.M.searchLinkShown)},[]),(0,I.jsx)("a",eQ(eQ({ref:t},l),{},{onClick:t=>{var n;null===(n=e.onClick)||void 0===n||n.call(e,t),t.stopPropagation(),i(e_.M.searchLinkClicked)}}))});function eY(e){var t,n;let{searchResults:r,turnIndex:s,className:a,highlightUrl:l,showFeedbackButtons:i=!0}=e,{0:o,1:c}=(0,M.useState)(!1);(0,M.useEffect)(()=>{c(!1)},[s]);let u=(0,M.useRef)((0,ej.random)(0,2)),d=null!=r,m=[];if(d){let e=new Map;null==r||r.forEach(t=>{let n=(0,ev.FH)(t.url),r=e.get(n);void 0===r?(e.set(n,m.length),m.push([t])):m[r].push(t)})}let p=o?m:m.slice(0,3);return(0,I.jsxs)("div",{className:(0,w.default)(a,"flex flex-col"),children:[(0,I.jsx)(B.E.div,{className:"flex",animate:d?{opacity:1,translateY:0}:{opacity:0,translateY:20},transition:{duration:.15},children:d&&(0,I.jsx)(I.Fragment,{children:(0,I.jsxs)("div",{className:"source-title text-sm font-medium",children:[(0,I.jsx)(ez,{className:"icon-lg"}),"Source Links"]})})}),(0,I.jsxs)("div",{className:"flex w-full flex-col gap-[--snc-1]",children:[d&&p.map((e,t)=>(0,I.jsx)(B.E.div,{initial:{opacity:0,translateY:4},animate:{opacity:1,translateY:0},transition:eH(t),children:(0,I.jsx)(eW,{groupPosition:[t,0],rawPosition:0===t?0:m.slice(0,t).reduce((e,t)=>e+t.length,0),results:e,showUserHash:u.current===t,showFeedbackButtons:i,highlightUrl:l,turnIndex:s},t)},t)),!o&&(null!==(t=null==m?void 0:m.length)&&void 0!==t?t:0)>3&&(0,I.jsx)(B.E.div,{initial:{opacity:0,translateY:4},animate:{opacity:1,translateY:0},transition:eH(m.length),children:(0,I.jsxs)("button",{className:"more-btn mt-[calc(-1*var(--snc-1))] text-sm font-medium",onClick:()=>c(!0),children:[(0,I.jsx)(ez,{className:"icon-lg opacity-0 "}),"Show all web results (",null!==(n=null==m?void 0:m.length)&&void 0!==n?n:-3,")"]})})]})]})}var eJ=n(92226),e$=n(79864),e0=n(35936),e1=n(86685),e2=n(90572),e5=n(47567);function e3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function e4(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?e3(Object(n),!0).forEach(function(t){(0,es.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):e3(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function e6(e){let{images:t,children:n}=e;return t.length>=4?(0,I.jsx)(e7,{images:t,numVisible:Math.min(4*Math.floor(t.length/4),8),children:n}):t.length>=1?(0,I.jsx)(e8,{image:t[0],children:n}):(0,I.jsx)(I.Fragment,{children:n})}function e8(e){let{image:t,children:n}=e;return(0,I.jsxs)("div",{className:"w-full",children:[(0,I.jsx)(e9,{image:t,className:"relative z-10 float-right -mt-1 mb-6 ml-6 max-w-[33%]"},t.content_url),n]})}function e7(e){let{images:t,numVisible:n=8,children:r}=e,s=(0,M.useRef)(new Set),{0:a,1:l}=(0,M.useState)(new Map),{0:i,1:o}=(0,M.useState)(new Set),c=null==t?void 0:t.map(e=>e4(e4({},e),{},{status:a.has(e.thumbnail_url)?"done":i.has(e.thumbnail_url)?"error":"loading",ratio:a.get(e.thumbnail_url)}));(0,M.useEffect)(()=>{null==t||t.forEach(e=>{if(!s.current.has(e.thumbnail_url)){s.current.add(e.thumbnail_url);let t=new Image;t.onload=function(){l(t=>new Map(t).set(e.thumbnail_url,this.width/this.height))},t.onerror=()=>{o(t=>new Set(t).add(e.thumbnail_url))},t.src=e.thumbnail_url}})},[t]);let u=c.filter(e=>"error"!==e.status);return(0,I.jsxs)("div",{className:"flex flex-col",children:[(0,I.jsx)("div",{className:"-m-1 mb-6 flex flex-wrap",children:u.slice(0,n).map(e=>(0,I.jsx)(e9,{image:e,className:"w-1/4"},e.thumbnail_url))}),r]})}function e9(e){var t;let{image:n,className:r}=e,s=(0,M.useRef)(!1),{0:a,1:l}=(0,M.useState)(!1);(0,M.useEffect)(()=>{if(!s.current){s.current=!0;let e=new Image;e.onload=()=>l(!0),e.src=n.thumbnail_url}},[n]);let i=null!==(t=(0,eb.d)(n.url).data)&&void 0!==t?t:(0,ex.p)(n.url,"short");return(0,I.jsx)(e1.Xt,{citationMetadata:{type:"webpage",url:n.url,title:i},sideOffset:4,className:r,children:(0,I.jsx)(B.E.div,{className:"relative aspect-square overflow-hidden rounded-xl p-1",whileHover:{padding:0},children:a?(0,I.jsx)(B.E.img,{src:n.thumbnail_url,alt:n.url,initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},className:"inset-0 h-full w-full rounded-xl bg-token-main-surface-secondary object-cover"}):(0,I.jsx)("div",{className:"inset-0 h-full w-full animate-pulse rounded-xl bg-token-main-surface-secondary"})})})}var te=n(75138);function tt(e){let{tldr:t}=e;return(0,I.jsxs)("div",{className:"flex items-center",children:[(0,I.jsxs)("div",{className:"flex-1",children:[(0,I.jsx)("div",{className:"text-lg font-medium",children:t.display_title}),(0,I.jsx)("a",{href:t.url,target:"_blank",className:"text-token-link hover:text-token-link-hover",children:t.url})]}),(0,I.jsx)(eg.Z,{url:t.url,size:128,className:"h-[--snc-3] w-[--snc-3] shrink-0"})]})}function tn(e){let{data:t}=e;return t.expression&&void 0!==t.result?(0,I.jsxs)("div",{children:[(0,I.jsx)("div",{className:"tracking-wide text-token-text-tertiary",children:"".concat(t.expression,"=")}),(0,I.jsx)("div",{className:"text-3xl font-medium",children:t.result})]}):null}function tr(e){let{data:t}=e;if(!t.price||!t.asset)return null;let n=100*t.price.changePercent,r=n>=0;return(0,I.jsxs)("div",{className:"flex justify-between",children:[(0,I.jsxs)("div",{children:[(0,I.jsx)("div",{className:"text-3xl font-medium",children:t.asset.ticker}),(0,I.jsx)("div",{className:"text-token-text-tertiary",children:t.asset.name})]}),(0,I.jsxs)("div",{children:[(0,I.jsxs)("div",{className:"text-3xl font-medium",children:["$",t.price.price.toFixed(2)]}),(0,I.jsxs)("div",{className:"flex items-center gap-1",children:[(0,I.jsxs)("span",{className:(0,w.default)("flex items-center gap-1",r?"text-green-400":"text-red-500"),children:[r?(0,I.jsx)(E.iRh,{}):(0,I.jsx)(E.tv1,{}),Math.abs(n).toFixed(2),"%"]})," ","today"]})]})]})}var ts=n(56115);function ta(e){let{data:t}=e;if(null===t.articles)throw Error();let n=(0,eb.u)(t.articles.map(e=>e.source_url));return(0,I.jsxs)("div",{children:[(0,I.jsx)("h2",{className:"mb-4",children:"Top stories"}),(0,I.jsx)("div",{className:"flex flex-col gap-4",children:t.articles.map(e=>{var t;return(0,I.jsxs)("div",{className:"flex min-h-28 items-center gap-4",children:[(0,I.jsxs)("div",{className:"flex-grow",children:[(0,I.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,I.jsx)(eg.Z,{url:e.source_url,className:"flex-shrink-0 rounded-full border border-token-border-medium",size:24}),(0,I.jsx)("span",{children:null!==(t=n.get(e.source_url))&&void 0!==t?t:(0,ex.p)(e.source_url,"short")})]}),(0,I.jsx)("a",{href:e.source_url,target:"_blank",className:"mt-2 line-clamp-2 inline-block cursor-pointer text-base font-medium text-token-link",children:e.title}),e.published_on&&(0,I.jsx)("div",{className:"text-sm text-token-text-tertiary",children:(0,ts.Z)(new Date(e.published_on),"MMM d, yyyy")})]}),e.image_url&&(0,I.jsx)("img",{alt:e.title,className:"aspect-square h-28 w-28 flex-shrink-0 rounded-lg object-cover",src:e.image_url})]},e.source_url)})})]})}var tl=n(11265),ti=n(91304),to=n(24343);let tc=((null===(r=Intl.DateTimeFormat(void 0,{timeZoneName:"long"}).formatToParts(new Date))||void 0===r||null===(r=r.find(e=>"timeZoneName"==e.type))||void 0===r?void 0:r.value)||Intl.DateTimeFormat().resolvedOptions().timeZone).replace(/Daylight|Standard/g,"");function tu(e){let[t,n]=e.split(":");return"".concat(t.padStart(2,"0"),":").concat(n)}let td={T:"Top",B:"Bot"};function tm(e){let{data:t}=e,{0:n,1:r}=(0,M.useState)(!0);if(!t.games.length)return null;let s=t.league.league_url;function a(e){return"live"===e.status||"complete"===e.status&&null!=e.points}return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)("h2",{className:"text-lg font-medium",children:[t.league.display_name," Schedule"]}),s&&(0,I.jsx)("a",{href:s,target:"_blank",rel:"noreferrer",className:"text-sm text-token-link",children:s}),(0,I.jsx)("hr",{className:"mt-6 border-token-border-light"}),(0,I.jsx)(tl.Z.Root,{size:"compact",children:(0,I.jsx)(tl.Z.Body,{children:(0,I.jsx)(to.M,{children:t.games.slice(0,n?6:void 0).map((e,n)=>{var r;return(0,I.jsxs)(th,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},exit:{opacity:0,y:-30},transition:{duration:.2},children:[(0,I.jsx)(tp,{className:"w-[180px]",children:function(e){var n,r;switch(e.status){case"scheduled":return(0,I.jsxs)(I.Fragment,{children:[function(e){let t=new Date(1e3*e);return(0,ti.Z)(t)?"Today":(0,ts.Z)(t,"MMMM d")}(e.scheduled),(0,I.jsx)("br",{}),(n=e.scheduled,(0,ts.Z)(new Date(1e3*n),"h:mm a"))]});case"live":return(0,I.jsxs)(I.Fragment,{children:["Now",(0,I.jsx)("br",{}),function(e,t){if(!t.live_details)return null;if("nba"===e){var n;let e=t.live_details;return"".concat(5===(n=e.quarter)?"OT":"Q".concat(n)," ").concat(tu(e.time))}if("mlb"===e){let e=t.live_details;if(e.current_inning_half)return"".concat(td[e.current_inning_half]," ").concat(function(e){let t=["th","st","nd","rd"],n=e%100;return e+(t[(n-20)%10]||t[n]||"th")}(e.current_inning))}else if("nhl"===e){let e=t.live_details;return"P".concat(e.period," ").concat(tu(e.time))}return null}(t.league.id,e)]});case"complete":return(0,I.jsxs)("div",{children:["Final",(0,I.jsx)("br",{}),(0,I.jsx)("div",{className:"text-token-text-secondary",children:void 0===(r=e.scheduled)?"":(0,ts.Z)(new Date(1e3*r),"EEE, MMM d")})]})}}(e)}),(0,I.jsx)(tp,{children:(0,I.jsxs)("div",{className:"w-full max-w-[280px]",children:[(0,I.jsxs)("div",{className:"flex items-center justify-between",children:[(0,I.jsx)("span",{children:e.away.name}),a(e)&&(0,I.jsx)("span",{children:e.points.away})]}),(0,I.jsxs)("div",{className:"mt-2 flex items-center justify-between",children:[e.home.name,a(e)&&(0,I.jsx)("span",{children:e.points.home})]})]})}),(0,I.jsx)(tp,{textAlign:"right",className:"text-token-text-secondary",children:null===(r=e.broadcasts)||void 0===r||null===(r=r.find(e=>"National"===e.locale))||void 0===r?void 0:r.network})]},n)})})})}),(0,I.jsx)("hr",{className:"border-token-border-light"}),(0,I.jsxs)("div",{className:"mt-6 flex items-center justify-between",children:[t.games.length>6&&(0,I.jsx)("button",{className:"flex items-center text-sm font-medium",onClick:()=>r(!n),children:n?(0,I.jsxs)(I.Fragment,{children:["Show more ",(0,I.jsx)(N.eOB,{className:"mb-[-2px]"})]}):(0,I.jsxs)(I.Fragment,{children:["Show less ",(0,I.jsx)(N.BZB,{className:"mb-[-2px]"})]})}),(0,I.jsx)("div",{className:"text-xs text-token-text-tertiary",children:tc})]})]})}let tp=(0,A.Z)(tl.Z.Cell)(x||(x=(0,j.Z)(["py-5 align-middle"]))),th=(0,B.E)(tl.Z.Row);var tf=n(28541),tg=n.n(tf);let tx=["East","Central","West"];function tv(e){let{data:t}=e,{0:n,1:r}=(0,M.useState)(0),s=tg()(t.conferences[n].divisions,e=>{var t;let n=tx.indexOf(null!==(t=e.name)&&void 0!==t?t:"");return -1===n?1/0:n}),a=t.conferences.length>1?t.conferences.map((e,t)=>(0,I.jsx)("button",{className:(0,w.default)(n===t?"bg-token-main-surface-secondary text-token-text-primary":"bg-transparent text-token-text-tertiary","rounded-lg px-3 py-1 text-xs font-medium"),onClick:()=>r(t),children:e.name},e.name)):null;return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)("h2",{className:"text-lg font-medium",children:[t.league.display_name," Standings"]}),a&&(0,I.jsx)("div",{className:"mt-5 flex gap-1",children:a}),(0,I.jsx)("div",{className:"mt-6",children:s.map(e=>e.name?(0,I.jsxs)("div",{className:"mt-5",children:[(0,I.jsx)("div",{className:"text-md font-medium",children:e.name}),(0,I.jsx)(tw,{league:t.league.id,teams:e.teams})]},e.name):(0,I.jsx)(tw,{league:t.league.id,teams:e.teams}))}),(0,I.jsx)("hr",{className:"border-token-border-light"})]})}let tb=(0,A.Z)(tl.Z.HeaderCell)(v||(v=(0,j.Z)(["text-token-text-secondary text-xs dark:bg-token-main-surface-tertiary"]))),tj={wins:{column:"W",label:"Wins",format:e=>e.wins},losses:{column:"L",label:"Losses",format:e=>e.losses},ties:{column:"T",label:"Ties",format:e=>e.ties},win_percentage:{column:"PCT",label:"Win %",format:e=>e.win_percentage.toFixed(3)},games_behind:{column:"GB",label:"Games Behind",format:e=>e.games_behind&&null!==e.games_behind.conference?0===e.games_behind.conference?"—":Math.round(100*e.games_behind.conference)/100:""},conference_record:{column:"Conf",label:"Conference Record",format:e=>{let t=e.records.find(e=>"conference"===e.record_type);return t?"".concat(t.wins,"-").concat(t.losses):""}},home_record:{column:"Home",label:"Home Record",format:e=>{let t=e.records.find(e=>"home"===e.record_type);return t?"".concat(t.wins,"-").concat(t.losses):""}},away_record:{column:"Away",label:"Away Record",format:e=>{let t=e.records.find(e=>"away"===e.record_type);return t?"".concat(t.wins,"-").concat(t.losses):""}},l10_record:{column:"L10",label:"Last 10 Record",format:e=>{let t=e.records.find(e=>"last_10"===e.record_type);return t?"".concat(t.wins,"-").concat(t.losses):""}},streak:{column:"Strk",label:"Streak",format:e=>{var t,n;return e.streak?"".concat((null===(t=e.streak)||void 0===t?void 0:t.kind)==="win"?"W":"L").concat(null===(n=e.streak)||void 0===n?void 0:n.length):""}},ot_losses:{column:"OTL",label:"Overtime Losses",format:e=>e.overtime_losses},points:{column:"PTS",label:"Points",format:e=>e.points}},ty={nba:["wins","losses","win_percentage","games_behind","l10_record","streak"],wnba:["wins","losses","win_percentage","games_behind","l10_record","streak"],nhl:["wins","losses","ot_losses","win_percentage","points","conference_record","home_record","l10_record","streak"],mlb:["wins","losses","win_percentage","streak","l10_record"],epl:["wins","win_percentage","losses","ties"],nfl:[],ncaaf:[],ncaab:[],wncaab:[]};function tw(e){let{league:t,teams:n}=e,r=ty[t];return(0,I.jsxs)(tl.Z.Root,{size:"compact",children:[(0,I.jsxs)(tl.Z.Header,{children:[(0,I.jsx)(tb,{children:"Team"}),(0,I.jsx)(tb,{}),r.map(e=>(0,I.jsx)(tb,{textAlign:"center",className:"px-1",children:(0,I.jsx)("span",{title:tj[e].label,children:tj[e].column})},e))]}),(0,I.jsx)(tl.Z.Body,{children:n.map((e,t)=>(0,I.jsxs)(tl.Z.Row,{children:[(0,I.jsxs)(tl.Z.Cell,{children:[(0,I.jsx)("div",{className:"mr-4 w-4 tabular-nums text-token-text-secondary",children:t+1}),(0,I.jsx)("span",{className:"whitespace-nowrap",children:e.name})]}),(0,I.jsx)(tl.Z.Cell,{className:"w-full"}),r.map(t=>(0,I.jsx)(tl.Z.Cell,{textAlign:"center",className:"whitespace-nowrap px-1 tabular-nums",children:tj[t].format(e)},t))]},e.name))})]})}var tA=n(28294),tO=n(87751),tk=n(72541);function tN(e){let{data:t}=e,{targetTime:n,sourceTime:r,humanReadableTargetTime:s,humanReadableSourceTime:a,humanReadableTimeDifference:l}=(0,M.useMemo)(()=>{var e;let n=(0,tO.Z)(t.target_time,t.target_location.timezone),r=t.source_time&&null!==(e=t.source_location)&&void 0!==e&&e.timezone?(0,tO.Z)(t.source_time,t.source_location.timezone):null,s=(0,tk.Z)(n,"h:mmaaa",{timeZone:t.target_location.timezone}),a=r&&t.source_location?(0,tk.Z)(r,"h:mmaaa",{timeZone:t.source_location.timezone}):null,l=r?(0,tA.Z)(n,r):0,i=r?"".concat(l>0?"+":"–"," ").concat(Math.abs(l)," hours"):null;return{targetTime:n,sourceTime:r,humanReadableTargetTime:s,humanReadableSourceTime:a,humanReadableTimeDifference:i}},[t.source_location,t.source_time,t.target_location.timezone,t.target_time]),i=r?(0,$.F)(t.source_location,r):null,o=(0,$.F)(t.target_location,n);return a?(0,I.jsxs)("div",{className:"flex items-center gap-9",children:[(0,I.jsxs)("div",{children:[(0,I.jsx)("div",{className:"text-3xl font-medium",children:a}),i&&(0,I.jsx)("div",{className:"text-token-text-tertiary",children:i})]}),(0,I.jsxs)("div",{className:"relative flex-grow text-center text-token-text-tertiary",children:[(0,I.jsx)("div",{className:"absolute left-0 top-1/2 z-0 h-[1px] w-full border-t border-token-border-medium before:absolute before:right-0 before:block before:h-[5px] before:w-[5px] before:translate-y-[-3px] before:rounded-full before:bg-token-text-tertiary after:block after:h-[5px] after:w-[5px] after:translate-y-[-3px] after:rounded-full after:bg-token-text-tertiary"}),(0,I.jsx)("span",{className:"absolute left-1/2 top-1/2 z-0 -translate-x-1/2 -translate-y-1/2 rounded-full border border-token-border-medium bg-token-main-surface-primary px-3 py-0.5 text-xs",children:l})]}),(0,I.jsxs)("div",{className:"text-right",children:[(0,I.jsx)("div",{className:"text-3xl font-medium",children:s}),(0,I.jsx)("div",{className:"text-token-text-tertiary",children:o})]})]}):(0,I.jsxs)("div",{children:[(0,I.jsx)("div",{className:"text-3xl font-medium",children:s}),(0,I.jsx)("div",{className:"text-token-text-tertiary",children:o})]})}var t_=n(29924),tS={src:"https://cdn.oaistatic.com/_next/static/media/cloudy.00382cff.png",height:96,width:96,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAAKlBMVEVMaXHY2NjQ0NDLy8vb29v5+fnr6+vl5eXa2trg4ODm5ubu7u7m5ub29vbwicHnAAAADHRSTlMA/fx6XA5ptkLTH2+edEDrAAAACXBIWXMAACxLAAAsSwGlPZapAAAANklEQVR4nEXLMRLAIAzEQN3ZGJKY/383MzSo2UpwG1XjOPeewPu01AVf21Yny7KkhBURkXf+AR8vANHyV63lAAAAAElFTkSuQmCC",blurWidth:8,blurHeight:8},tP={src:"https://cdn.oaistatic.com/_next/static/media/haze.7bf0628a.png",height:96,width:96,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAAWlBMVEVMaXHYupiUoKn/liCfwd3/nAr3vGmOnamyub6otb++vr3/kgamsLj+nxLvgxeVoaycoaKYpbCkkYb9mAz8kQ6zrafrrG+Gl6P/pwLEw727ppHkxaP8kw6coqVwxU3kAAAAGHRSTlMA+5InEsH5piuwqlLAoyF++dGY9vz+wP1uL8iLAAAACXBIWXMAACxLAAAsSwGlPZapAAAAO0lEQVR4nGNgQALcrLzMDAwcnFxsEhKsIIYkm4iMMB8Dj6AAI6O0GAMDC7+4rKiUEAsDAxM7CHDA9QIARrICEXlIYf4AAAAASUVORK5CYII=",blurWidth:8,blurHeight:8},tE={src:"https://cdn.oaistatic.com/_next/static/media/mist.cef57380.png",height:96,width:96,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAARVBMVEVMaXHJycmqs7y8vLu9wsSstLmqs7rN2c2QnaeJmaWotLu1vMC9w8iqtb21vsWUoKmbprCMnKeToayRn6iUoqy6wsXEyc2UiX3wAAAAFnRSTlMAPypdMbv8BKj9FP1ro8yS0tt+4mmkuOtixgAAAAlwSFlzAAAsSwAALEsBpT2WqQAAAD5JREFUeJwdi0kOwCAMxAZIMgTSffn/U6vUB0s+GEhIgCgqGbKsbysBVLUImwLd/bL5EON09+Me4NaT+t+pDzZgAaO6S7N2AAAAAElFTkSuQmCC",blurWidth:8,blurHeight:8},tC={src:"https://cdn.oaistatic.com/_next/static/media/partly-cloudy.4f9dbdaf.png",height:96,width:96,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAARVBMVEVMaXHKxcH4hR7/hx7jVQDT1NX/37nHycrOzMzd39/+lwnT09PWzcn/kwDyzqvg3uD5sWrd3d380ZfX19Pr28z/phj/wm6rhz7sAAAAFHRSTlMA7yoiDez+e/4dozWw+vit3TzOTdRPN9MAAAAJcEhZcwAALEsAACxLAaU9lqkAAAA6SURBVHicY2BABizMYEqQX0iUi4GBQZhVhE2Ml4mBk5WDkY9NgIWBk5GDg0OEh4GBgZudnZ2dE6EVAC8cAWG5t2y3AAAAAElFTkSuQmCC",blurWidth:8,blurHeight:8},tD={src:"https://cdn.oaistatic.com/_next/static/media/partly-sunny.0ee3693e.png",height:96,width:96,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAAPFBMVEXkyV/7jwvsjBz2li/voz7z3cXfu4PdrV5MaXHsqTbX0cvj07bm2cj6tVLmxJX/sFX/xmjmzqj/mALj2c11XzOkAAAAEnRSTlMBrVa2NPpeBwAto7fEsGj6/krbj3AZAAAACXBIWXMAACxLAAAsSwGlPZapAAAAPElEQVR4nCXLSRLAIAwDQQE2lsgK/P+vqcBpLtMgGEEQoMz0t59XyiJ4+zuKBUJpPH4QVC4+255rXW7zD0GCAdKVkO21AAAAAElFTkSuQmCC",blurWidth:8,blurHeight:8},tR={src:"https://cdn.oaistatic.com/_next/static/media/rain-drizzle.dd0eb5ff.png",height:96,width:96,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAAOVBMVEVMaXHk5OTr6+vq6urR0M80t/rg3dvf398rg87Gysvf39/U1tbu7u7p6emqydfg4ODe3t7x8fHV1NT7VM1KAAAAEXRSTlMAFy6w+0tD/Qqp5GUewcrpraZWRYMAAAAJcEhZcwAALEsAACxLAaU9lqkAAAA6SURBVHicRYvJDcAgDMAMBJJwFvYftkKqVH/8seEnphSvS917AGGpiD4Q6pGj2qH4dG83spy/zQx4AScQASnZdgAuAAAAAElFTkSuQmCC",blurWidth:8,blurHeight:8},tM={src:"https://cdn.oaistatic.com/_next/static/media/rain-showers.0c759a1b.png",height:96,width:96,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAAV1BMVEVMaXHUyb//mQnSzMzU1Nbk4OA0uPwrg87DyMvKyMfgZgD/jVXg0sn/mQ/4iSfm5ub7p0320Kz8y4yszdr/6sLg4ubT1NfPz8/w2MTLzc//wF3w5dj/166cGUAIAAAAGHRSTlMA+u9QNiFLCqb7GQm5gCcV5fmsyPyF0+PKCVdvAAAACXBIWXMAACxLAAAsSwGlPZapAAAAPklEQVR4nB2LxxHAIAzABAFsp5He958zB3roJUGhq4774gcgHO/2+JF83m7+ppZoZu7qgUZX1VBiSalOIAL8SiYB2VyRuGAAAAAASUVORK5CYII=",blurWidth:8,blurHeight:8},tT={src:"https://cdn.oaistatic.com/_next/static/media/rain-thunder.9801386b.png",height:96,width:96,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAARVBMVEVMaXHc29v19fXmuoXj4+Pb29vGxcXMzMvFt9NvgJ/4cwDG0OTagycssfDJycnX19cAxP+zzd3Ozs7X19e+yszX19jX0MaT0GpmAAAAFXRSTlMAzAzRGz78+wQLUk2GRehTQZ/E56UGd/X5AAAACXBIWXMAACxLAAAsSwGlPZapAAAAPUlEQVR4nB3Lxw3AQAwEsdElrZyT3H+pBsw/QUgAopt1BPudaQWa+xh5Fdrmw19v0J+z1hmI9Vimv0WExAc50AG8kA54XAAAAABJRU5ErkJggg==",blurWidth:8,blurHeight:8},tZ={src:"https://cdn.oaistatic.com/_next/static/media/rain.1537f78c.png",height:96,width:96,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAANlBMVEXZ4uzg3t7p6ekptPbn5+fj4+Pi4uKIqci/zdHS0dEmtfsitvvq6uokuPvU1NTc3Nzc3Nzs7OzPAM+yAAAAEHRSTlMBTsgfGTvuCqD8UEPLRebB+sYJzgAAAAlwSFlzAAAsSwAALEsBpT2WqQAAADhJREFUeJxFizkSwCAMxATYXpMT/v/ZDDRRIzWCH6/Vl0vMeQksRu/jFfasCAPPzCyAzvto+5IEfCu9AVLnfqqIAAAAAElFTkSuQmCC",blurWidth:8,blurHeight:8},tL={src:"https://cdn.oaistatic.com/_next/static/media/snow-3.42dc282c.png",height:96,width:96,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAARVBMVEVMaXHX19qprq7T09Lp5uLGx8inra/P2eOoqKLJycnT09R7qeGLr+XU191flu+2v8eQte2Iqtdgm/e/ytja2djJysra2dZ6ZAhlAAAAFXRSTlMAPThUG/ItAwqg7SL+xKH5dulF/s1gNdKhAAAACXBIWXMAACxLAAAsSwGlPZapAAAAPklEQVR4nB3LWxaAIAhAwauigNo72v9SO/U/A4oqgJLuZT8VSn+uuQ6kR93mMZAaEVEFkrt7+XTLuf3NzAxeSrAB7pNQq0AAAAAASUVORK5CYII=",blurWidth:8,blurHeight:8},tI={src:"https://cdn.oaistatic.com/_next/static/media/snow.27e603c5.png",height:96,width:96,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAAIVBMVEWKvv91qe52rfR0qfZ8tPRyp/ZuoPGLvPV3rvp/yP6exva+OpWMAAAAC3RSTlMBgUmRW2/IHIIcEb3m440AAAAJcEhZcwAALEsAACxLAaU9lqkAAAAqSURBVHicY2BAAHZGRnYQzcTMysrMxMDAwMLBxsbIgsyASzFwckAUQwEAEyUAjOcS3MEAAAAASUVORK5CYII=",blurWidth:8,blurHeight:8},tF={src:"https://cdn.oaistatic.com/_next/static/media/sunny.54f7a772.png",height:96,width:96,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAAHlBMVEVMaXHnoTvomSTwqz7tlCr1egj7jQr8nBH/pAH/jwA71PguAAAACHRSTlMAMwYsV7Surx5kgr8AAAAJcEhZcwAALEsAACxLAaU9lqkAAAAzSURBVHicJYtBDgAgCMO6AaL//7ARe1mTpQA2Q0gxm90ZYK29l4xV5zwhsupdIEk/m/wCFKYAjqDpHCYAAAAASUVORK5CYII=",blurWidth:8,blurHeight:8},tU={src:"https://cdn.oaistatic.com/_next/static/media/thunder.8e30f80f.png",height:96,width:96,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAASFBMVEVMaXHkpF3h4+X7kg7Y1dPo5+fm5OLi1M/r6ujHyMrR0tPs7Oy/Tw/e///Yup/tfynq8fraybPS19zm7PPq6uvv8PHoyKHu3c4+VufYAAAAFXRSTlMA/P79MLRCFjn0/m0QH9Oeb/z85dwRAbFkAAAACXBIWXMAACxLAAAsSwGlPZapAAAAP0lEQVR4nEWLMRaAIAzFPtDSFlFArd7/pj5cyJIlARbKrNP5cr8FyPEZZ2RBf1MoxTfsRwpmpoA0IpJZ13/+ADkMAZ7eCPGLAAAAAElFTkSuQmCC",blurWidth:8,blurHeight:8},tz={src:"https://cdn.oaistatic.com/_next/static/media/tornado.bfd2622d.png",height:96,width:96,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAAJFBMVEVMaXG2trK5ubm5urq0tbW7vL22ubm5ubm6u721traoqaqwsrJhMbhvAAAADHRSTlMAEF5+hj0eS3GSpi/6XL38AAAACXBIWXMAACxLAAAsSwGlPZapAAAAMklEQVR4nCWMQRIAIAiEWFez+v+Dm0YucAIQQ7i7F+jGDl9BHecJQGXnD6jMNbHH6A8eGNkAoYRlWWwAAAAASUVORK5CYII=",blurWidth:8,blurHeight:8},tq={src:"https://cdn.oaistatic.com/_next/static/media/windy.5508d183.png",height:96,width:96,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAATlBMVEVMaXHs6OXS1NT/9t7b3d52rOHe3Nnz8Oupxt/5//nH1urG1ObDyctyqd5qpt7K0tnf1Mnn4NiUuNyKsuJ3sem51/aLvPD9+fbt6OOlzPcR3mK9AAAAFXRSTlMAtFsfXfr+a/0Ot9N3j6VEeEL9+/7IYc79AAAACXBIWXMAACxLAAAsSwGlPZapAAAAPElEQVR4nGNgQABOdnZOMM0lKs7IwMDAzC0mzCHKzsDALskqxMohwcIgyCEmwsHGxsLAwM/DxyvAhNAMADqyAb96EAOJAAAAAElFTkSuQmCC",blurWidth:8,blurHeight:8};function tV(e,t){return"fahrenheit"===e?Math.round(9*t/5+32):Math.round((t-32)*5/9)}function tQ(e){let{weatherResults:t}=e,{daily:n,hourly:r}=t,s=n[0],a=n.map(e=>new Date(1e3*(e.timestamp+t.location.timezone))),l=(1===a.length||(0,ti.Z)(a[0]))&&null!==s.temperature.min&&null!==s.temperature.max?s:null;return(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)("div",{className:"mb-[--snc-1] flex items-center gap-4",children:[(0,I.jsxs)("div",{className:"flex-grow",children:[(0,I.jsx)("div",{className:"text-xl font-medium",children:(0,$.F)(t.location)}),(0,I.jsx)("div",{className:"text-token-text-tertiary",children:"".concat(function(e){let t=e.daily.map(t=>new Date(1e3*(t.timestamp+e.location.timezone)));return 1===t.length?tH(t[0]):(0,ti.Z)(t[0])?7==t.length?"This week":"Next ".concat(t.length," days"):"".concat(tH(t[0])," - ").concat(tH(t[t.length-1]))}(t))})]}),l&&(0,I.jsxs)("div",{className:"flex items-center gap-2",children:[(0,I.jsxs)("div",{className:"grid grid-cols-2 grid-rows-2 gap-x-2 text-left",children:[(0,I.jsx)("span",{className:"font-medium",children:"High"}),(0,I.jsx)("span",{children:"".concat(tV("fahrenheit",l.temperature.max),"\xb0F")}),(0,I.jsx)("span",{className:"font-medium",children:"Low"}),(0,I.jsx)("span",{children:"".concat(tV("fahrenheit",l.temperature.min),"\xb0F")})]}),(0,I.jsx)("div",{children:(0,I.jsx)(R(),{alt:l.description.description,src:tK(l.description.id).src,width:58,height:58})})]})]}),r.length>0&&(0,I.jsx)("div",{className:"no-scrollbar mb-4 flex gap-2 overflow-x-auto",children:r.map(e=>(0,I.jsx)(tB,{weatherData:e},e.timestamp))}),n.length>1&&(0,I.jsx)("div",{className:"flex flex-col gap-3",children:n.map((e,n)=>r.length>0&&0===n?null:(0,I.jsx)(tG,{weatherData:e,timezone:t.location.timezone},e.timestamp))})]})}function tB(e){let{weatherData:t}=e,n=t.description;return null===t.temperature.current||t.timestamp<Date.now()/1e3-3600?null:(0,I.jsxs)("div",{className:"flex min-w-[110px] flex-col items-center rounded-lg bg-token-main-surface-secondary py-2",children:[(0,I.jsx)(R(),{alt:n.description,src:tK(n.id).src,width:58,height:58}),(0,I.jsx)("div",{className:"mt-3 font-medium",children:function(e,t){let n=new Date(1e3*e+0);return(0,ts.Z)(n,"ha")}(t.timestamp,0)}),(0,I.jsx)("div",{className:"mt-1",children:" ".concat(tV("fahrenheit",t.temperature.current),"\xb0F")})]})}function tG(e){let{weatherData:t,timezone:n}=e,r=t.description,s=new Date(1e3*(t.timestamp+n));return null===t.temperature.min||null===t.temperature.max?null:(0,I.jsxs)("div",{className:"flex items-center gap-6",children:[(0,I.jsx)(R(),{alt:r.description,src:tK(r.id).src,width:58,height:58}),(0,I.jsxs)("div",{children:[(0,I.jsx)("div",{className:"font-medium",children:tH(s)}),(0,I.jsxs)("div",{children:[(0,I.jsx)("span",{className:"font-medium",children:"H:"})," ".concat(tV("fahrenheit",t.temperature.max),"\xb0F"),(0,I.jsx)("span",{className:"ml-2 font-medium",children:"L:"})," ".concat(tV("fahrenheit",t.temperature.min),"\xb0F")]})]})]},t.timestamp)}function tH(e){return(0,ti.Z)(e)?"Today":(0,t_.Z)(e)?"Tomorrow":e.getTime()-Date.now()<5184e5?(0,ts.Z)(e,"EEEE"):(0,ts.Z)(e,"EEEE, MMMM do")}function tK(e){if(e>=200&&e<300)return 211===e||212===e||221===e?tU:tT;if(e>=300&&e<500)return e>=300&&e<=311?tR:tZ;if(e>=500&&e<600)return e>=500&&e<=504?tR:511===e?tL:tM;if(e>=600&&e<700)return 612===e||613===e?tL:tI;if(e>=700&&e<800)return 701===e||741===e?tE:771===e?tq:781===e?tz:tP;if(e>=800&&e<900){if(800===e)return tF;if(801===e)return tD;if(802===e)return tC}return tS}function tW(e){let{widget:t}=e;switch(null==t?void 0:t.type){case"finance":return(0,I.jsx)(tr,{data:t.data});case"sports-standings":return(0,I.jsx)(tv,{data:t.data});case"sports-schedule":return(0,I.jsx)(tm,{data:t.data});case"time-difference":return(0,I.jsx)(tN,{data:t.data});case"calculator":return(0,I.jsx)(tn,{data:t.data});case"news":return(0,I.jsx)(ta,{data:t.data});case"weather":return(0,I.jsx)(tQ,{weatherResults:t.data});default:return null}}function tX(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function tY(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?tX(Object(n),!0).forEach(function(t){(0,es.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):tX(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let tJ=e=>{let{children:t,className:n}=e;return(0,I.jsx)("div",{className:(0,w.default)("gizmo-shadow-stroke flex h-[24px] w-[24px] flex-shrink-0 items-center justify-center overflow-hidden rounded-full",n),children:t})};function t$(e){var t;let{onRetryQuery:n,highlightTurnIndex:r,onSubmitClickableFollowup:s}=e,a=(0,J.nn)(J.LW.turns),l=(0,J.nn)(J.LW.firstTurn);return null!=l&&ee(l)?(0,I.jsx)(t8,{onRetryClick:n}):(0,I.jsx)("div",{className:"flex w-full flex-col gap-[--snc-1] p-[--snc-2]",children:null!=l&&((null===(t=l.model_response)||void 0===t?void 0:t.text)!=null||null!=(0,$.K)(l))?a.map((e,t)=>(0,I.jsx)(t0,{turn:e,isHighlighted:e.index===r,onRetryQuery:n,onSubmitClickableFollowup:s},t)):(0,I.jsx)(t2,{})})}function t0(e){let{turn:t,isHighlighted:n,onRetryQuery:r,onSubmitClickableFollowup:s}=e;if(null===t.index)throw Error();return(0,I.jsxs)(I.Fragment,{children:[t.index>0&&(0,I.jsx)(t1,{text:t.user_query}),ee(t)?(0,I.jsx)(t5,{text:"Something went wrong. Please try again.",canRetry:!0,onRetry:()=>r(t.user_query)}):(0,I.jsx)(t3,{turn:t,isHighlighted:n,onSubmitClickableFollowup:s})]})}function t1(e){let{text:t}=e;return(0,I.jsx)("div",{className:"text-bubble flex-end inline-flex items-end justify-end gap-4",children:(0,I.jsx)("div",{className:"max-w-[calc(100%-80px)] rounded-3xl rounded-br-lg bg-token-main-surface-tertiary px-5 py-2.5",children:(0,I.jsx)(t4,{text:t})})})}function t2(){return(0,I.jsx)("div",{children:(0,I.jsx)(te.H,{lines:6,variance:3})})}function t5(e){let{text:t,onRetry:n,canRetry:r}=e;return(0,I.jsx)("div",{children:(0,I.jsx)(e$.Z,{type:"danger",className:"my-0 border border-token-border-light bg-transparent text-token-text-secondary",iconClassName:"text-red-500",children:(0,I.jsxs)("div",{className:"flex w-full items-center justify-between text-red-500",children:[t,r&&(0,I.jsx)("button",{onClick:()=>n(),className:"red-500 font-medium text-token-text-primary",children:"Retry"})]})})})}function t3(e){var t,n,r,s,a,l,i,o;let{turn:c,isHighlighted:u,onSubmitClickableFollowup:d}=e;if(null===c.index)throw Error();let m=(0,M.useRef)(null),p=(0,J.nn)(J.LW.threadId),h=null!==(t=null===(n=c.model_response)||void 0===n?void 0:n.text)&&void 0!==t?t:"",{text:f,displayedCitations:g}=(0,e1.vC)(h,(null!==(i=null===(o=c.model_response)||void 0===o?void 0:o.citations)&&void 0!==i?i:[]).filter(et).map(e=>({start_ix:e.start_idx,end_ix:e.end_idx,citation_format_type:"tether_og",metadata:{title:e.title,url:e.url,type:"webpage"}}))),x=null!==(r=null===(s=c.model_response)||void 0===s||null===(s=s.citations)||void 0===s?void 0:s.filter(en))&&void 0!==r?r:[],v=c.index>0,b=1===c.index,j=(0,$.K)(c),A="in_progress"===c.execution_status||null===c.execution_status,O=(0,eb.u)(g.reduce((e,t)=>{var n,r;return t.type===e1.Zn.Standard&&(null===(n=t.metadata)||void 0===n?void 0:n.type)!=="file"&&(null===(r=t.metadata)||void 0===r?void 0:r.url)!=null?[...e,t.metadata.url]:e},[]));return(0,M.useEffect)(()=>{u&&m.current&&m.current.scrollIntoView({behavior:"smooth",block:"start"})},[u]),(0,I.jsxs)(I.Fragment,{children:[(0,I.jsxs)("div",{ref:m,className:(0,w.default)("flex flex-col gap-[--snc-1]",{"-mx-2 rounded-md bg-yellow-100 px-2 py-4 dark:bg-yellow-900":u}),children:[null!=j&&(0,I.jsx)("div",{className:(0,w.default)("mb-[--snc-2] pb-[--snc-1]",!(null!==(a=j.displayOptions)&&void 0!==a&&a.hideDivider)&&"border-b border-token-border-medium "),children:(0,I.jsx)(tW,{widget:j})}),(null===(l=c.model_response)||void 0===l?void 0:l.tldr)&&(0,I.jsx)("div",{className:"border-b-[0.5px] border-black/20 pb-[--snc-1]",children:(0,I.jsx)(tt,{tldr:c.model_response.tldr})}),(0,I.jsxs)("div",{className:"inline-flex w-full gap-4",children:[v&&(0,I.jsx)(tJ,{className:"mt-[1px]",children:(0,I.jsx)(y.nI,{className:"h-[14px] w-[14px]"})}),(0,I.jsxs)("div",{className:"w-full",children:[(0,I.jsx)(e6,{images:x,children:(0,I.jsx)(e1.h7.Provider,{value:{clientThreadId:eJ.Zq,displayType:e1.QU.expandAll,displayedCitations:g,isActivelyStreaming:A,message:{id:"",author:{role:eJ.uU.Assistant,name:"Search"},content:{content_type:eJ.PX.Text,parts:[h]}},attributions:O,onCitationClicked:e=>{if(null===c.index)throw Error();p&&"webpage"===e.type&&e_.Y.logEvent(e_.M.searchCitationClicked,{thread_id:p,url:e.url,title:e.title,pub_date:e.pub_date,turn_index:c.index})},onCitationHovered:e=>{if(null===c.index)throw Error();p&&"webpage"===e.type&&e_.Y.logEvent(e_.M.searchCitationHovered,{thread_id:p,url:e.url,title:e.title,pub_date:e.pub_date,turn_index:c.index})}},children:(0,I.jsx)(t4,{text:f,onSubmitClickableFollowup:d,isActivelyStreaming:A})})}),!A&&(0,I.jsx)(eM,{turn:c})]})]})]}),b&&(0,I.jsx)(e$.Z,{type:"info",dismissible:!0,className:"border border-token-border-light",children:"Follow ups aren't great yet. Please rate poor responses."})]})}function t4(e){let{text:t,onSubmitClickableFollowup:n,isActivelyStreaming:r=!1}=e;return(0,I.jsx)(t6,{className:(0,w.default)("relative text-token-text-primary",""===t&&r&&"result-thinking",r&&"result-streaming"),onSubmitClickableFollowup:n,children:t})}function t6(e){let{size:t="medium",children:n,className:r,onSubmitClickableFollowup:s}=e,{resolvedTheme:a}=(0,S.F)(),l=(0,M.useMemo)(()=>tY(tY({},e0.ff),{},{a:e=>{let{href:t,children:n}=e;if(void 0===s)throw Error();if(t&&/^turn[0-9]+cfs[0-9]+$/.test(t)){if(1!==n.length)throw Error();let e=n[0];if("string"!=typeof e)throw Error();return(0,I.jsx)("button",{className:"-my-[999px] rounded-md border-[1px] border-blue-500 px-1 text-blue-500",onClick:()=>s(e),children:n})}return(0,I.jsx)("a",{href:t?(0,e0.H)(t):void 0,className:"text-blue-500 underline",children:n})},ol:e=>{let{start:t=1,children:n}=e;return(0,I.jsx)("ol",{children:M.Children.map(n,(e,n)=>{if((0,M.isValidElement)(e)){let r=e.props.children;return(0,I.jsxs)("li",{children:[(0,I.jsxs)("span",{className:"mr-2 text-token-text-secondary",children:[t+n,"."]}),r]},n)}return e})})}}),[s]);return(0,I.jsx)(e2.S,{name:"formatted_text_error",fallback:()=>(0,I.jsx)(I.Fragment,{children:n}),children:(0,I.jsx)(e5.D,{rehypePlugins:e0.Yu,remarkPlugins:e0.Hf,linkTarget:"_new",className:(0,w.default)(r,"prose w-full break-words dark:prose-invert","dark"===a?"dark":"light","small"===t&&"prose-xs"),transformLinkUri:e0.H,components:l,children:n})})}function t8(e){let{onRetryClick:t}=e;return(0,I.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,I.jsxs)("button",{className:"flex h-24 w-24 flex-col items-center justify-center gap-2 rounded-full hover:bg-token-main-surface-secondary",onClick:()=>t(),children:[(0,I.jsx)(N.muB,{className:"flex-shrink-0"}),"Retry"]})})}function t7(e){var t,n;let{readyState:r,hasSubmittedInitialQuery:s,searchQuery:a,followupQuery:l,onUpdateSearchQuery:i,onUpdateFollowupQuery:o,onSubmitSearch:c,onSubmitFollowup:u,followupInputRef:d,settings:m,onReset:p,onUpdateSetting:h,onRetryQuery:f,highlightUrl:g,highlightTurnIndex:x}=e,v=(0,J.nn)(J.LW.firstTurn),b=null!=v&&ee(v);if((null==v?void 0:v.index)===null)throw Error();return(0,I.jsxs)("div",{className:"wrapper",children:[(0,I.jsxs)("div",{className:"content-wrapper",children:[(0,I.jsxs)("header",{className:"flex h-[--snc-header-height] flex-shrink-0 items-center",children:[(0,I.jsx)("div",{className:"hidden w-[--snc-4] flex-shrink-0 items-center justify-center snc-lg:flex",children:(0,I.jsx)("button",{onClick:()=>p(),className:"hover:text-token-text-secondary",children:(0,I.jsx)(y.nI,{className:"icon-2xl"})})}),(0,I.jsxs)(t9,{className:"main-column flex",children:[(0,I.jsx)(K,{currentQuery:a,onUpdateCurrentQuery:i,onSubmit:c}),(0,I.jsx)(W._,{readyState:r})]})]}),(0,I.jsxs)("main",{className:"flex",children:[(0,I.jsx)("div",{className:"platform-nav",children:(0,I.jsx)(eh,{settings:m,onUpdateSettings:h})}),(0,I.jsxs)(t9,{className:"main-column",children:[(0,I.jsx)("div",{className:(0,w.default)("messages-body hide-scrollbar shadow-snc-lg dark:bg-token-main-surface-tertiary dark:shadow-none",!b&&"pb-[150px]"),children:(0,I.jsx)(t$,{onRetryQuery:f,highlightTurnIndex:x,onSubmitClickableFollowup:u})}),(0,I.jsx)("div",{className:"followup-input",children:(0,I.jsx)(er,{readyState:r,hasSubmittedInitialQuery:s,currentQuery:l,onUpdateCurrentQuery:o,onSubmit:u,ref:d})})]})]})]}),(0,I.jsx)("aside",{className:"links-body hide-scrollbar",children:(0,I.jsx)(eY,{searchResults:null!==(t=null==v||null===(n=v.search_results)||void 0===n?void 0:n.entries)&&void 0!==t?t:[],highlightUrl:g,turnIndex:null==v?void 0:v.index})}),(0,I.jsx)("nav",{className:"pointer-events-none fixed right-[--snc-2] flex h-[--snc-header-height] items-center justify-center snc-md:right-[--snc-3]",children:(0,I.jsx)(V,{iconSize:"gizmo",className:"pointer-events-auto shadow-lg",searchQuery:a})})]})}let t9=A.Z.div(b||(b=(0,j.Z)(["snc-md:ml-[--snc-4] snc-lg:ml-0"])))},75388:function(e,t,n){"use strict";n.d(t,{_:function(){return c}});var r=n(11335),s=n(19841),a=n(70079),l=n(15118),i=n(35250);let o={[l.kQ.CONNECTING]:"Connecting",[l.kQ.OPEN]:"Open",[l.kQ.CLOSING]:"Closing",[l.kQ.CLOSED]:"Closed",[l.kQ.UNINSTANTIATED]:"Uninstantiated"};function c(e){let{readyState:t,className:n}=e,{0:c,1:u}=(0,a.useState)(!0);return((0,a.useEffect)(()=>{setTimeout(()=>{u(!0)},1e3)},[]),t!==l.kQ.OPEN&&c)?(0,i.jsx)("div",{className:(0,s.default)("flex items-center gap-2 px-3 text-sm",n),children:(0,i.jsx)(r.u,{label:o[t],sideOffset:0,side:"right",children:(0,i.jsx)("div",{className:(0,s.default)("h-2 w-2 rounded-full",(t===l.kQ.CLOSING||t===l.kQ.CONNECTING)&&"bg-yellow-500",(t===l.kQ.CLOSED||t===l.kQ.UNINSTANTIATED)&&"bg-red-500",c?"block":"hidden")})})}):null}},25617:function(e,t,n){"use strict";n.d(t,{R:function(){return b},q:function(){return j}});var r=n(29287),s=n(8700),a=n(67217),l=n(13847),i=n(19841),o=n(51018),c=n.n(o),u=n(70079),d=n(1454),m=n(78343),p=n(78103),h=n(35601),f=n(19216),g=n(20963),x=n(35250);let v=c()(()=>Promise.all([n.e(1170),n.e(7178)]).then(n.bind(n,17178)).then(e=>e.default),{ssr:!1,loadableGenerated:{webpack:()=>[17178]}}),b=(0,p.ZP)(e=>({threadUserId:void 0,setThreadUserId:t=>e({threadUserId:t})}));function j(e){let{isOpen:t,onDebugClose:n}=e;return(0,x.jsx)(a.Z,{isOpen:t,onClose:n,type:"success",size:"fullscreen",className:"min-h-[50vh] max-w-[96vw]",rootClassName:"z-50",children:(0,x.jsx)(A,{})})}let y=(e,t)=>{let n=JSON.stringify(t,null,2),r=new Blob([n],{type:"application/json"}),s=window.URL.createObjectURL(r),a=document.createElement("a");a.href=s,a.download=e,a.click(),window.URL.revokeObjectURL(s)};function w(e){let{downloadFilename:t,downloadData:n}=e,{user:s}=(0,h.A)();return(0,x.jsxs)("div",{className:"flex justify-center gap-2",children:[s&&(0,x.jsx)(k,{id:s.id}),(0,x.jsxs)(r.z,{color:"neutral",onClick:()=>y(t,n),children:[(0,x.jsx)(d._hL,{className:"icon-sm"})," Download ",t]}),(0,x.jsxs)(r.z,{color:"neutral",as:"link",to:"https://openai.enterprise.slack.com/archives/C06D0FATXSQ",openNewTab:!0,children:[(0,x.jsx)(d.nY6,{className:"icon-sm"})," Give feedback"]})]})}function A(){let e=(0,f.nn)(f.LW.threadId),t=(0,f.nn)(f.LW.turns),{threadUserId:n}=b(),{data:r,isLoading:s}=(0,g.Y)({threadId:e,threadUserId:n,refetchOnMount:"always"});if(!r||s)return(0,x.jsx)("div",{children:"Loading..."});let{thread:a}=r;return(0,x.jsxs)("div",{className:"flex flex-col gap-2 break-words py-6 font-mono text-xs",children:[(0,x.jsx)(w,{downloadFilename:"thread.json",downloadData:a}),(0,x.jsx)("div",{className:"px-6 pb-6",children:(0,x.jsx)(O,{data:a,collapsed:3})}),t.map((e,t)=>{var n;return(0,x.jsxs)("div",{className:(0,i.default)("flex flex-col gap-1 p-6",e.index%2==0&&"bg-token-main-surface-tertiary"),children:[(0,x.jsxs)("div",{children:[(0,x.jsx)("span",{className:"font-semibold",children:"[user]"})," ",e.user_query]}),(0,x.jsxs)("div",{children:[(0,x.jsx)("span",{className:"font-semibold",children:"[model]"})," ",null===(n=e.model_response)||void 0===n?void 0:n.text]}),(0,x.jsx)("div",{className:"mt-2",children:(0,x.jsx)(O,{data:e})})]},t)})]})}function O(e){let{data:t,collapsed:n}=e,{0:r,1:s}=(0,u.useState)(null==n||n);return(0,x.jsxs)("div",{className:"flex flex-col items-start gap-1",children:[(0,x.jsx)("button",{onClick:()=>s(!r),className:"flex items-center gap-1",children:r?(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(m.rIY,{size:14})," Expand all"]}):(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(m.NsE,{size:14})," Collapse all"]})}),(0,x.jsx)(v,{json:t,jsonViewProps:{collapsed:r,shortenTextAfterLength:0}},String(r))]})}function k(e){let{id:t}=e,n=(0,u.useCallback)(()=>{(0,l.v)(t)},[t]);return(0,x.jsxs)("p",{className:"flex items-center gap-2",children:[(0,x.jsx)("span",{className:"font-semibold",children:"User ID:"}),(0,x.jsx)("span",{className:"text-gray-500 dark:text-white",children:t}),(0,x.jsx)(s.Z,{onCopy:n})]})}},45062:function(e,t,n){"use strict";n.d(t,{X:function(){return p}});var r=n(18450),s=n(67739),a=n(77799),l=n(8143),i=n(19841),o=n(70079),c=n(35250);let u=["value","onSubmit","keyEventFilter","className","buttonIcon","onFocus","onBlur","onKeyDown","overflowDirection","overflowFloat","disabled","searchIcon"];function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function m(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let p=(0,o.forwardRef)(function(e,t){let{value:n,onSubmit:r,keyEventFilter:d,className:p,buttonIcon:h,onFocus:f,onBlur:g,onKeyDown:x,overflowDirection:v,overflowFloat:b,disabled:j,searchIcon:y}=e,w=(0,s.Z)(e,u),A=(0,o.useRef)(null),O=null!=t?t:A,[k]=(0,l.f)(null!=t?t:A),N=(0,o.useCallback)(e=>{null==x||x(e),"Enter"===e.key&&r&&(e.preventDefault(),r(n))},[x,r,n]);(0,o.useEffect)(()=>{if(null!=d)return(0,a.eR)(document,{keydown:e=>{null!=d&&d(e)&&(e.preventDefault(),null==k||k.focus(),null==k||k.select())}})},[d,k]);let{0:_,1:S}=(0,o.useState)(!1),{0:P,1:E}=(0,o.useState)(0),{0:C,1:D}=(0,o.useState)(0),R=(0,o.useCallback)(()=>{if(!k)return;let e=k.style.height,t=k.value,n=k.selectionStart,r=k.selectionEnd;k.style.height="0px",k.value="",D(k.scrollHeight),k.value=t,k.selectionStart=n,k.selectionEnd=r,E(k.scrollHeight),k.style.height=e},[k]);(0,o.useEffect)(()=>(0,a.eR)(window,{resize:R}),[R]),(0,o.useEffect)(()=>{R()},[k,n,R]);let M=n.trim().length>0;return(0,c.jsx)("div",{className:(0,i.default)("relative",b&&"h-12"),children:(0,c.jsxs)("div",{className:(0,i.default)("left-0 right-0 flex h-fit min-h-[3rem] w-full gap-3 overflow-hidden rounded-[1.5rem] bg-token-main-surface-tertiary px-3",b?"absolute":"inherit","up"===v?"bottom-0 items-end":v?"top-0 items-start":"bottom-0 top-0 items-center",p),onClick:()=>{null==k||k.focus(),S(!0),null==f||f()},children:[(0,c.jsx)("div",{className:(0,i.default)("flex-grow overflow-x-hidden","py-[0.66rem]"),children:(0,c.jsx)("textarea",m(m({type:"text",name:"query",id:"query"},w),{},{className:(0,i.default)("transition-height ellipsis m-0 w-full min-w-32 flex-shrink-0 flex-grow resize-none overflow-hidden overflow-y-auto border-0 bg-transparent p-0 placeholder-gray-500 outline-none focus:ring-0",(!_||P<480)&&"hide-scrollbar","up"===v?"-mb-1":"-mb-2 snc-2xl:mb-[-0.4375rem]",y?"pl-11":"pl-2"),onKeyDown:N,value:n,autoComplete:"off",onFocus:()=>{S(!0),null==f||f()},onBlur:()=>{k&&(k.scrollTop=0),S(!1),null==g||g()},ref:O,disabled:j,style:{height:_&&null!=v?"clamp(".concat(C,"px, ").concat(P,"px, ").concat(480,"px)"):"".concat(C,"px")}}))}),(0,c.jsx)("div",{className:"flex h-12 flex-shrink-0 items-center",children:M||null!=r?(0,c.jsx)("div",{className:"flex items-center",children:(0,c.jsx)("button",{disabled:j,onClick:()=>null==r?void 0:r(n),className:(0,i.default)("flex h-7 w-7 items-center justify-center rounded-full",M&&!j?"bg-token-text-primary text-token-main-surface-primary hover:opacity-80":"bg-gray-300 text-token-main-surface-tertiary hover:bg-token-border-light hover:text-token-text-secondary disabled:hover:bg-token-main-surface-tertiary disabled:hover:text-token-text-tertiary dark:bg-gray-700"),children:h})}):null}),y&&(0,c.jsx)("div",{className:(0,i.default)("absolute left-5 flex h-12 items-center justify-center","up"===v?"bottom-0":"top-0"),children:y})]})})})},82074:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return g}});var r=n(29287),s=n(21643),a=n(26169),l=n.n(a),i=n(91530),o=n.n(i),c=n(70079),u=n(57670),d=n(20735),m=n(19216),p=n(72150),h=n(45456),f=n(35250);function g(){(0,h.e)();let[e,t]=(0,p.Z)("MACHINE_OUTPUT_PATH","",l()),{0:n,1:a}=(0,c.useState)({}),i=async()=>{let t=await fetch("http://localhost:9000/scandir?path=".concat(e)),n=await t.json();console.log("fetched machine outputs",n),a(n)},[g,x]=(0,p.Z)("MACHINE_OUTPUT_FILE_PATH","",l()),{0:v,1:b}=(0,c.useState)([]),j=async()=>{let e=await fetch("http://localhost:9000/read?path=".concat(g)),t=await e.text();console.log("fetched machine output file content",t);let n=t.split("\n"),r=[];for(let e of n)e&&r.push(JSON.parse(e));console.log("fetched machine output file content",r),b(r)},{0:y,1:w}=(0,c.useState)(0);(0,c.useEffect)(()=>{let e=v[y];if(!e)return;let t=e.api_thread,n=e.turns.map(e=>e.api_turn);m.P3.setThread(t.id,n)},[v,y]);let A=(0,m.nn)(m.LW.turns),O=A.length>0?A[0].user_query:"";return(0,f.jsxs)("div",{className:"flex h-screen w-screen flex-row",children:[(0,f.jsxs)("div",{className:"flex w-[400px] flex-col gap-2 border-r-[1px] p-2",children:[(0,f.jsx)(s.Z,{name:"machineOutputPath",value:e,placeholder:"Machine output path",onChange:e=>t(e.target.value),className:"hidden"}),(0,f.jsx)(r.z,{onClick:i,className:"hidden",children:"Refresh machine outputs"}),(0,f.jsx)(s.Z,{name:"machineOutputFilePath",value:g,placeholder:"Machine output file path",onChange:e=>x(e.target.value)}),(0,f.jsx)(r.z,{onClick:j,children:"Refresh machine output file"}),(0,f.jsxs)("div",{className:"flex flex-row items-baseline gap-2",children:[(0,f.jsx)(s.Z,{name:"index",value:y.toString(),placeholder:"Index",type:"number",onChange:e=>w(parseInt(e.target.value))}),(0,f.jsxs)("div",{children:["of ",v.length]})]})]}),(0,f.jsx)(u.e,{readyState:1,hasSubmittedInitialQuery:!0,searchQuery:O,followupQuery:"",onUpdateSearchQuery:o(),onUpdateFollowupQuery:o(),onSubmitFollowup:o(),onSubmitSearch:o(),settings:d.Z,onUpdateSetting:o(),onReset:o(),onRetryQuery:o()})]})}},75138:function(e,t,n){"use strict";n.d(t,{H:function(){return c},l:function(){return o}});var r=n(42607),s=n(19841),a=n(83737),l=n(70079),i=n(35250);function o(e){let{lines:t=1,variance:n=0,size:o="base",width:c=50,widthVariance:u=50,className:d}=e,{0:m}=(0,l.useState)(Array.from({length:t+Math.random()*(null!=n?n:0)},()=>c+Math.random()*u)),p="";switch(o){case"sm":p="h-3 mb-2 mt-0.5";break;case"base":p="h-[18px] my-2";break;case"lg":p="h-5 my-2";break;default:(0,r.Z)(o)}return(0,i.jsx)(i.Fragment,{children:m.map((e,t)=>(0,i.jsx)("div",{className:(0,s.default)("relative w-full overflow-hidden rounded-md bg-token-sidebar-surface-secondary",p,d),style:{width:"".concat(e,"%")},children:(0,i.jsx)(a.E.div,{className:"absolute left-0 top-0 h-full w-full rotate-45 bg-gradient-to-r from-transparent via-black/20 to-transparent opacity-50 dark:via-white/5",animate:{x:["-100%","100%"],opacity:[1,0,1],transition:{repeat:1/0,repeatType:"loop",duration:1.5+t}}})},t))})}function c(e){let{lines:t=1,variance:n=0,width:r=50,widthVariance:s=50,className:o}=e,c=l.useMemo(()=>Array.from({length:t+Math.random()*(null!=n?n:0)},()=>r+Math.random()*s),[t,n,r,s]);return(0,i.jsx)("div",{className:"mt-2 flex flex-col items-start gap-2 ".concat(o),children:c.map((e,t)=>(0,i.jsx)(a.E.div,{className:"h-[18px] rounded-md bg-token-border-light",style:{width:"".concat(e,"%")},initial:{opacity:1},animate:{opacity:[1,.4]},transition:{repeat:1/0,repeatType:"reverse",duration:.85,ease:"easeInOut",delay:.07*t}},t))})}},35601:function(e,t,n){"use strict";n.d(t,{A:function(){return l},c:function(){return a}});var r=n(70079),s=n(20735);let a=(0,r.createContext)({searchQuery:"",user:null,userHash:null,settings:s.Z,userMetadata:{cf_connecting_ip:null,ip_city:null,time_zone:null,user_country:null,user_locale:null,user_region:null,user_region_code:null,latitude:null,longitude:null,locationAccuracy:null}}),l=()=>(0,r.useContext)(a)},20735:function(e,t,n){"use strict";n.d(t,{Wt:function(){return A},Z:function(){return w},Zr:function(){return N}});var r,s=n(99945),a=n(18450),l=n(67739),i=n(29287),o=n(21643),c=n(282),u=n(88342),d=n(67217),m=n(64276),p=n(19841),h=n(85252),f=n(21389),g=n(20724),x=n(90240),v=n(35250);let b=["children"];function j(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?j(Object(n),!0).forEach(function(t){(0,a.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):j(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let w={useLocation:!1,suggestions:!0,agentSettingsOverrides:{model_family:g.tQ.GPT_3_5,rerank_labrador:"none",rerank_bing_boost:0,rerank_quality_threshold:4.5,search_engine:g.lv.Bing,robots_mode:g.K1.Aggressive,show_image_to_model:!0}};function A(e){return!!("object"==typeof e&&"boolean"==typeof e.useLocation&&"boolean"==typeof e.suggestions&&(0,g.mX)(e.agentSettingsOverrides))}function O(e){if(""!==e)return parseFloat(e)}function k(e){let{children:t}=e,n=(0,l.Z)(e,b);return(0,v.jsx)(u.Z.Content,y(y({},n),{},{className:(0,p.default)("z-50",n.className),children:t}))}function N(e){var t,n,r,s,a,l,p,f,b,j,A,N,S,P;let{onClose:E,settings:C,onUpdateSetting:D}=e,{theme:R,setTheme:M}=(0,h.F)();return(0,v.jsx)(d.Z,{isOpen:!0,onClose:E,type:"success",rootClassName:"z-40",children:(0,v.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,v.jsxs)(_,{children:[(0,v.jsx)(m._,{htmlFor:"theme",className:"text-sm",children:"Theme"}),(0,v.jsxs)(u.Z.Root,{value:R,onValueChange:e=>{e!==R&&M(e)},children:[(0,v.jsxs)(u.Z.Trigger,{id:"theme",children:[(0,v.jsx)(u.Z.Value,{}),(0,v.jsx)(u.Z.Icon,{})]}),(0,v.jsx)(u.Z.Portal,{children:(0,v.jsxs)(k,{children:[(0,v.jsx)(u.Z.Item,{value:"light",children:"Light"}),(0,v.jsx)(u.Z.Item,{value:"dark",children:"Dark"}),(0,v.jsx)(u.Z.Item,{value:"system",children:"System"})]})})]})]}),(0,v.jsxs)(_,{children:[(0,v.jsx)(m._,{htmlFor:"location",className:"text-sm",children:"Use location from browser"}),(0,v.jsx)(c.Z,{onChange:e=>{(0,x.XB)(e),D(y(y({},C),{},{useLocation:e}))},enabled:C.useLocation,label:"Use location from browser"})]}),(0,v.jsxs)(_,{children:[(0,v.jsx)(m._,{htmlFor:"suggestions",className:"text-sm",children:"Enable suggestions"}),(0,v.jsx)(c.Z,{onChange:e=>D(y(y({},C),{},{suggestions:e})),enabled:C.suggestions,label:"Enable suggestions"})]}),(0,v.jsxs)(_,{children:[(0,v.jsx)(m._,{htmlFor:"ranker_model",className:"text-sm",children:"Model family"}),(0,v.jsxs)(u.Z.Root,{value:null!==(t=null===(n=C.agentSettingsOverrides)||void 0===n?void 0:n.model_family)&&void 0!==t?t:w.agentSettingsOverrides.model_family,onValueChange:e=>{D(y(y({},C),{},{agentSettingsOverrides:y(y({},C.agentSettingsOverrides),{},{model_family:e})}))},children:[(0,v.jsxs)(u.Z.Trigger,{id:"model_family",children:[(0,v.jsx)(u.Z.Value,{}),(0,v.jsx)(u.Z.Icon,{})]}),(0,v.jsx)(u.Z.Portal,{children:(0,v.jsxs)(k,{children:[(0,v.jsx)(u.Z.Item,{value:g.tQ.GPT_3_5,children:"GPT3.5 (Sahara; POR)"}),(0,v.jsx)(u.Z.Item,{value:g.tQ.GPT_4,children:"GPT4"})]})})]})]}),(0,v.jsxs)(_,{children:[(0,v.jsx)(m._,{htmlFor:"search_engine",className:"text-sm",children:"Search engine"}),(0,v.jsxs)(u.Z.Root,{value:null!==(r=null===(s=C.agentSettingsOverrides)||void 0===s?void 0:s.search_engine)&&void 0!==r?r:w.agentSettingsOverrides.search_engine,onValueChange:e=>{D(y(y({},C),{},{agentSettingsOverrides:y(y({},C.agentSettingsOverrides),{},{search_engine:e})}))},children:[(0,v.jsxs)(u.Z.Trigger,{id:"search_engine",children:[(0,v.jsx)(u.Z.Value,{}),(0,v.jsx)(u.Z.Icon,{})]}),(0,v.jsx)(u.Z.Portal,{children:(0,v.jsxs)(k,{children:[(0,v.jsx)(u.Z.Item,{value:g.lv.Bing,children:"Bing (POR)"}),(0,v.jsx)(u.Z.Item,{value:g.lv.Sydney,children:"Sydney"}),(0,v.jsx)(u.Z.Item,{value:g.lv.Fortis,children:"Fortis"})]})})]})]}),(0,v.jsxs)(_,{children:[(0,v.jsx)(m._,{htmlFor:"robots_mode",className:"text-sm",children:"Robots mode"}),(0,v.jsxs)(u.Z.Root,{value:null!==(a=null===(l=C.agentSettingsOverrides)||void 0===l?void 0:l.robots_mode)&&void 0!==a?a:w.agentSettingsOverrides.robots_mode,onValueChange:e=>{D(y(y({},C),{},{agentSettingsOverrides:y(y({},C.agentSettingsOverrides),{},{robots_mode:e})}))},children:[(0,v.jsxs)(u.Z.Trigger,{id:"robots_mode",children:[(0,v.jsx)(u.Z.Value,{}),(0,v.jsx)(u.Z.Icon,{})]}),(0,v.jsx)(u.Z.Portal,{children:(0,v.jsxs)(k,{children:[(0,v.jsx)(u.Z.Item,{value:g.K1.Conservative,children:"Conservative"}),(0,v.jsx)(u.Z.Item,{value:g.K1.Aggressive,children:"Aggressive (POR)"})]})})]})]}),(0,v.jsxs)(_,{children:[(0,v.jsx)(m._,{htmlFor:"ranker_model",className:"text-sm",children:"Ranker model"}),(0,v.jsxs)(u.Z.Root,{value:null!==(p=null===(f=C.agentSettingsOverrides)||void 0===f?void 0:f.rerank_labrador)&&void 0!==p?p:"none",onValueChange:e=>{D(y(y({},C),{},{agentSettingsOverrides:y(y({},C.agentSettingsOverrides),{},{rerank_labrador:e})}))},children:[(0,v.jsxs)(u.Z.Trigger,{id:"ranker_model",children:[(0,v.jsx)(u.Z.Value,{}),(0,v.jsx)(u.Z.Icon,{})]}),(0,v.jsx)(u.Z.Portal,{children:(0,v.jsxs)(k,{children:[(0,v.jsx)(u.Z.Item,{value:"none",children:"Disabled (POR)"}),(0,v.jsx)(u.Z.Item,{value:"maraschino-rr-d32-latest",children:"d32ult (latest)"}),(0,v.jsx)(u.Z.Item,{value:"maraschino-rr-d32-rc",children:"d32ult (release candidate)"})]})})]})]}),(0,v.jsxs)(_,{className:"".concat("none"===C.agentSettingsOverrides.rerank_labrador?"text-gray-400":""),children:[(0,v.jsx)(m._,{htmlFor:"rerank_bing_boost",className:"text-sm",children:"Ranker Bing boost"}),(0,v.jsx)(o.Z,{name:"rerank_bing_boost",className:"w-16",disabled:"none"===C.agentSettingsOverrides.rerank_labrador,value:null!==(b=null===(j=C.agentSettingsOverrides.rerank_bing_boost)||void 0===j?void 0:j.toString())&&void 0!==b?b:"",onChange:e=>D(y(y({},C),{},{agentSettingsOverrides:y(y({},C.agentSettingsOverrides),{},{rerank_bing_boost:O(e.target.value)})})),placeholder:"0.0",type:"number"})]}),(0,v.jsxs)(_,{className:"".concat("none"===C.agentSettingsOverrides.rerank_labrador?"text-gray-400":""),children:[(0,v.jsx)(m._,{htmlFor:"rerank_quality_threshold",className:"text-sm",children:"Minimum ranker model score"}),(0,v.jsx)(o.Z,{name:"rerank_quality_threshold",className:"w-16",disabled:"none"===C.agentSettingsOverrides.rerank_labrador,value:null!==(A=null===(N=C.agentSettingsOverrides.rerank_quality_threshold)||void 0===N?void 0:N.toString())&&void 0!==A?A:"",onChange:e=>D(y(y({},C),{},{agentSettingsOverrides:y(y({},C.agentSettingsOverrides),{},{rerank_quality_threshold:O(e.target.value)})})),placeholder:"0.0",type:"number"})]}),(0,v.jsxs)(_,{children:[(0,v.jsx)(m._,{htmlFor:"show_image_to_model",className:"text-sm",children:"Show image to model"}),(0,v.jsx)(c.Z,{onChange:e=>D(y(y({},C),{},{agentSettingsOverrides:y(y({},C.agentSettingsOverrides),{},{show_image_to_model:e})})),enabled:null!==(S=null===(P=C.agentSettingsOverrides)||void 0===P?void 0:P.show_image_to_model)&&void 0!==S?S:w.agentSettingsOverrides.show_image_to_model,label:"Show image to model"})]}),(0,v.jsx)(i.z,{onClick:()=>D(w),type:"reset",color:"neutral",children:"Reset"})]})})}let _=f.Z.div(r||(r=(0,s.Z)(["flex justify-between items-center gap-2 min-h-[36px]"])))},78276:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return W}});var r=n(18450),s=n(95407),a=n(43041),l=n(66315),i=n(83537),o=n(60309),c=n(68039),u=n.n(c),d=n(47247),m=n.n(d),p=n(41409),h=n(70079),f=n(15118),g=n(25617),x=n(77799),v=n(57670),b=n(35601),j=n(73606),y=n(19841),w=n(83737),A=n(75388),O=n(86263),k=n(1454),N=n(45062),_=n(61236),S=n(49593),P=n(35250);function E(e){var t;let{currentQuery:n,onUpdateCurrentQuery:r,onTypeaheadOpenChange:s,onSubmit:a}=e,i=(0,h.useRef)(null),o=(0,h.useRef)(""),{0:c,1:u}=(0,h.useState)(!1);(0,h.useEffect)(()=>{l.U.addTiming("sonic.web.home.consolePrimarySearchInput.mounted")},[]);let{0:d,1:m}=(0,h.useState)(null),p=function(e){let{query:t,enabled:n=!0}=e,r=(0,h.useRef)([]),s=(0,h.useRef)(0),a=(0,h.useRef)(null),l=(0,h.useRef)(null),{settings:i,userMetadata:o}=(0,b.A)(),c=!i.suggestions||!n||!t||a.current===t,{data:u=[],isFetched:d}=(0,_.a)({queryKey:["typeahead",t],queryFn:S.mO,enabled:!c,networkMode:"offlineFirst"});return!c&&d&&(r.current[0]&&r.current[0]===u[0]?s.current++:s.current=1,s.current>=3&&l.current!==u[0]&&(l.current=u[0],(0,S.LC)({query:u[0],metadata:o})),a.current=t,r.current=u),n?u:r.current}({query:o.current}),f=(0,h.useMemo)(()=>p.slice(),[p]);(0,h.useEffect)(()=>{0===f.length&&m(null),u(f.length>0)},[f]),(0,h.useEffect)(()=>{null==s||s(c)},[c,s]);let g=e=>{r(e),a(e)},x=e=>{let{value:t,delta:n,shouldUpdateQuery:s=!0}=e;if(void 0===t&&void 0===n)throw Error("changeSelectedIndex requires either value or delta");let a=null;void 0!==n?null===d?a=-1===n?f.length-1:0:((a=d+n)<0||a>=f.length)&&(a=null):void 0!==t&&(a=t),m(a),s&&(null===a?r(o.current):r(f[a]))};return(0,P.jsxs)("div",{className:"relative",children:[(0,P.jsx)(N.X,{value:n,onChange:e=>{r(e.target.value),o.current=e.target.value},onSubmit:a,placeholder:"Search...",buttonIcon:(0,P.jsx)(O.WmV,{className:"rotate-90 text-token-main-surface-tertiary"}),ref:i,overflowDirection:"down",overflowFloat:!0,onKeyDown:e=>{c&&("ArrowUp"===e.key?(e.preventDefault(),x({delta:-1})):"ArrowDown"===e.key?(e.preventDefault(),x({delta:1})):"Escape"===e.key&&u(!1))},autoFocus:!0,spellCheck:!1,searchIcon:(0,P.jsx)(k.jRj,{className:(0,y.default)("h-5 w-5",(null===(t=o.current)||void 0===t?void 0:t.trim().length)>0?"text-token-text-primary":"text-token-text-tertiary")})}),c&&(0,P.jsx)("div",{className:"absolute left-0 right-0 top-full mt-[14px]",onMouseLeave:()=>x({value:null,shouldUpdateQuery:!1}),children:f.map((e,t)=>(0,P.jsx)(C,{typeahead:e,typedQuery:o.current,onHover:()=>x({value:t,shouldUpdateQuery:!1}),onSubmit:g,isSelected:t===d},t))})]})}function C(e){let{typeahead:t,typedQuery:n,onHover:r,onSubmit:s,isSelected:a}=e,l=t.startsWith(n),i=l?n:t,o=l?t.slice(n.length):"";return(0,P.jsx)(w.E.div,{initial:{opacity:0},animate:{opacity:1},className:"w-full",children:(0,P.jsxs)("button",{className:(0,y.default)("flex w-full items-center gap-3.5 rounded-lg px-5 py-3.5 transition-colors",a?"text-token-text-primary":"text-token-text-tertiary"),onClick:e=>{e.stopPropagation(),s(t)},onMouseEnter:()=>r(t),children:[(0,P.jsx)("div",{className:"flex h-5 w-5 items-center justify-center",children:(0,P.jsx)(O.w9k,{})}),(0,P.jsxs)("div",{className:"flex-grow text-left",children:[(0,P.jsx)("span",{children:i}),(0,P.jsx)("span",{className:"font-semibold",children:o})]})]},t)})}var D=n(5224);function R(e){let{readyState:t,currentQuery:n,onSubmit:r,onUpdateCurrentQuery:s}=e,{0:a,1:l}=(0,h.useState)(!1);return(0,P.jsxs)("div",{className:"relative flex h-full w-full flex-col justify-between overflow-hidden bg-token-main-surface-primary p-[--snc-3]",children:[(0,P.jsx)(w.E.div,{className:(0,y.default)("pointer-events-none absolute left-0 right-0 top-[calc(50%-120px)] flex flex-col items-center justify-center text-2xl font-medium transition-colors duration-500"),animate:{opacity:a?0:1},transition:{duration:D.Lc},children:(0,P.jsx)(j.nI,{className:"h-11 w-11"})}),(0,P.jsx)("div",{className:"m-auto w-full max-w-[640px] flex-shrink-0 pb-9",children:(0,P.jsxs)("div",{className:"relative",children:[(0,P.jsx)(E,{currentQuery:n,onUpdateCurrentQuery:s,onSubmit:e=>{0!==e.trim().length&&(r(e),l(!0))}}),(0,P.jsx)(A._,{className:"absolute -right-8 top-[50%] -translate-y-1/2",readyState:t})]})})]})}function M(e){let{readyState:t,initialQuery:n,hasSubmittedInitialQuery:r,onSubmitSearch:s,onSubmitFollowup:a,onRetryQuery:l,onReset:i,onUpdateSetting:o}=e,{settings:c}=(0,b.A)(),{0:u,1:d}=(0,h.useState)(null!=n?n:""),{0:m,1:p}=(0,h.useState)(""),f=(0,h.useRef)(null),g=(0,h.useRef)(null!=n?n:"");(0,h.useEffect)(()=>{n!==g.current&&(g.current=n,d(null!=n?n:""),p(""))},[n]);let j=e=>{d(e)},y=()=>{s(u),p("")},{0:w,1:A}=(0,h.useState)(!r);return(0,h.useEffect)(()=>{w&&r?setTimeout(()=>{A(!1)},1e3*D.Lc):r||A(!0)},[r,n,w]),(0,h.useEffect)(()=>(0,x.eR)(document,{keydown:e=>{"k"===e.key&&e.metaKey&&e.shiftKey&&(e.preventDefault(),d(""),p(""),i())}}),[i]),w?(0,P.jsx)(R,{readyState:t,currentQuery:u,onSubmit:y,onUpdateCurrentQuery:j}):(0,P.jsx)(v.e,{readyState:t,hasSubmittedInitialQuery:r,searchQuery:u,followupQuery:m,onUpdateSearchQuery:j,onUpdateFollowupQuery:e=>{p(e)},onRetryQuery:l,onSubmitSearch:y,onSubmitFollowup:e=>{a(null!=e?e:m),p("")},followupInputRef:f,settings:c,onUpdateSetting:o,onReset:e=>{d(null!=e?e:""),p(""),i(e)}})}var T=n(20735),Z=n(83216),L=n(68399),I=n(19216),F=n(68952),U=n(4466);function z(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function q(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?z(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):z(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var V=n(34796),Q=n(45456),B=n(90240),G=n(78375);function H(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function K(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?H(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):H(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function W(e){let{user:t,initialQuery:n,socketUrl:r,userMetadata:c}=e,d=(0,h.useRef)(n?{query:n}:null),x=(0,h.useRef)(n?"url_query":"search_input"),v=(0,L.W6)(L.bM.isSettingsModalOpen),j=(0,L.W6)(L.bM.isDebugModalOpen),[y,w]=(0,V.r)(),{0:A,1:O}=(0,h.useState)(null),{0:k,1:N}=(0,h.useState)(),{0:_,1:E}=(0,h.useState)(null!=n),C=(0,I.nn)(I.LW.threadId),R=(0,I.nn)(I.LW.lastTurn),z=(0,p.useRouter)(),{0:H,1:W}=(0,h.useState)(null),Y=(0,i.gb)({namespace:i.dG.SonicHome,opts:{debug:!0}});(0,h.useEffect)(()=>{l.U.addTiming("sonic.web.home.mounted")},[]),(0,Q.e)(),(0,h.useEffect)(()=>{(async function(){t&&W((await (0,o.FB)(t.id)).slice(0,6))})()},[t]);let{readyState:J,postQuery:$}=function(e){let{threadId:t,socketUrl:n,onTurnSubmitted:r}=e,{0:a,1:i}=(0,h.useState)(!1),{0:o,1:c}=(0,h.useState)(!0),{0:u,1:d}=(0,h.useState)(!0),m=(0,h.useRef)(0),p=(0,h.useRef)(!1);(0,h.useEffect)(()=>(p.current=!0,()=>{p.current=!1}),[]);let g=(0,h.useCallback)(async()=>{if(m.current>50)return s.m.danger("Failed to fetch websocket url",{hasCloseButton:!0}),l.U.addError("Failed to fetch websocket url, giving up",{attempts:m.current}),"";try{let e=await U.c.get("".concat(D.rq,"/register-websocket"));return m.current=0,e.wss_url}catch(e){throw l.U.addError("Failed to fetch websocket url, retrying",{cause:e}),m.current+=1,e}},[]),{readyState:x}=(0,f.ZP)(!a&&n?n:g,{retryOnError:!0,shouldReconnect:()=>!0===p.current&&u,reconnectAttempts:50,reconnectInterval:e=>Math.min(1e3*Math.pow(1.3,e),5e3),onMessage:e=>{!function(e,t){if(e.thread_id!==t)return;let n="append_turn"===e.delta.type||"set_turn"===e.delta.type?e.delta.turn.index:e.delta.turn_index;if(null===n)throw Error();switch(e.delta.type){case"append_turn":{let n=e.delta;I.P3.appendTurn(t,n.turn);break}case"set_search_results":{let t=e.delta;I.P3.updateTurn(n,e=>{e.search_results=t.search_results});break}case"set_model_response":{let t=e.delta;I.P3.updateTurn(n,e=>e.model_response=t.model_response);break}case"append_model_response_text":{let t=e.delta;I.P3.updateTurn(n,e=>{if(!e.model_response)throw Error();e.model_response.text+=t.text,e.model_response.citations=t.citations});break}case"set_weather_widget":{let t=e.delta;I.P3.updateTurn(n,e=>{e.weather_widget=t.weather_widget});break}case"set_calculator_widget":{let t=e.delta;I.P3.updateTurn(n,e=>{e.calculator_widget=t.calculator_widget});break}case"set_sports_widget":{let t=e.delta;I.P3.updateTurn(n,e=>{e.sports_widget=t.sports_widget});break}case"set_finance_widget":{let t=e.delta;I.P3.updateTurn(n,e=>{e.finance_widget=t.finance_widget});break}case"set_finance_widget_histories":{let t=e.delta;I.P3.updateTurn(n,e=>{if(null===e.finance_widget)throw Error();e.finance_widget=q(q({},e.finance_widget),{},{histories:t.histories})});break}case"set_timezone_widget":{let t=e.delta;I.P3.updateTurn(n,e=>{e.timezone_widget=t.timezone_widget});break}case"set_news_widget":{let t=e.delta;I.P3.updateTurn(n,e=>{e.news_widget=t.news_widget});break}case"set_turn_execution_status":{let t=e.delta;I.P3.updateTurn(n,e=>{e.execution_status=t.execution_status,e.error=t.error});break}default:l.U.addError("Unsupported delta type",{delta:e.delta})}}(JSON.parse(e.data),t)},onError:e=>{l.U.addError("Websocket error",{event:e})},onClose:()=>{console.debug("[ws] Connection closed"),i(!0)},onReconnectStop:()=>{s.m.danger("Websocket connection attempts failed, pausing reconnects",{hasCloseButton:!0})}},o),v=(0,h.useCallback)(()=>{x!==f.kQ.OPEN&&(c(!1),m.current=0,setTimeout(()=>{c(!0)},0))},[x]);return(0,h.useEffect)(()=>(0,F.R)({onHidden:()=>{console.debug("[ws] onHidden"),d(!1)},onVisible:()=>{console.debug("[ws] onVisible, set reconnect to true"),d(!0),v()}}),[v]),{readyState:x,postQuery:(0,h.useCallback)(async e=>{let{threadId:t}=e,n=!!t;return t||(t=await (0,S.gK)()),(0,S.dN)({threadId:t,query:e.query,agentSettingsOverrides:e.agentSettingsOverrides,metadata:e.metadata}).then(()=>null==r?void 0:r({isFollowup:n})).catch(e=>l.U.addError("Failed to postThreadTurn",{cause:e})),{threadId:t}},[r])}}({socketUrl:r,threadId:C,onTurnSubmitted:(0,h.useCallback)(e=>{let{isFollowup:t}=e;t||Y.logTiming("search_query_submitted",{context:{source:er()}})},[Y])}),{newQueryStarted:ee}=function(e){let{profiler:t,querySource:n}=e,r=(0,h.useRef)(K({},X)),s=(0,I.nn)(I.LW.firstTurn);return(0,h.useEffect)(()=>{var e,a,l;if(null==s)return;r.current.turn||(r.current.turn=!0,t.logTiming("ttf_message",{context:{source:n}})),r.current.modelResponse||u()(null===(e=s.model_response)||void 0===e?void 0:e.text)||(r.current.modelResponse=!0,t.logTiming("ttf_model_response",{context:{source:n}})),r.current.searchResults||u()(null===(a=s.search_results)||void 0===a?void 0:a.entries)||(r.current.searchResults=!0,t.logTiming("ttf_search_results",{context:{source:n}}));let i=(0,G.K)(s);!r.current.widget&&["in_progress","done"].includes(null!==(l=null==i?void 0:i.status)&&void 0!==l?l:"")&&(r.current.widget=!0,t.logTiming("ttf_widget",{context:{source:n,widgetType:null==i?void 0:i.type}}))},[s,t,n]),{newQueryStarted:(0,h.useCallback)(()=>{r.current=K({},X)},[])}}({profiler:Y,querySource:er()}),et=(0,h.useMemo)(()=>{let e=function(e){let t=a.bX.getCookie(a.cn.LastLocation);if((0,B.XB)(e),t&&e)try{return JSON.parse(t)}catch{}return B.PX}(y.useLocation);return K(K({},c),e)},[c,y.useLocation]),en=(0,h.useCallback)(async(e,t)=>{try{let n=null===t?"query":"followup",r=er();"query"===n&&(Y.reset(),ee(),O(e),N(e));let s=await $({threadId:t,query:e,agentSettingsOverrides:y.agentSettingsOverrides,metadata:et});if("query"===n){let t=s.threadId;I.P3.newThread(t),Z.Y.logEvent(Z.M.searchQuerySubmitted,{thread_id:t,source:r,user_hash:H,query:e})}else"followup"===n&&Z.Y.logEvent(Z.M.searchFollowupSubmitted,{thread_id:t,turn_index:R.index})}catch(e){l.U.addError(Error("Error posting user action",{cause:e})),s.m.danger("Failed to submit")}},[R,$,Y,y.agentSettingsOverrides,ee,H,et]);function er(){return x.current}let es=(e,t)=>{let{isFollowup:n=!1}=t;if(J!==f.kQ.OPEN){s.m.danger("Websocket connection is not open");return}en(null!=e?e:"",n?C:null),E(!0)},ea=e=>{I.P3.clearThread(),x.current="search_input";let t=new URLSearchParams(window.location.search);e?t.set("q",e):t.delete("q");let n="/search";t.size>0&&(n+="?".concat(t.toString())),z.replace(n,void 0,{shallow:!0}),e?(en(e,null),E(!0)):E(!1)};return(0,h.useEffect)(()=>{var e;J===f.kQ.OPEN&&(null!=n&&(null===(e=d.current)||void 0===e?void 0:e.query)!==n&&(I.P3.clearThread(),d.current={query:n}),null==d.current||d.current.submitted||(async function(){null==d.current||d.current.submitted||(d.current.submitted=!0,await en(d.current.query,null))}(),E(!0)))},[J,t.id,n,en,_]),(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(m(),{children:(0,P.jsx)("title",{children:_&&k?"".concat(k," - ChatGPT Search"):"ChatGPT Search"})}),(0,P.jsx)(b.c.Provider,{value:{searchQuery:null!=A?A:"",user:t,userHash:H,settings:y,userMetadata:et},children:(0,P.jsx)(M,{initialQuery:n,readyState:J,hasSubmittedInitialQuery:_,onSubmitFollowup:e=>es(e,{isFollowup:!0}),onReset:ea,onSubmitSearch:e=>{ea(e)},onRetryQuery:e=>{if(null==k){s.m.danger("No previous query to retry");return}e?es(e,{isFollowup:!0}):ea(k)},onUpdateSetting:w})}),j&&(0,P.jsx)(g.q,{isOpen:!0,onDebugClose:()=>L.vm.toggleDebugModalOpen()}),v&&(0,P.jsx)(T.Zr,{onClose:()=>L.vm.toggleSettingsModalOpen(),settings:y,onUpdateSetting:w})]})}let X={turn:!1,searchResults:!1,modelResponse:!1,widget:!1}},47072:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return eq}});var r=n(42607),s=n(51533),a=n(19841),l=n(91530),i=n.n(l),o=n(70079),c=n(57670),u=n(34796),d=n(45456),m=n(29287),p=n(85452),h=n(1454),f=n(18450),g=n(11335),x=n(95407),v=n(77799),b=n(61888),j=n(20724),y=n(86263),w=n(22189),A=n(67739),O=n(8143),k=n(35250);let N=["minHeight","maxHeight","className"];function _(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function S(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_(Object(n),!0).forEach(function(t){(0,f.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let P=(0,o.forwardRef)(function(e,t){let{minHeight:n=24,maxHeight:r,className:s}=e,l=(0,A.Z)(e,N),i=(0,o.useRef)(null),c=null!=t?t:i,[u]=(0,O.f)(c);return(0,o.useEffect)(()=>{let e=null!=u?u:"function"!=typeof c&&(null==c?void 0:c.current);if(e){e.style.height="0px";let t=e.scrollHeight;null!=n&&t<n?t=n:null!=r&&t>r&&(t=r),e.style.height="".concat(t,"px")}},[u,c,l.value,n,r]),(0,k.jsx)("textarea",S(S({},l),{},{className:(0,a.default)("hide-scrollbar resize-none",s),ref:c}))});function E(e){let{result:t,className:n}=e;switch(t){case"waiting":return(0,k.jsx)(h.Q8x,{className:(0,a.default)("stroke-[4] text-token-text-quaternary opacity-50",n)});case"pending":return(0,k.jsx)(p.Z,{className:n});case"passed":return(0,k.jsx)(h.UgA,{className:(0,a.default)("stroke-[4] text-green-500",n)});case"failed":return(0,k.jsx)(h.q5L,{className:(0,a.default)("stroke-[4] text-red-500",n)})}}var C=n(4466),D=n(82473),R=n(61236),M=n(25494),T=n(98486),Z=n(66315),L=n(79208),I=n(8844),F=n(5224),U=n(49593);function z(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function q(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?z(Object(n),!0).forEach(function(t){(0,f.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):z(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let V=e=>{let t=(0,D.NL)(),n=null==e?void 0:e.sort();return(0,R.a)({queryKey:["evals",{tags:n}],queryFn:async()=>{let e=new URLSearchParams;if(n)for(let t of n)e.append("tags",t);return C.c.get("".concat(F.rq,"/evals/evals?").concat(e.toString())).then(e=>{for(let n of e)t.setQueryData(["eval",n.id],n);return e})}})},Q=e=>(0,R.a)({queryKey:["eval",e],queryFn:async()=>C.c.get("".concat(F.rq,"/evals/evals/").concat(e))}),B=new Map,G=(e,t)=>{var n;let r=B.get(e);return null==r&&(r=(0,b.debounce)(t=>C.c.post("".concat(F.rq,"/evals/evals"),q(q({},t),{},{id:e})),500,{trailing:!0}),B.set(e,r)),null===(n=r)||void 0===n?void 0:n(t)},H=e=>{let t=(0,D.NL)();return(0,M.D)({mutationKey:["eval",e],mutationFn:async n=>{let r=q(q({},n),{},{id:e});t.setQueryData(["evals"],t=>t?t.map(t=>t.id===e?r:t):t),t.setQueryData(["eval",e],r),await G(e,n)}})},K=()=>{let e=(0,D.NL)();return(0,M.D)({mutationFn:async e=>{},onSettled:(t,n,r)=>{var s;let a="sonic_eval_".concat((0,I.Z)()),l=q(q({},r),{},{id:a}),i=null===(s=r.tags)||void 0===s?void 0:s.sort();e.setQueryData(["evals",{tags:i}],e=>e?[l,...e]:e),e.setQueryData(["eval",a],l)}})},W=e=>{let t=(0,D.NL)();return(0,M.D)({mutationKey:["eval",e],mutationFn:async()=>C.c.delete("".concat(F.rq,"/evals/evals/").concat(e)),onSettled:()=>{t.setQueryData(["evals"],t=>t?t.filter(t=>t.id!==e):t),t.setQueryData(["eval",e],void 0)}})},X=(0,b.memoize)(e=>{let{queryClient:t,settings:n}=e;return L.Ue({fetcher:async e=>{let r=(0,b.compact)(await Promise.all(e.map(e=>t.getQueryData(["eval",e])))),s=new Date(Date.now()),a=n&&(0,U.lw)(n.agentSettingsOverrides),l=await C.c.post("".concat(F.rq,"/evals/batched_runs"),{eval_ids:r.map(e=>e.id),turn_template:null==a?void 0:a.turn,base_config:null==a?void 0:a.base_config},{skipJsonTransform:!0}).catch(e=>(Z.U.addError(Error("Failed to start eval run",{cause:e})),[]));if(!(null!=l&&l.body))return[];let i=l.body.getReader(),o=new TextDecoder,c=!1,u=[],d="";try{for(;!c;){let e=await i.read();if(c=e.done)break;let n=d+o.decode(e.value,{stream:!0});d="";let r=n.split("\n").filter(e=>!!e.trim()),a=[],l=null;for(let e=0;e<r.length;e++)try{let t=JSON.parse(r[e].trim());t.id&&t.status&&t.eval_run_ids?l=t:t.id&&t.batch_id&&t.eval_id&&a.push(t)}catch(t){d=r.splice(e,1).join("\n");break}if(l){t.setQueryData(["batched_run",l.id],l);let e=t.getQueryData(["user_batched_runs"]);e&&!e.includes(l.id)&&t.setQueryData(["user_batched_runs"],[l.id,...e])}for(let e of a){let n=t.getQueryData(["eval_run",e.eval_id,"latest"]);(!n||n.batch_id===e.batch_id||null==n.created_at||new Date(n.created_at)<s)&&t.setQueryData(["eval_run",e.eval_id,"latest"],e),t.setQueryData(["eval_run",e.eval_id,e.batch_id],e)}u.push(...a)}""!==d&&(x.m.danger("Failed to parse JSON from eval run stream"),Z.U.addError("Failed to parse JSON from eval run stream",{data:d}))}catch(e){x.m.danger("Failed to read eval run stream"),Z.U.addError("Failed to read eval run stream",{cause:e})}return u},resolver:L.rp("eval_id"),scheduler:L.ck(500)})}),Y=(e,t)=>{let n=(0,D.NL)(),r=X((0,o.useMemo)(()=>({queryClient:n,settings:t}),[n,t]));return()=>(e.forEach(e=>{n.setQueryData(["eval_run",e,"latest"],{id:"",eval_id:e,batch_id:"",conversation_id:"",status:"in_progress",steps:[]})}),Promise.all(e.map(e=>r.fetch(e))))},J=(e,t,n)=>{let r=Y(e?[e]:[],n);return(0,R.a)({queryKey:["eval_run",e,null!=t?t:"latest"],queryFn:async()=>t?await C.c.get("".concat(F.rq,"/evals/eval_runs/").concat(e,"/").concat(t)):(await r())[0],enabled:!!e,initialData:null})};function $(){return(0,R.a)({queryKey:["tags"],queryFn:async()=>(0,b.sortBy)(await C.c.get("".concat(F.rq,"/evals/tags")))})}async function ee(e){try{let t=await C.c.get("".concat(F.rq,"/evals/batched_runs/").concat(e,"/csv"),{skipJsonTransform:!0}),n=await t.blob(),r=window.URL.createObjectURL(n),s=document.createElement("a");s.href=r,s.download="eval_batch_".concat(e,".csv"),s.click(),window.URL.revokeObjectURL(r)}catch(e){x.m.danger("Failed to download CSV: ".concat(e))}}function et(e){return(0,R.a)({queryKey:["batched_run",e],queryFn:async()=>{if(e)return await C.c.get("".concat(F.rq,"/evals/batched_runs/").concat(e))}})}function en(e,t){e.setQueryData(["eval_run",t.eval_id,t.batch_id],t);let n=e.getQueryData(["eval_run",t.eval_id,"latest"]),r=(null==n?void 0:n.created_at)&&new Date(n.created_at),s=t.created_at&&new Date(t.created_at);e.setQueryData(["eval_run",t.eval_id,"latest"],n&&(!r||!s||s>r)?t:n)}function er(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function es(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?er(Object(n),!0).forEach(function(t){(0,f.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):er(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let ea=["model_response"];function el(e){var t,n;let{criterion:r,gradingResult:s,isEditing:l,onSetIsEditing:i,onUpdateCriterion:c,autoFocus:u,onBlur:d}=e,{0:m,1:p}=(0,o.useState)(r);(0,o.useEffect)(()=>{p(r)},[r]);let f=(e,t)=>{p(e),null==c||c(e,t)},x="pending"!==s&&void 0!==s?s.thoughts:void 0,{0:v,1:j}=(0,o.useState)(!1),w=(0,o.useRef)(null);return(0,k.jsx)(g.E,{label:x,disabled:!x||l,wide:!0,side:"right",sideOffset:20,align:"start",className:"w-full",children:(0,k.jsx)("div",{className:(0,a.default)("flex w-full gap-2",l&&"pl-4"),children:l?(0,k.jsxs)(k.Fragment,{children:[null!=m?(0,k.jsx)(g.u,{label:"Remove criterion",side:"top",sideOffset:4,children:(0,k.jsx)("button",{className:"mt-2 text-token-text-tertiary hover:text-red-500",onClick:e=>{e.stopPropagation(),p({prompt:""}),null==c||c(null)},children:(0,k.jsx)(h.Ybf,{})})}):(0,k.jsx)("div",{className:"h-4 w-4"}),(0,k.jsx)(P,{value:null!==(t=null==m?void 0:m.prompt)&&void 0!==t?t:"",onChange:e=>f(es(es({},m),{},{prompt:e.target.value})),className:"peer w-full rounded-xl bg-token-main-surface-primary text-sm",placeholder:"Evaluation criterion...",onFocus:()=>j(!0),onBlur:()=>{j(!1),null==d||d(m)},onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),e.currentTarget.blur())},onClick:e=>e.stopPropagation(),onPaste:e=>{e.preventDefault();let[t,...n]=e.clipboardData.getData("text").split("\n"),r=e.target,s=r.value.slice(0,r.selectionStart)+t+r.value.slice(r.selectionEnd);f(es(es({},m),{},{prompt:s}),(0,b.compact)(n.map(e=>({prompt:e,visible_assistant_message_fields:ea}))));let a=r.selectionStart+t.length;requestAnimationFrame(()=>{r.setSelectionRange(a,a)})},autoFocus:u,ref:w}),(0,k.jsx)("button",{className:"text-token-text-tertiary hover:text-token-text-primary",onClick:()=>{var e;return null===(e=w.current)||void 0===e?void 0:e.focus()},children:(0,k.jsx)(y.nWS,{})}),(0,k.jsx)(ei,{open:v,criterion:null!=m?m:{prompt:""},onUpdateCriterion:e=>{f(e)}})]}):(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)("div",{className:"flex-grow",children:null==m?void 0:m.prompt}),(0,k.jsx)(E,{className:"mt-1 shrink-0",result:s?"pending"===s?"pending":s.passed?"passed":"failed":"waiting"}),(0,k.jsx)(g.u,{label:null!=m&&m.visible_assistant_message_fields?"Visible fields: ".concat(null==m||null===(n=m.visible_assistant_message_fields)||void 0===n?void 0:n.join(", ")):"All fields visible",align:"end",children:(0,k.jsx)("button",{className:"text-token-text-tertiary hover:text-token-text-primary",onClick:()=>{i(!0),requestAnimationFrame(()=>{var e;null===(e=w.current)||void 0===e||e.focus()})},children:(0,k.jsx)(y.nWS,{})})})]})})})}function ei(e){var t;let{open:n,criterion:r,onUpdateCriterion:s}=e,a=(0,R.a)({queryKey:["grader_response_fields"],queryFn:async()=>await C.c.get("".concat(F.rq,"/evals/grader_response_fields"))});return(0,k.jsxs)(w.fC,{open:n,children:[(0,k.jsx)(w.ee,{className:"min-h-full"}),(0,k.jsx)(w.h_,{children:(0,k.jsxs)(w.VY,{side:"right",sideOffset:30,onOpenAutoFocus:e=>e.preventDefault(),className:"z-10 rounded-lg bg-token-main-surface-primary p-4 text-token-text-primary shadow-md",onMouseDown:e=>e.preventDefault(),children:[(0,k.jsx)(w.Eh,{className:" h-4 w-10 fill-token-main-surface-primary",style:{filter:"drop-shadow(0 1px 1px rgba(0, 0, 0, 0.1))"}}),(0,k.jsx)("div",{className:"mb-4 text-sm text-token-text-secondary",children:"(If none are checked, all fields are visible to grader)"}),(0,k.jsxs)("div",{className:"mb-4 grid w-fit grid-cols-[auto,auto] items-center gap-x-4 gap-y-1",children:[a.isLoading&&(0,k.jsx)(p.Z,{}),null===(t=a.data)||void 0===t?void 0:t.map(e=>{var t,n;return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)("div",{className:"text-sm font-medium",children:e}),(0,k.jsx)("input",{type:"checkbox",checked:null!==(t=null===(n=r.visible_assistant_message_fields)||void 0===n?void 0:n.includes(e))&&void 0!==t?t:ea.includes(e),onChange:t=>{var n,a;if(t.target.checked)s(es(es({},r),{},{visible_assistant_message_fields:[...null!==(n=r.visible_assistant_message_fields)&&void 0!==n?n:ea,e]}));else{let t=(null!==(a=r.visible_assistant_message_fields)&&void 0!==a?a:ea).filter(t=>t!==e);s(es(es({},r),{},{visible_assistant_message_fields:t}))}}})]})})]})]})})]})}function eo(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function ec(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?eo(Object(n),!0).forEach(function(t){(0,f.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eo(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function eu(e){let{step:t,stepResult:n,isEditing:r,onSetIsEditing:s,onUpdateStep:a,showCriterion:l=!0,autoFocus:i}=e,c=e=>"pending"===n?"pending":null==n?void 0:n.grading_results.find(t=>t.criterion.prompt===e.prompt),{0:u,1:d}=(0,o.useState)(t.user_action.query_fragment),m=e=>{d(e),a(ec(ec({},t),{},{user_action:ec(ec({},t.user_action),{},{query_fragment:e})}))},p=r?[...t.criteria,null]:t.criteria,f="submit"===t.user_action.type&&""===u&&i,x=!f&&i;return(0,k.jsxs)("div",{className:"relative flex flex-col",children:[(0,k.jsx)("div",{className:"flex font-medium",children:r?(0,k.jsxs)("div",{className:"flex w-full gap-2",children:[(0,k.jsx)(g.u,{label:"Remove step",side:"top",sideOffset:4,children:(0,k.jsx)("button",{className:"mt-3 text-red-500 hover:text-red-700",onClick:()=>{a(null)},children:(0,k.jsx)(h.Ybf,{})})}),(0,k.jsx)(P,{value:u,onChange:e=>m(e.target.value),className:"mb-2 w-full rounded-lg bg-token-main-surface-primary text-base",placeholder:"submit"===t.user_action.type?"Search prompt...":"Followup prompt...",onClick:e=>e.stopPropagation(),autoFocus:f})]}):t.user_action.query_fragment}),l&&(0,k.jsx)("div",{className:"flex flex-col gap-1",children:null==p?void 0:p.map((e,n)=>(0,k.jsx)(el,{criterion:e,gradingResult:null!=e?c(e):void 0,isEditing:r,onSetIsEditing:s,onUpdateCriterion:(r,s)=>{let l=t.criteria;l=null==e&&null!=r?t.criteria.concat(r):t.criteria.map((e,t)=>t===n?r:e).filter(e=>null!=e),s&&(l=l.concat(s)),a(ec(ec({},t),{},{criteria:l}))},autoFocus:x&&0===n,onBlur:e=>{(null==e||""===e.prompt)&&a(ec(ec({},t),{},{criteria:(0,b.compact)(t.criteria.map((e,t)=>t===n?null:e))}))}},"step-".concat(n)))})]})}var ed=n(18460),em=n(98825),ep=n(82133);function eh(e){return"hsl(".concat(function(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n);return(t%360+360)%360}(e),", 50%, 90%)")}let ef=["tag"];function eg(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function ex(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?eg(Object(n),!0).forEach(function(t){(0,f.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eg(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let ev=e=>(0,k.jsx)(ed.c.Input,ex(ex({},e),{},{inputClassName:"focus:ring-0 !text-token-text-primary"}));function eb(e){let{tags:t,onTagsChange:n,placeholder:r,isEditable:s,classNames:l}=e,{data:i,isLoading:o}=$(),c=s?ep.Z:em.ZP,u=function(){let e=(0,D.NL)();return(0,M.D)({mutationKey:["tags"],mutationFn:async t=>{e.setQueryData(["tags"],e=>e?[...e,t]:e)}})}();return(0,k.jsx)(c,{classNames:ex(ex({},l),{},{input:e=>{var t;return(0,a.default)("text-sm",null==l||null===(t=l.input)||void 0===t?void 0:t.call(l,e))},multiValue:e=>{var t;return(0,a.default)("!rounded-lg",null==l||null===(t=l.multiValue)||void 0===t?void 0:t.call(l,e))},menu:e=>{var t;return(0,a.default)("bg-token-main-surface-primary snc-accent-border",null==l||null===(t=l.menu)||void 0===t?void 0:t.call(l,e))},control:e=>{var t;return(0,a.default)("snc-accent-border",null==l||null===(t=l.control)||void 0===t?void 0:t.call(l,e))},menuList:e=>{var t;return(0,a.default)("bg-token-main-surface-primary",null==l||null===(t=l.menuList)||void 0===t?void 0:t.call(l,e))},multiValueRemove:e=>{var t;return(0,a.default)("text-gray-600",null==l||null===(t=l.multiValueRemove)||void 0===t?void 0:t.call(l,e))}}),styles:{control:e=>ex(ex({},e),{},{backgroundColor:"var(--token-main-surface-primary)"}),option:(e,t)=>ex(ex({},e),{},{backgroundColor:t.isFocused?"var(--snc-hover)":"transparent"}),multiValue:(e,t)=>ex(ex({},e),{},{backgroundColor:eh(t.data.value)})},components:{Input:ev},isClearable:!1,placeholder:null!=r?r:"Select tags",className:"select-none",value:t.map(e=>({label:e,value:e})),isMulti:!0,isLoading:o,allowCreateWhileLoading:!1,options:null==i?void 0:i.map(e=>({label:e,value:e})),onCreateOption:e=>{let r=(0,b.snakeCase)(e).toLowerCase();n((0,b.sortBy)([...t,r])),u.mutate(e)},onChange:e=>{n((0,b.sortBy)(e.map(e=>e.value)))}})}function ej(e){let{tag:t}=e,n=(0,A.Z)(e,ef);return(0,o.createElement)("div",ex(ex({},n),{},{key:t,className:(0,a.default)("select-none rounded-lg bg-token-main-surface-tertiary px-2 py-1 text-xs font-medium !leading-none text-gray-700",n.className),style:ex({backgroundColor:eh(t)},n.style)}),t)}var ey=n(19216);function ew(e){let{threadId:t,threadUserId:n,refetchOnMount:r}=e;return(0,R.a)({queryKey:["thread",t,n],queryFn:async()=>{if(!t)return{thread:null,turns:null};let e=await (0,U.Nv)({threadId:t,threadUserId:n,isEval:!0}),r=e.turns;return{thread:e,turns:r}},enabled:!!t,refetchOnMount:r})}function eA(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function eO(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?eA(Object(n),!0).forEach(function(t){(0,f.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eA(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function ek(e){var t,n,r,s,l,i;let{evalId:c,evalRunId:u,settings:d,setSelected:p,isSelected:f,initialEditState:y}=e,w=J(c,void 0,d),A=function(e){let t=(0,D.NL)();return(0,R.a)({queryKey:["eval_run",e],queryFn:async()=>{let n=await C.c.get("".concat(F.rq,"/evals/eval_runs/").concat(e));return en(t,n),n}})}(null!=u?u:""),O=null!=u?A:w,{0:N,1:_}=(0,o.useState)(null!=y&&y),S=null===(t=Q(c))||void 0===t?void 0:t.data,M=e=>{if(O.data)return O.data.steps[e]||"pending"},T=H(c),Z=W(c),{0:L,1:I}=(0,o.useState)(null);(0,o.useEffect)(()=>{I(null!=S?S:null)},[S]);let{0:U,1:z}=(0,o.useState)(!1),q=e=>{I(e),z(!0)},V=(0,o.useCallback)(()=>{U&&(null==L?(Z.mutate(),x.m.info("Test case deleted")):(T.mutate(L),x.m.info("Test case updated")),z(!1))},[L,T,U,Z]),B=(0,o.useCallback)(e=>{e!=N&&(V(),_(e))},[N,V]);(0,o.useEffect)(()=>{f||B(!1)},[f,B]),(0,o.useEffect)(()=>{if(f)return(0,v.eR)(document,{keydown:e=>{"Enter"!==e.key||e.shiftKey||B(!N)}})},[f,N,c,B]);let G=!f&&L&&L.steps.length>0?[L.steps[0]]:null==L?void 0:L.steps,K=(null===(n=O.data)||void 0===n?void 0:n.status)==="done"?O.data.steps.every(e=>null==e?void 0:e.grading_results.every(e=>e.passed))?"passed":"failed":(null===(r=O.data)||void 0===r?void 0:r.status)==="in_progress"?"pending":"waiting",X=(null===(s=O.data)||void 0===s||null===(s=s.steps[0])||void 0===s?void 0:s.conversation.id)!=null,{refetch:Y}=ew({threadId:null===(l=O.data)||void 0===l||null===(l=l.steps[0])||void 0===l?void 0:l.conversation.id});return(0,k.jsxs)("div",{className:(0,a.default)("relative flex w-full cursor-pointer items-start gap-[--snc-1] px-[--snc-1] text-left transition-colors hover:border-token-border-heavy hover:bg-[var(--snc-hover)]",f?"border-y bg-token-main-surface-secondary py-[--snc-1]":"py-2"),onClick:()=>p(!0),onDoubleClick:()=>B(!0),children:[(0,k.jsx)("div",{className:"flex flex-col gap-2 leading-none",children:(0,k.jsx)("button",{className:"text-token-text-tertiary",onClick:e=>{e.stopPropagation(),B(!1)},children:f?(0,k.jsx)(h.bTu,{className:"icon-lg"}):(0,k.jsx)(E,{result:K,className:"icon-lg"})})}),(0,k.jsxs)("div",{className:"flex flex-grow flex-col gap-2",children:[null==G?void 0:G.map((e,t)=>(0,k.jsx)(eu,{step:e,stepResult:M(t),isEditing:N,onSetIsEditing:B,onUpdateStep:e=>{q(n=>{var r;let s=(0,b.compact)((null!==(r=null==n?void 0:n.steps)&&void 0!==r?r:[]).map((n,r)=>r===t?e:n));return null==n||0===s.length?null:eO(eO({},n),{},{steps:s})})},showCriterion:f,autoFocus:0===t},t)),N?(0,k.jsxs)("div",{className:"flex",children:[(0,k.jsx)(g.u,{label:"Add new step",side:"right",sideOffset:4,children:(0,k.jsx)(m.z,{color:"neutral",onClick:e=>{e.stopPropagation(),q(e=>{var t;return null==e?e:eO(eO({},e),{},{steps:(null!==(t=null==e?void 0:e.steps)&&void 0!==t?t:[]).concat({user_action:{query_fragment:"",type:"text",conversation_id:null,metadata:{},agent_settings_overrides:{model_family:j.tQ.GPT_3_5,search_engine:j.lv.Bing,robots_mode:j.K1.Conservative,show_image_to_model:!1,rerank_labrador:"maraschino-rr-d32-latest"}},criteria:[]})})})},children:(0,k.jsx)(h.OvN,{})})}),(0,k.jsx)("div",{className:"absolute bottom-[--snc-1] right-[--snc-1]",children:(0,k.jsx)(g.u,{label:"Delete test case",side:"right",children:(0,k.jsx)("button",{className:"text-red-500",onClick:e=>{e.stopPropagation(),Z.mutate()},children:(0,k.jsx)(h.Ybf,{})})})})]}):null,N?(0,k.jsx)(g.u,{label:"Eval Notes",side:"right",sideOffset:4,children:(0,k.jsx)(P,{value:null==L?void 0:L.notes,onChange:e=>{q(t=>null==t?t:eO(eO({},t),{},{notes:e.target.value}))},placeholder:"Eval Notes...",className:"w-full rounded-lg bg-token-main-surface-primary text-sm"})}):(null==L?void 0:L.notes)&&f&&(0,k.jsxs)("div",{className:"text-sm italic",children:["Notes: ",null==L?void 0:L.notes]}),(0,k.jsx)(eN,{tags:null!==(i=null==L?void 0:L.tags)&&void 0!==i?i:[],onUpdateTags:e=>{q(t=>null==t?t:eO(eO({},t),{},{tags:e}))},isEditing:N})]}),(0,k.jsxs)("div",{className:"flex flex-col gap-2 pt-1 leading-none",children:[(0,k.jsx)(g.u,{label:"Run single test case",side:"right",sideOffset:4,children:(0,k.jsx)("button",{className:"text-green-500 hover:text-token-text-primary",onClick:e=>{V(),e.stopPropagation(),p(!0),O.refetch()},children:(0,k.jsx)(h.KCr,{className:"stroke-[2]"})})}),f&&(0,k.jsx)(g.u,{label:N?"Save test case (Enter)":"Edit test case (Enter)",side:"right",sideOffset:4,children:(0,k.jsx)("button",{className:"text-token-text-tertiary hover:text-token-text-primary",onClick:e=>{e.stopPropagation(),B(!N)},children:N?(0,k.jsx)(h.mW3,{}):(0,k.jsx)(h.vPQ,{})})}),f&&X&&(0,k.jsx)(g.u,{label:"Re-fetch test run",side:"right",sideOffset:4,children:(0,k.jsx)("div",{className:"text-token-text-tertiary hover:text-token-text-primary",onClick:()=>Y(),children:(0,k.jsx)(h.Bw1,{})})})]})]})}function eN(e){let{tags:t,onUpdateTags:n,isEditing:r}=e;return r?(0,k.jsx)("div",{children:(0,k.jsx)(eb,{isEditable:!0,tags:t,onTagsChange:e=>n(e),placeholder:"Add tags..."})}):(0,k.jsx)("div",{className:"flex flex-wrap items-center gap-1",children:t.map(e=>(0,k.jsx)(ej,{tag:e},e))})}function e_(e){var t,n,r,s,l;let{batchId:i,settings:c,selectedEvalId:u,setSelectedEvalId:d}=e,f=et(i),g=function(e){let t=(0,D.NL)();return(0,T.h)({queries:e.map(e=>({queryKey:["eval_run",e],queryFn:async()=>{let n=await C.c.get("".concat(F.rq,"/evals/eval_runs/").concat(e));return en(t,n),n}})),combine:e=>({runs:(0,b.compact)(e.map(e=>e.data)),refetch:()=>{e.forEach(e=>e.refetch())},isLoading:e.some(e=>e.isLoading)})})}(null!==(t=null===(n=f.data)||void 0===n?void 0:n.eval_run_ids)&&void 0!==t?t:[]),x=g.runs,v=(l=x.map(e=>e.eval_id),(0,T.h)({queries:l.map(e=>({queryKey:["eval",e],queryFn:async()=>await C.c.get("".concat(F.rq,"/evals/evals/").concat(e))})),combine:e=>(0,b.compact)(e.map(e=>e.data))})),j=new Map;for(let e of x)j.set(e.eval_id,e);(0,o.useEffect)(()=>{var e;(null===(e=f.data)||void 0===e?void 0:e.status)==="done"&&x.some(e=>"in_progress"===e.status||"enqueued"===e.status)&&g.refetch()},[f,null===(r=f.data)||void 0===r?void 0:r.status,x,g]);let{numSuccessfulRuns:y,numSuccessfulCriteria:w,numCriteria:A}=(0,o.useMemo)(()=>{let e=0,t=0,n=0;for(let r of x){let s=!0;for(let e of r.steps)for(let r of e.grading_results)n++,r.passed?t++:s=!1;s&&e++}return{numSuccessfulRuns:e,numSuccessfulCriteria:t,numCriteria:n}},[x]);return(0,k.jsxs)("div",{className:"flex w-full flex-col items-stretch overflow-y-auto",children:[(0,k.jsxs)("div",{className:"grid grid-cols-[auto,1fr] gap-2 p-[--snc-1]",children:[(0,k.jsx)("div",{className:"font-medium",children:"Batch"}),(0,k.jsx)("div",{className:"font-mono text-xs",children:i}),(0,k.jsx)("div",{className:"font-medium",children:"Status"}),(0,k.jsx)("div",{className:"font-mono text-xs",children:null===(s=f.data)||void 0===s?void 0:s.status}),(0,k.jsx)("div",{className:"font-medium",children:"Evals"}),(0,k.jsxs)("div",{className:(0,a.default)("flex font-mono text-xs",y===v.length?"text-green-500":"text-red-500"),children:[g.isLoading&&(0,k.jsx)(p.Z,{}),y,"/",v.length," (",(y/v.length*100).toFixed(1),"%)"]}),(0,k.jsx)("div",{className:"font-medium",children:"Criteria"}),(0,k.jsxs)("div",{className:(0,a.default)("flex font-mono text-xs",w===A?"text-green-500":"text-red-500"),children:[g.isLoading&&(0,k.jsx)(p.Z,{}),w,"/",A," (",(w/A*100).toFixed(1),"%)"]}),(0,k.jsxs)(m.z,{onClick:()=>ee(i),className:"col-span-2",children:[(0,k.jsx)(h._hL,{}),"Download Batched Run CSV"]})]}),v.map(e=>{var t;return(0,k.jsx)(ek,{settings:c,evalId:e.id,evalRunId:null===(t=j.get(e.id))||void 0===t?void 0:t.id,setSelected:t=>{d(n=>t?e.id:n!==e.id?n:void 0)},isSelected:e.id===u},e.id)})]})}function eS(e){let{selectedBatchId:t,setSelectedBatchId:n,className:r}=e,{data:s}=(0,R.a)({queryKey:["user_batched_runs"],queryFn:async()=>(await C.c.get("".concat(F.rq,"/evals/batched_runs"))).items});return(0,k.jsxs)("div",{className:(0,a.default)("w-24 overflow-y-auto",r),children:[(0,k.jsx)("div",{className:(0,a.default)("cursor-pointer p-2 hover:bg-token-main-surface-secondary",void 0==t&&"bg-token-main-surface-tertiary font-medium"),onClick:()=>n(void 0),children:"All/latest"}),null==s?void 0:s.map(e=>(0,k.jsx)(eP,{batchId:e,selected:t===e,setSelected:t=>{n(t?e:void 0)}},e))]})}function eP(e){var t;let{batchId:n,selected:r,setSelected:s}=e,l=et(n),i=(null===(t=l.data)||void 0===t?void 0:t.created_at)&&new Date(l.data.created_at);return(0,k.jsx)("div",{className:(0,a.default)("cursor-pointer p-2 text-xs hover:bg-token-main-surface-secondary",r&&"bg-token-main-surface-tertiary font-medium"),onClick:()=>s(!r),children:i&&(0,k.jsxs)("div",{children:[(0,k.jsx)("div",{children:null==i?void 0:i.toLocaleDateString()}),(0,k.jsx)("div",{children:null==i?void 0:i.toLocaleTimeString()})]})})}var eE=n(17178);function eC(e){let{evalRun:t}=e,n=Q(t.eval_id).data;return(0,k.jsxs)("div",{className:"flex flex-col gap-10",children:[null==n?void 0:n.steps.map((e,n)=>{let r=t.steps[n];return(0,k.jsxs)("div",{children:[(0,k.jsxs)("div",{className:"flex items-center gap-2 text-lg font-medium",children:[(0,k.jsx)(E,{result:r.grading_results.every(e=>e.passed)?"passed":"failed"}),e.user_action.query_fragment]}),r.grading_results.map((e,t)=>(0,k.jsx)(eD,{result:e},t))]},n)}),t.turn_template&&(0,k.jsxs)("div",{className:"flex flex-grow flex-col",children:[(0,k.jsx)("div",{className:"flex items-center gap-1 font-medium",children:"Turn Settings"}),(0,k.jsx)(eE.default,{json:t.turn_template})]}),null!=t.batch_id&&(0,k.jsxs)(m.z,{onClick:()=>ee(t.batch_id),children:[(0,k.jsx)(h._hL,{}),"Download Batched Run CSV"]})]})}function eD(e){let{result:t}=e,{0:n,1:r}=(0,o.useState)(!1);return(0,k.jsxs)("div",{className:"ml-8",children:[(0,k.jsxs)("div",{className:"flex items-center gap-1",children:[(0,k.jsx)(E,{result:t.passed?"passed":"failed"}),t.criterion.prompt,(0,k.jsx)("button",{onClick:()=>r(e=>!e),children:n?(0,k.jsx)(h.Tfp,{}):(0,k.jsx)(h.bTu,{})})]}),!n&&(0,k.jsxs)("div",{className:"ml-8 flex flex-col gap-2",children:[(0,k.jsx)("div",{children:(0,k.jsx)("p",{className:"whitespace-pre-wrap text-sm",children:t.thoughts})}),(0,k.jsxs)("div",{children:[(0,k.jsx)("div",{className:"font-medium",children:"Grader Details"}),(0,k.jsx)("p",{className:"whitespace-pre-wrap text-sm",children:t.prompt}),(0,k.jsx)(eE.default,{json:t.grading_object})]})]})]})}function eR(e){let{run:t,settings:n,selectedBatchId:r,setSelectedBatchId:s}=e,a=(0,b.isEqual)((0,U.lw)(n.agentSettingsOverrides).turn,t.turn_template);return(0,k.jsxs)("div",{className:"flex gap-4 border-t p-[--snc-1]",children:[(0,k.jsx)("div",{className:"flex flex-col",children:(0,k.jsxs)("div",{className:"grid grid-cols-[auto,auto] gap-1",children:[(0,k.jsx)("div",{className:"font-medium",children:"Status"}),(0,k.jsx)("div",{className:"font-mono text-xs",children:t.status}),null!=t.batch_id&&(0,k.jsxs)(m.z,{onClick:()=>ee(t.batch_id),className:"col-span-2",children:[(0,k.jsx)(h._hL,{}),"Download Batched Run CSV"]}),null!=t.batch_id&&t.batch_id!==r&&(0,k.jsxs)(m.z,{onClick:()=>s(t.batch_id),className:"col-span-2",children:[(0,k.jsx)(h.rDJ,{}),"View Runs in Batch"]})]})}),!a&&(0,k.jsx)(g.u,{label:"Run settings differ from your current settings",children:(0,k.jsx)("span",{className:"text-red-500",children:(0,k.jsx)(h.bcx,{})})})]})}var eM=n(16131),eT=n(75138),eZ=n(20735),eL=n(72150);let eI="audited";function eF(){return(0,k.jsx)("div",{children:(0,k.jsx)(eT.l,{lines:3})})}function eU(e){return Array.isArray(e)&&e.every(e=>"string"==typeof e)}function ez(e){var t,n,r,s;let{settings:l,onUpdateSettings:i,selectedEvalId:c,setSelectedEvalId:u}=e,{data:d,isLoading:p}=$(),f=K(),{0:x,1:v}=(0,o.useState)(""),[b,w]=(0,eL.Z)("SONIC_EVAL_TAGS",[eI],eU);(0,o.useEffect)(()=>{!p&&d&&d.length&&1===b.length&&b[0]===eI&&(d.includes(eI)?w([eI]):w([d[0]]))},[p]);let A=V(b),O=null==A||null===(t=A.data)||void 0===t?void 0:t.filter(e=>e.steps.some(e=>!x||e.user_action.query_fragment.toLowerCase().includes(x))),{0:N,1:_}=(0,o.useState)(!1),S=Y((null!=O?O:[]).map(e=>e.id),l);function P(e){return 1===e.steps.length&&""===e.steps[0].user_action.query_fragment}return(0,o.useEffect)(()=>{if(A.data&&!c&&A.data.length>0&&P(A.data[0])){var e;u(null===(e=A.data[0])||void 0===e?void 0:e.id)}},[A.data,c,u]),(0,k.jsxs)("div",{className:"flex flex-col overflow-y-auto",children:[(0,k.jsxs)("div",{className:"pb-[calc(var(--snc-1)/2] flex h-[76px] items-center p-[--snc-1] font-medium",children:["Evals",(null==A?void 0:A.data)!=null?" (".concat(A.data.length,")"):""]}),(0,k.jsxs)("div",{className:"flex flex-col gap-2 p-[--snc-1]",children:[(0,k.jsx)(eb,{classNames:{control:()=>"!rounded-full pl-4 pr-1"},tags:b,onTagsChange:w,placeholder:"Find tags..."}),(0,k.jsx)("div",{className:"flex flex-wrap items-center gap-2",children:null==d?void 0:d.map(e=>(0,k.jsx)(ej,{tag:e,className:(0,a.default)("cursor-pointer px-2.5 py-1.5 text-sm",!b.includes(e)&&"opacity-60"),onClick:t=>{if(t.shiftKey){b.includes(e)?w(b.filter(t=>t!==e)):w([...b,e]);return}1===b.length&&b.includes(e)?w([]):w([e])}},e))})]}),(0,k.jsxs)("div",{className:"flex items-center justify-between gap-2 p-[--snc-1] pt-0",children:[(0,k.jsx)("div",{className:"flex",children:(0,k.jsx)(g.u,{label:"Add new eval",side:"top",sideOffset:4,children:(0,k.jsx)(m.z,{color:"neutral",onClick:e=>{e.stopPropagation(),f.mutate({steps:[{user_action:{query_fragment:"",type:"submit",conversation_id:null,metadata:{},agent_settings_overrides:{model_family:j.tQ.GPT_3_5,search_engine:j.lv.Bing,robots_mode:j.K1.Conservative,show_image_to_model:!1,rerank_labrador:"maraschino-rr-d32-latest"}},criteria:[]}],tags:[...b]}),u(void 0)},disabled:(null===(n=A.data)||void 0===n?void 0:n[0])&&P(A.data[0]),children:(0,k.jsx)(h.OvN,{})})})}),(0,k.jsx)("input",{type:"text",value:x,className:"snc-accent-border flex-grow rounded-lg bg-token-main-surface-primary py-1 pl-4 pr-1 focus:outline-0 focus:ring-0",onChange:e=>v(e.target.value),placeholder:"Filter..."}),(0,k.jsxs)("div",{className:"flex items-center gap-2",children:[(0,k.jsx)(g.u,{label:"Edit settings",side:"top",sideOffset:4,children:(0,k.jsx)(m.z,{onClick:()=>_(!0),color:"neutral",children:(0,k.jsx)(y.KAl,{className:"icon-sm"})})}),(0,k.jsx)(g.u,{label:"Run all test cases",side:"top",sideOffset:4,children:(0,k.jsx)(m.z,{disabled:!(null!=O&&O.length),onClick:()=>{if(!O)return;let e=O.length;(!(e>50)||window.confirm("Are you sure you want to run ".concat(e," evals?")))&&S()},className:"flex items-center justify-self-end py-1.5",children:(0,k.jsx)(eM.Z,{value:null!==(r=null==O?void 0:O.length)&&void 0!==r?r:0,one:"Run 1 eval",other:"Run ".concat(null!==(s=null==O?void 0:O.length)&&void 0!==s?s:0," evals")})})})]})]}),A.isLoading?(0,k.jsx)("div",{className:"flex flex-col gap-[--snc-1] px-[--snc-2]",children:Array.from({length:5}).map((e,t)=>(0,k.jsx)(eF,{},t))}):null==O?void 0:O.map((e,t)=>{var n;return(0,k.jsx)(ek,{settings:l,evalId:e.id,setSelected:t=>{u(n=>t?e.id:n!==e.id?n:void 0)},isSelected:e.id===c||P(e),initialEditState:P(e)},null!==(n=e.id)&&void 0!==n?n:"new-".concat(t))}),N&&(0,k.jsx)(eZ.Zr,{onClose:()=>_(!1),settings:l,onUpdateSetting:i})]})}function eq(){var e,t;(0,d.e)();let{0:n,1:r}=(0,o.useState)(void 0),{0:s,1:a}=(0,o.useState)(void 0),[l,i]=(0,u.r)(),c=null===(e=J(n,s))||void 0===e?void 0:e.data,m=null==c||null===(t=c.steps[0])||void 0===t?void 0:t.conversation.id;return(0,k.jsxs)("div",{className:"flex h-screen w-screen",children:[(0,k.jsxs)("div",{className:"flex w-[600px] flex-shrink-0 border-r",children:[(0,k.jsx)(eS,{selectedBatchId:s,setSelectedBatchId:e=>{r(void 0),a(e)},className:"h-full flex-shrink-0 border-r"}),null!=s?(0,k.jsx)(e_,{batchId:s,settings:l,selectedEvalId:n,setSelectedEvalId:r}):(0,k.jsx)(ez,{settings:l,onUpdateSettings:i,selectedEvalId:n,setSelectedEvalId:r})]}),(0,k.jsxs)("div",{className:"flex flex-grow flex-col overflow-hidden",children:[(null==c?void 0:c.exception)&&(0,k.jsxs)("div",{className:"h-ful w-full flex-grow overflow-auto",children:[(0,k.jsx)("h2",{children:"Error in backend"}),(0,k.jsx)("pre",{children:c.exception.traceback.join("")})]}),c&&m&&(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)("div",{className:"h-full w-full flex-grow overflow-auto",children:(0,k.jsx)(eQ,{settings:l,onUpdateSettings:i,evalRun:c,threadId:m})}),(0,k.jsx)(eR,{run:c,settings:l,selectedBatchId:s,setSelectedBatchId:a})]})]})]})}function eV(e){let{value:t,children:n}=e;return(0,k.jsx)(s.ck,{value:t,className:(0,a.default)("flex shrink-0 cursor-pointer items-center justify-center rounded-full border px-2 py-0.5","border-token-border-secondary bg-token-main-surface-primary text-token-text-secondary","radix-state-checked:border-token-text-tertiary radix-state-checked:bg-token-text-primary radix-state-checked:font-medium radix-state-checked:text-token-main-surface-primary"),children:n})}function eQ(e){let{threadId:t,evalRun:n,settings:a,onUpdateSettings:l}=e,{0:u,1:d}=(0,o.useState)("chat"),{refetch:m}=function(e){let{threadId:t,threadUserId:n}=e,r=ew({threadId:t,threadUserId:n}),s=r.data;return(0,o.useEffect)(()=>{if(t){var e;ey.P3.setThread(t,null!==(e=null==s?void 0:s.turns)&&void 0!==e?e:[])}},[t,s]),{refetch:r.refetch,isLoading:r.isLoading,isError:r.isError}}({threadId:t,threadUserId:void 0});(0,o.useEffect)(()=>{m()},[m,n.status]);let p=(0,k.jsx)(k.Fragment,{});switch(u){case"chat":p=(0,k.jsx)(c.e,{readyState:1,hasSubmittedInitialQuery:!0,searchQuery:"",followupQuery:"",onUpdateSearchQuery:i(),onUpdateFollowupQuery:i(),onSubmitFollowup:i(),onSubmitSearch:i(),settings:a,onUpdateSetting:l,onReset:i(),onRetryQuery:i()});break;case"details":p=(0,k.jsx)(eC,{evalRun:n});break;default:(0,r.Z)(u)}return(0,k.jsxs)("div",{className:"relative flex flex-col",children:[(0,k.jsx)("div",{className:"border-b p-2",children:(0,k.jsxs)(s.fC,{value:u,onValueChange:e=>d(e),className:"flex gap-1",children:[(0,k.jsx)(eV,{value:"chat",children:"Chat"}),(0,k.jsx)(eV,{value:"details",children:"Details"})]})}),p]})}},31863:function(e,t,n){"use strict";n.r(t),n.d(t,{FeedbackPage:function(){return _}});var r,s,a=n(99945),l=n(85452),i=n(70187),o=n(61236),c=n(2428),u=n.n(c),d=n(26169),m=n.n(d),p=n(91530),h=n.n(p),f=n(41409),g=n(70079),x=n(21389),v=n(57670),b=n(25617),j=n(20735),y=n(49593),w=n(19216),A=n(20963),O=n(45456),k=n(35250);function N(e){return m()(e)&&["link","message","turn"].includes(e)?e:"message"}function _(){(0,O.e)();let e=N((0,f.useRouter)().query.type);return"turn"===e?(0,k.jsx)(P,{}):"link"===e?(0,k.jsx)(S,{}):(0,k.jsx)("div",{children:"Unsupported feedback type"})}function S(){var e,t;let n=(0,w.nn)(w.LW.firstTurn),r=(0,f.useRouter)(),[s,a]=u()(r.query.ids)?r.query.ids:[],l=N(r.query.type),{data:i,isLoading:c}=(0,o.a)({queryKey:["searchLinkFeedback",s,a],queryFn:()=>(0,y.zq)(s,a),enabled:!!s&&!!a});return c||!i?(0,k.jsx)(D,{}):(0,k.jsx)(E,{type:l,threadId:i.search_link.thread_id,threadUserId:a,searchQuery:null!==(e=null==n?void 0:n.user_query)&&void 0!==e?e:"",rating:i.search_link_to_user.rating,tags:null!==(t=i.search_link_to_user.tags)&&void 0!==t?t:[],feedbackText:i.search_link_to_user.text,highlightUrl:i.search_link.url})}function P(){var e,t;let n=(0,w.nn)(w.LW.firstTurn),r=(0,f.useRouter)(),[s,a]=u()(r.query.ids)?r.query.ids:[],l=N(r.query.type),{data:i,isLoading:c}=(0,o.a)({queryKey:["searchTurnFeedback",s,a],queryFn:()=>(0,y.a2)(s,a),enabled:!!s&&!!a});return c||!i?(0,k.jsx)(D,{}):(0,k.jsx)(E,{type:l,threadId:i.search_turn.thread_id,threadUserId:a,searchQuery:null!==(e=null==n?void 0:n.user_query)&&void 0!==e?e:"",highlightTurnIndex:i.search_turn.turn_index,rating:null==i?void 0:i.search_turn_to_user.rating,tags:null!==(t=null==i?void 0:i.search_turn_to_user.tags)&&void 0!==t?t:[],feedbackText:null==i?void 0:i.search_turn_to_user.text})}function E(e){let{type:t,threadId:n,threadUserId:r,searchQuery:s,highlightTurnIndex:a,highlightUrl:l,rating:o,tags:c,feedbackText:u}=e,{setThreadUserId:d}=(0,b.R)();(0,g.useEffect)(()=>{d(r)},[d,r]);let{refetch:m,isLoading:p}=(0,A.v)({threadId:n,threadUserId:r});(0,g.useEffect)(()=>{m()},[m,n,r]);let f="thumbsUp"===o?i.go:i.W2;return(0,k.jsxs)("div",{className:"flex h-screen w-screen flex-col p-5",children:[p&&(0,k.jsx)(D,{}),(0,k.jsxs)("div",{className:"flex gap-4",children:[(0,k.jsx)(C,{className:"flex flex-col gap-2",children:(0,k.jsxs)("div",{className:"flex items-center gap-2 font-medium",children:["link"===t?"\uD83D\uDD17 Link Feedback":"\uD83D\uDD0D Message Feedback",":",(0,k.jsx)(f,{className:"h-5 w-5"})]})}),(0,k.jsxs)(C,{children:[(0,k.jsx)("span",{className:"font-medium",children:"Query:"})," ",s]}),(0,k.jsxs)(C,{className:"flex flex-col gap-2",children:[(0,k.jsxs)("div",{children:[(0,k.jsx)("span",{className:"font-medium",children:"Feedback:"})," ",u]}),(0,k.jsx)("div",{className:"flex gap-1",children:c.map(e=>(0,k.jsx)(R,{children:e},e))})]})]}),(0,k.jsx)("div",{className:"mt-4 h-full w-full flex-grow overflow-auto",children:(0,k.jsx)(v.e,{readyState:1,hasSubmittedInitialQuery:!0,searchQuery:s,followupQuery:"",onUpdateSearchQuery:h(),onUpdateFollowupQuery:h(),onSubmitFollowup:h(),onSubmitSearch:h(),settings:j.Z,onUpdateSetting:h(),onReset:h(),onRetryQuery:h(),highlightTurnIndex:a,highlightUrl:l})})]})}let C=x.Z.div(r||(r=(0,a.Z)(["rounded-md border border-token-border-medium p-3 flex-1"])));function D(){return(0,k.jsx)("div",{className:"mt-3 flex justify-center",children:(0,k.jsx)(l.Z,{})})}let R=x.Z.div(s||(s=(0,a.Z)(["rounded-md border bg-token-main-surface-tertiary px-1 text-xs text-token-text-primary"])))},83216:function(e,t,n){"use strict";n.d(t,{M:function(){return a},Y:function(){return l}});var r,s=n(38801);let a=((r={}).searchTurnFeedbackButtonShown="Search Turn Feedback Button Shown",r.searchTurnFeedbackSubmitted="Search Turn Feedback Submitted",r.searchLinkFeedbackSubmitted="Search Link Feedback Submitted",r.searchLinkShown="Search Link Shown",r.searchLinkClicked="Search Link Clicked",r.searchQuerySubmitted="Search Query Submitted",r.searchFollowupSubmitted="Search Followup Submitted",r.searchCitationHovered="Search Citation Hovered",r.searchCitationClicked="Search Citation Clicked",r),l={logEvent(e,t){s.A.logEvent(e,t)}}},49593:function(e,t,n){"use strict";n.d(t,{LC:function(){return v},NK:function(){return x},Nv:function(){return p},a2:function(){return f},dN:function(){return d},gK:function(){return u},k4:function(){return h},lw:function(){return m},mO:function(){return c},zq:function(){return g}});var r=n(18450),s=n(4466),a=n(5224),l=n(20724);function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let c=async e=>{let{queryKey:t}=e,[n,r]=t;if(r.length<2)return[];let l=new URLSearchParams({query_fragment:r});return s.c.get("".concat(a.rq,"/suggestions?").concat(l.toString())).then(e=>e.suggestions).catch(()=>[])};async function u(){return(await s.c.post("".concat(a.rq,"/threads"),{})).thread.id}async function d(e){let{threadId:t,query:n,agentSettingsOverrides:r,metadata:l}=e,i=m(r);return s.c.post("".concat(a.rq,"/threads/").concat(t,"/turns?blocking=false"),o(o({},i),{},{turn:o(o({},i.turn),{},{user_query:n}),user_metadata:l}))}function m(e){let t={};return e.rerank_labrador&&("none"===e.rerank_labrador?t.rerank_labrador=null:t.rerank_labrador=e.rerank_labrador),e.rerank_bing_boost&&(t.rerank_bing_boost=e.rerank_bing_boost),e.rerank_quality_threshold&&(t.rerank_quality_threshold=e.rerank_quality_threshold),{turn:{search_results:{settings__:{labrador_rerank_settings:t,external_search_engine:e.search_engine,robots_mode:e.robots_mode}},image_search_results:{settings__:{robots_mode:e.robots_mode}},model_response:{settings__:{enable_multimodal:e.show_image_to_model}}},base_config:function(e){switch(e){case"gpt-3.5":return"sahara";case"gpt-4":return"gpt4"}throw Error("Unknown model family: ".concat(e))}(e.model_family||l.tQ.GPT_3_5)}}async function p(e){let{threadId:t,threadUserId:n,isEval:r=!1}=e,l=new URL("".concat(a.rq,"/admin/threads/").concat(t,"/with_turns"));return n&&l.searchParams.append("thread_user_id",n),!0===r&&l.searchParams.append("is_eval","true"),await s.c.get(l.toString())}async function h(e){let t=new FormData;return t.append("feedback",JSON.stringify({thread_id:e.threadId,turn_index:e.turnIndex,rating:e.rating,search_query:e.searchQuery,text:e.text,tags:e.tags,user_email:e.userEmail})),e.screenshot&&t.append("file",new File([e.screenshot],"screenshot.jpeg",{type:"image/jpeg"})),s.c.post("".concat(a.rq,"/feedback/turns"),t)}async function f(e,t){return s.c.get("".concat(a.rq,"/feedback/turns/").concat(e,"/").concat(t))}async function g(e,t){return s.c.get("".concat(a.rq,"/feedback/links/").concat(e,"/").concat(t))}async function x(e){let t=new FormData;return e.screenshot&&t.append("file",new File([e.screenshot],"screenshot.jpeg",{type:"image/jpeg"})),t.append("feedback",JSON.stringify({thread_id:e.threadId,url:e.url,title:e.title,snippet:e.snippet,rating:e.rating,search_query:e.searchQuery,text:e.text,tags:e.tags,user_email:e.userEmail})),s.c.post("".concat(a.rq,"/feedback/links"),t)}function v(e){s.c.post("".concat(a.rq,"/pre_search"),{query_fragment:e.query,metadata:e.metadata,type:"text"})}},68399:function(e,t,n){"use strict";n.d(t,{W6:function(){return i},bM:function(){return o},vm:function(){return c}});var r=n(18450),s=n(78103);function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}let l={isSettingsModalOpen:!1,isDebugModalOpen:!1},i=(0,s.ZP)()(()=>(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e})({},l)),o={isSettingsModalOpen:e=>e.isSettingsModalOpen,isDebugModalOpen:e=>e.isDebugModalOpen},c={toggleSettingsModalOpen(){i.setState(e=>({isSettingsModalOpen:!e.isSettingsModalOpen}))},toggleDebugModalOpen(){i.setState(e=>({isDebugModalOpen:!e.isDebugModalOpen}))}}},19216:function(e,t,n){"use strict";n.d(t,{LW:function(){return d},P3:function(){return m},nn:function(){return u}});var r=n(18450),s=n(51362),a=n(66315),l=n(78103);function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach(function(t){(0,r.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let c={thread:null},u=(0,l.ZP)((0,s.n)(()=>o({},c))),d={threadId:e=>{var t,n;return null!==(t=null===(n=e.thread)||void 0===n?void 0:n.id)&&void 0!==t?t:null},turns:e=>{var t,n;return null!==(t=null===(n=e.thread)||void 0===n?void 0:n.turns)&&void 0!==t?t:[]},firstTurn:e=>null!=e.thread?e.thread.turns[0]:void 0,lastTurn:e=>null!=e.thread?e.thread.turns[e.thread.turns.length-1]:void 0},m={newThread(e){u.setState(t=>{t.thread={id:e,turns:[]}})},appendTurn(e,t){u.setState(n=>{let r=n.thread;if(!r){a.U.addError("got appendTurn with no current thread");return}if(r.id!==e){a.U.addError("got appendTurn for wrong thread",{threadId:e,newThreadId:r.id});return}r.turns.push(t)})},updateTurn(e,t){u.setState(n=>{let r=n.thread;if(!r){a.U.addError("got updateTurn with no current thread");return}let s=r.turns[e];if(!s){a.U.addError("turn not found",{turnIndex:e,turns:r.turns});return}t(s)})},clearThread(){u.setState(()=>o({},c))},setThread(e,t){u.setState(n=>{n.thread={id:e,turns:t}})}}},20724:function(e,t,n){"use strict";var r,s,a;n.d(t,{K1:function(){return o},lv:function(){return i},mX:function(){return c},tQ:function(){return l}});let l=((r={}).GPT_3_5="gpt-3.5",r.GPT_4="gpt-4",r),i=((s={}).Bing="bing",s.Sydney="sydney",s.Fortis="fortis",s),o=((a={}).Conservative="conservative",a.Aggressive="aggressive",a);function c(e){return"object"==typeof e&&(!e.rerank_labrador||"string"==typeof e.rerank_labrador)}},72150:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});var r=n(70079);function s(e,t,n){let{0:s,1:a}=(0,r.useState)(()=>{try{let t=JSON.parse(window.localStorage.getItem(e)||"");if(!n(t))throw Error("Invalid data");return t}catch(e){return t}});return(0,r.useEffect)(()=>{window.localStorage.setItem(e,JSON.stringify(s))},[e,s]),[s,a]}},20963:function(e,t,n){"use strict";n.d(t,{Y:function(){return i},v:function(){return o}});var r=n(61236),s=n(70079),a=n(49593),l=n(19216);function i(e){let{threadId:t,threadUserId:n,refetchOnMount:s}=e;return(0,r.a)({queryKey:["thread",t,n],queryFn:async()=>{if(!t)return{thread:null,turns:null};let e=await (0,a.Nv)({threadId:t,threadUserId:n}),r=e.turns;return{thread:e,turns:r}},enabled:!!t,refetchOnMount:s})}function o(e){let{threadId:t,threadUserId:n}=e,r=i({threadId:t,threadUserId:n}),a=r.data;return(0,s.useEffect)(()=>{if(t){var e;l.P3.setThread(t,null!==(e=null==a?void 0:a.turns)&&void 0!==e?e:[])}},[t,a]),{refetch:r.refetch,isLoading:r.isLoading,isError:r.isError}}},34796:function(e,t,n){"use strict";n.d(t,{r:function(){return a}});var r=n(20735),s=n(72150);function a(){return(0,s.Z)("SONIC_SETTINGS_20240404",r.Z,r.Wt)}},45456:function(e,t,n){"use strict";function r(){var e;null===(e=document.querySelector("html"))||void 0===e||e.classList.add("snc")}n.d(t,{e:function(){return r}})},90240:function(e,t,n){"use strict";n.d(t,{PX:function(){return s},XB:function(){return a}});var r=n(43041);let s={latitude:null,longitude:null,locationAccuracy:null};function a(e){if(!e){l();return}navigator.geolocation.getCurrentPosition(e=>{r.bX.setCookie(r.cn.LastLocation,JSON.stringify({latitude:e.coords.latitude,longitude:e.coords.longitude,locationAccuracy:e.coords.accuracy}),{maxAge:2592e3})},()=>{l()})}function l(){r.bX.setCookie(r.cn.LastLocation,JSON.stringify(s),{maxAge:2592e3})}},78375:function(e,t,n){"use strict";n.d(t,{F:function(){return a},K:function(){return s}});var r=n(72541);function s(e){var t,n,r,s,a,l,i;if(null!==(t=e.finance_widget)&&void 0!==t&&t.price)return{type:"finance",status:e.finance_widget.status,data:e.finance_widget};if(null!==(n=e.weather_widget)&&void 0!==n&&n.forecast_response)return{type:"weather",status:e.weather_widget.status,data:e.weather_widget.forecast_response};if(null!==(r=e.calculator_widget)&&void 0!==r&&r.expression)return{type:"calculator",status:"done",data:{expression:e.calculator_widget.expression,status:e.calculator_widget.status,result:e.calculator_widget.result}};if(null!==(s=e.sports_widget)&&void 0!==s&&s.standings)return{type:"sports-standings",status:e.sports_widget.status,data:e.sports_widget.standings,displayOptions:{hideDivider:!0}};if(null!==(a=e.sports_widget)&&void 0!==a&&a.schedule&&e.sports_widget.schedule.games.length>0)return{type:"sports-schedule",status:e.sports_widget.status,data:e.sports_widget.schedule,displayOptions:{hideDivider:!0}};if(null!==(l=e.timezone_widget)&&void 0!==l&&l.time_at)return{type:"time-difference",status:e.timezone_widget.status,data:e.timezone_widget.time_at};if(null!==(i=e.news_widget)&&void 0!==i&&i.articles)return{type:"news",status:e.news_widget.status,data:e.news_widget};return null}function a(e,t){if(!e)return null;let n=[];return(e.name&&n.push(e.name),e.state&&e.name!==e.state&&n.push(e.state),!e.name&&e.country&&e.country===e.name&&n.push(e.country),n.length>0)?n.join(", "):t&&e.timezone&&"string"==typeof e.timezone?(0,r.Z)(t,"zzz",{timeZone:e.timezone}):null}},63667:function(e,t,n){"use strict";let r;n.r(t),n.d(t,{DO_NOT_IMPORT_VoiceModeButton:function(){return W},DO_NOT_IMPORT_VoiceModeLayout:function(){return ey}});var s,a,l,i,o=n(85452),c=n(86263),u=n(89899),d=n(95407),m=n(52392),p=n(63605),h=n(34594),f=n(19841),g=n(70079),x=n(9063);let v=((s={}).StateUpdate="state_update",s.ActionRequest="action_request",s.ConversationUpdate="conversation_update",s.RelayMessage="relay_message",s.Unknown="unknown",s),b=((a={}).StartListeningIntently="start_listening",a.StopListeningIntently="stop_listening",a.HaltAllActivity="stop_speaking",a.ResumeListening="resume_listening",a.RelayMessage="relay_message",a),j=((l={}).Idle="idle",l.Connected="connected",l.Halted="halted",l.Listening="listening",l.ListeningIntently="listening_intently",l.Thinking="thinking",l.Speaking="speaking",l);var y=n(18450),w=n(61107),A=n(4466);class O{static async getVoiceToken(e){return A.c.post("".concat("https://chat.openai.com/voice","/get_token"),e)}}var k=n(78103),N=n(25229),_=n(51362);class S{log(e){}debug(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];this.log("debug",...t)}error(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];this.log("error",...t)}}let P=new S;function E(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function C(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?E(Object(n),!0).forEach(function(t){(0,y.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):E(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let D={conversationId:null,isActivityHalted:!1,isStarting:!1,dev:{room:null},credentials:{token:null,url:null,e2eeKey:null},server:{actions:null,connectionState:null,remoteState:null,messages:[]}},R=(0,k.ZP)((0,N.XR)((0,_.n)(()=>D)));function M(){return R(e=>!!(e.credentials.token&&e.credentials.url&&e.credentials.e2eeKey&&e.server.remoteState))}function T(e){let{voiceName:t,voiceMainLanguage:n}=(0,w.SK)(),r=R(e=>e.isStarting),s=M(),a=(0,g.useCallback)(()=>{s&&Z(null)},[s]);return{startVoiceMode:(0,g.useCallback)(async r=>{if(!s){R.setState(e=>{e.isStarting=!0});try{let s=await O.getVoiceToken(C({voice:t,language_code:n},r));s&&s.token&&s.url&&s.e2ee_key&&Z({conversationId:e,credentials:C(C({},s),{},{e2eeKey:s.e2ee_key})})}catch(e){throw P.debug("failed to get voice token",e),R.setState(e=>{e.isStarting=!1}),e}}},[s,t,n,e]),stopVoiceMode:a,isVoiceModeStarting:r,isVoiceModeActive:s}}function Z(e){if(e){let{credentials:t,conversationId:n}=e;P.debug("setting credentials",e),R.setState(e=>{e.conversationId=n,e.credentials=t});return}P.debug("clearing credentials"),L()}function L(){R.setState(D)}var I=n(67431),F=n(98431);function U(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function z(){let e=(0,F.fZ)(),t=(0,g.useRef)({debug:function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return P.debug("[".concat(e.name,"]"),...n)},encoder:new TextEncoder,decoder:new TextDecoder}).current;return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?U(Object(n),!0).forEach(function(t){(0,y.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):U(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({room:e},t)}function q(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function V(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?q(Object(n),!0).forEach(function(t){(0,y.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):q(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var Q=n(13106);function B(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function G(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?B(Object(n),!0).forEach(function(t){(0,y.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):B(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let H=(0,g.memo)(function(){return!function(){let{room:e,debug:t,decoder:n}=z(),r=function(){let{debug:e}=z(),t=R(e=>e.conversationId);return(0,g.useCallback)(async()=>{if(t){e("refetch conversationId ".concat(t));try{await (0,p.Um)(t,!0)}catch(n){let t="failed to update conversation";e(t,n),d.m.danger(t)}}},[t,e])}();(0,g.useEffect)(()=>{let s=async n=>{let{new_state:r}=n,s=[j.Listening,j.ListeningIntently];t("new state",r),s.includes(r)?(t("unmuting microphone"),await e.localParticipant.setMicrophoneEnabled(!0)):(t("muting microphone"),await e.localParticipant.setMicrophoneEnabled(!1)),R.setState(e=>{e.server.remoteState=r})},a=async a=>{let l;try{l=JSON.parse(n.decode(a)),t("data recevied",l)}catch(e){t("error parsing data",e);return}switch(R.setState(e=>(e.server.messages.push(V(V({},l),{},{timestamp:new Date,source:"remote"})),e)),l.type){case v.StateUpdate:t("state update",l.payload);let{new_state:i,delay_s:o}=l.payload;i===j.Thinking&&o&&(t("".concat(e.name," delay thinking state by ").concat(o," seconds")),s({new_state:j.ListeningIntently,delay_s:o}),await new Promise(e=>setTimeout(e,1e3*o))),s(l.payload);break;case v.ConversationUpdate:t("conversation update",l.payload),await r()}},l=(e,n)=>{t("track published",e,n)},i=()=>{t("disconnected"),L()};return e.on(I.TQ.DataReceived,a),e.on(I.TQ.TrackPublished,l),e.on(I.TQ.Disconnected,i),()=>{e.off(I.TQ.DataReceived,a),e.off(I.TQ.TrackPublished,l),e.off(I.TQ.Disconnected,i)}},[!1,e,r,t,n])}(),function(){let{room:e}=z();(0,g.useEffect)(()=>{R.setState(t=>{t.dev.room=e})},[e])}(),function(){let{room:e}=z(),t=(0,F.z1)(e);(0,g.useEffect)(()=>{R.setState(e=>{e.server.connectionState=t})},[t])}(),function(){let{room:e,debug:t,encoder:n}=z();(0,g.useEffect)(()=>{let r=!!R.getState().server.actions;if(e&&!r){let r=async r=>{t("publishing action",r);let s={type:v.ActionRequest,payload:{action:r}};await e.localParticipant.publishData(n.encode(JSON.stringify(s)),{reliable:!0}),R.setState(e=>{e.server.messages.push(G(G({},s),{},{timestamp:new Date,source:"local"}))})};R.setState(e=>{e.server.actions={[b.StartListeningIntently]:()=>r(b.StartListeningIntently),[b.StopListeningIntently]:()=>r(b.StopListeningIntently),[b.HaltAllActivity]:()=>r(b.HaltAllActivity),[b.ResumeListening]:()=>r(b.ResumeListening),[b.RelayMessage]:()=>r(b.RelayMessage)}})}},[e,t,n])}(),function(){let e=M();(0,g.useEffect)(()=>(Q.tN.setState({isVoiceActive:e}),()=>{Q.tN.setState({isVoiceActive:!1})}),[e])}(),!function(){let{room:e,debug:t}=z(),n=e.getActiveDevice("audioinput"),r=e.getActiveDevice("audiooutput");(0,g.useEffect)(()=>{t("devices: input ".concat(n,", output ").concat(r)),async function(){let s=async()=>{"default"!==n&&(t("switching audio input to default"),await e.switchActiveDevice("audioinput","default"))},a=async()=>{"default"!==r&&(t("switching audio output to default"),await e.switchActiveDevice("audiooutput","default"))};await Promise.all([s(),a()])}()},[n,r,t,e]),(0,g.useEffect)(()=>{async function n(){t("audio devices changed"),Promise.all(["audioinput","audiooutput"].map(async n=>{let r=await I.du.getLocalDevices(n),s=e.getActiveDevice(n);if(!r.find(e=>e.deviceId===s)){let s=r.find(e=>"default"===e.deviceId),a=null;s?a=s.deviceId:r[0]&&(a=r[0].deviceId),t("switching ".concat(n," to ").concat(a)),a&&await e.switchActiveDevice(n,a)}}))}if(navigator)return navigator.mediaDevices.addEventListener("devicechange",n),()=>{navigator.mediaDevices.removeEventListener("devicechange",n)}},[e,t])}(),null});var K=n(35250);function W(e){var t,n;let{iconClassName:r="icon-sm",className:s,conversationId:a}=e,l=null===(t=(0,h.sB)(h.tz.VoiceMode))||void 0===t?void 0:t.value,i=(0,p.XK)(a),o=(0,m.Bv)(a),c=null===(n=p.iN.getCurrentNode(a))||void 0===n?void 0:n.id;return i&&l&&o?(0,K.jsx)(X,{conversationId:i,className:s,iconClassName:r,modelId:o,parentMessageId:c}):null}let X=(0,g.memo)(function(e){let{conversationId:t,className:n,iconClassName:r,modelId:s,parentMessageId:a}=e,{isVoiceModeActive:l,isVoiceModeStarting:i,toggleVoiceMode:m}=function(e,t,n){let r=(0,x.Z)(),{startVoiceMode:s,isVoiceModeStarting:a,isVoiceModeActive:l}=T(e);return{isVoiceModeActive:l,isVoiceModeStarting:a,toggleVoiceMode:(0,g.useCallback)(async()=>{try{await s({conversation_id:e,parent_message_id:n,model_slug:t})}catch(e){d.m.danger(r.formatMessage({id:"useVoiceModeButtonAction.error",defaultMessage:"Failed to start voice mode"}))}},[s,e,n,t,r])}}(t,s,a);return l?null:(0,K.jsx)(u.y4,{disabled:i,onClick:m,className:(0,f.default)("w-fit",n),children:i?(0,K.jsx)(o.Z,{className:r}):(0,K.jsx)(c.VWR,{className:r})})});var Y=n(92386),J=n(24343),$=n(83737),ee=n(29287);function et(){return(0,K.jsxs)("div",{className:"flex flex-row items-center gap-2",children:[(0,K.jsx)(c.uAs,{className:"icon-sm"}),(0,K.jsx)(en,{})]})}function en(){let e;let t=R(e=>e.server.remoteState);if(!t)return null;switch(t){case j.Listening:case j.ListeningIntently:e="Listening";break;case j.Thinking:e="Thinking";break;case j.Speaking:e="Speaking";break;default:e=null}return e?(0,K.jsx)("div",{className:"mr-2",children:e}):null}function er(e){let{conversationId:t}=e,n=(0,p.XK)(t);return n?(0,K.jsxs)("div",{className:"flex flex-row items-center gap-3",children:[(0,K.jsx)(et,{}),(0,K.jsx)(ea,{}),(0,K.jsx)(es,{conversationId:n})]}):null}function es(e){let{conversationId:t}=e,{stopVoiceMode:n}=T(t);return(0,K.jsx)(el,{color:"none",onClick:n,className:"overflow-hidden rounded-full border-none p-0 text-token-text-primary",children:(0,K.jsx)(c.niP,{className:"icon-2xl"})})}function ea(){let{isActivityHalted:e,toggleVoiceActivity:t}=function(){let e=R(e=>e.isActivityHalted),t=R(e=>e.server.actions);return{toggleVoiceActivity:(0,g.useCallback)(()=>{R.getState().isActivityHalted?(null==t||t[b.ResumeListening](),R.setState(e=>{e.isActivityHalted=!1})):(null==t||t[b.HaltAllActivity](),R.setState(e=>{e.isActivityHalted=!0}))},[t]),isActivityHalted:e}}(),n=null;return n=e?c.o1U:c.STQ,(0,K.jsx)(el,{color:"none",className:"overflow-hidden rounded-full border-none p-0 text-token-text-primary",onClick:t,children:(0,K.jsx)(n,{className:"icon-2xl"})})}let el=(0,$.E)(ee.z);var ei=n(99503),eo=n(56115);function ec(){let e=R(e=>e.server.messages);return(0,K.jsx)($.E.div,{className:"hidden h-full max-w-[400px] overflow-hidden border-l border-l-token-sidebar-surface-secondary bg-token-main-surface-secondary pt-16 shadow-inner md:block",initial:{opacity:0,x:420,width:"0px"},animate:{opacity:1,x:0,width:"400px"},exit:{opacity:0,x:420,width:"0px"},transition:{type:"tween"},children:(0,K.jsx)(J.M,{children:e.length?(0,K.jsxs)($.E.div,{className:"flex h-full w-full flex-col",initial:{opacity:0,x:-100},animate:{opacity:1,x:0},exit:{opacity:0,x:-100},children:[(0,K.jsxs)("div",{children:[(0,K.jsx)("h3",{className:"p-4 py-2 text-lg font-semibold text-token-text-secondary",children:"Room Stats"}),(0,K.jsx)(eu,{})]}),(0,K.jsx)("h3",{className:"p-4 py-2 text-lg font-semibold text-token-text-secondary",children:"Messages"}),(0,K.jsx)("div",{className:"grow overflow-hidden",children:(0,K.jsx)(Y.I,{children:(0,K.jsx)($.E.ul,{className:"pointer-events-none flex w-full flex-col gap-4 pb-24 pt-4",initial:"initial",animate:"animate",exit:"exit",variants:ex,transition:{delayChildren:.25,staggerChildren:.05},children:e.map((e,t)=>(0,K.jsx)(eg,{index:t,message:e},t))})})})]}):null})})}function eu(){let e=R(e=>e.dev.room);if(!e)return null;let t=e.numParticipants,n=e.activeSpeakers;return(0,K.jsx)("div",{className:"px-4 pb-8",children:(0,K.jsxs)("div",{className:"flex flex-col flex-nowrap gap-2",children:[(0,K.jsx)(ed,{}),(0,K.jsx)(eh,{text:"Attendees"}),(0,K.jsx)(ef,{name:"Participants",text:t}),(0,K.jsx)(ef,{name:"Speakers",text:n.length}),(0,K.jsx)(em,{})]})})}function ed(){let e=R(e=>e.server.connectionState),t=R(e=>e.dev.room),{0:n,1:r}=(0,g.useState)("Unknown"),s=null==t?void 0:t.localParticipant;return(0,g.useEffect)(()=>{if(s){let e=e=>{r(e)};return s.on("connectionQualityChanged",e),()=>{s.off("connectionQualityChanged",e)}}},[s]),(0,K.jsxs)(K.Fragment,{children:[(0,K.jsx)(eh,{text:"Connection"}),(0,K.jsx)(ef,{name:"Quality",text:String(n)}),(0,K.jsx)(ef,{name:"State",text:String(e)})]})}function em(){let e=R(e=>e.dev.room),{0:t,1:n}=(0,g.useState)(null),{0:r,1:s}=(0,g.useState)(null),a=null==e?void 0:e.getActiveDevice("audioinput"),l=null==e?void 0:e.getActiveDevice("audiooutput");return(0,g.useEffect)(()=>{(async function(){var e,t;let r=await I.du.getLocalDevices("audioinput"),i=await I.du.getLocalDevices("audiooutput"),o=r.find(e=>e.deviceId===a),c=i.find(e=>e.deviceId===l);n(null!==(e=null==o?void 0:o.label)&&void 0!==e?e:"Unknown"),s(null!==(t=null==c?void 0:c.label)&&void 0!==t?t:"Unknown")})()},[a,l]),(0,K.jsxs)(K.Fragment,{children:[(0,K.jsx)(eh,{text:"Devices"}),(0,K.jsx)(ef,{icon:c.ZO8,name:"Input",text:null!=t?t:"Unknown"}),(0,K.jsx)(ef,{icon:c.VWR,name:"Output",text:null!=r?r:"Unknown"}),(0,K.jsx)(eh,{text:"Monitors"}),(0,K.jsx)(ef,{name:"Mic level",icon:ei.Z,text:"unknown",content:(0,K.jsx)(ep,{})})]})}function ep(){let e=R(e=>{var t;return null===(t=e.dev.room)||void 0===t?void 0:t.localParticipant.audioLevel});return(0,K.jsx)("div",{className:"flex flex-row flex-nowrap items-center gap-1",children:(0,K.jsx)("div",{className:"flex flex-row flex-nowrap items-center gap-1",children:Array.from({length:10}).map((t,n)=>(0,K.jsx)("div",{className:"h-2 w-2 rounded-full ".concat((null!=e?e:0)>.1*n?"bg-gray-500":"bg-token-main-surface-tertiary")},n))})})}function eh(e){let{text:t}=e;return(0,K.jsx)("h4",{className:"text-md font-semibold",children:t})}function ef(e){var t;return(0,K.jsxs)("div",{className:"flex flex-row flex-nowrap items-center gap-2",children:[(0,K.jsx)("span",{className:"opacity-85",children:e.icon?(0,K.jsx)(e.icon,{className:"h-[0.75rem] w-[0.75rem]"}):"".concat(e.name,":")}),null!==(t=e.content)&&void 0!==t?t:(0,K.jsx)("span",{className:"line-clamp-1 rounded-lg bg-token-main-surface-tertiary p-0.5 px-1 font-mono text-xs",children:e.text})]})}function eg(e){let{index:t,message:n}=e,{0:r,1:s}=(0,g.useState)(!1),a=null;switch(n.source){case"remote":a=c.veu;break;case"local":a=c.Hf3}return(0,K.jsx)($.E.div,{className:"w-full border-t border-token-main-surface-tertiary p-4",variants:ex,children:(0,K.jsxs)("div",{className:"flex w-full flex-col gap-2 rounded-lg bg-token-main-surface-secondary",children:[(0,K.jsxs)("div",{className:"font-mono text-[0.65rem] font-semibold text-token-text-secondary",children:[(0,K.jsxs)("div",{className:"flex w-full flex-row flex-nowrap items-center justify-between",children:[(0,K.jsxs)("div",{className:"flex flex-row flex-nowrap items-center gap-1",children:[(0,K.jsx)(a,{className:"h-3 w-3 text-token-text-secondary"}),(0,K.jsx)("span",{children:" | ".concat(t+1," | ").concat((0,eo.Z)(n.timestamp,"H:m:s:SS"))})]}),(0,K.jsx)("div",{className:"flex flex-row flex-nowrap items-center gap-2",children:(0,K.jsx)(ee.z,{className:"rounded-full p-0.5",color:"none",size:"xsmall",onClick:()=>s(e=>!e),children:(0,K.jsx)(c.eOB,{className:"transform transition-transform ".concat(r?"rotate-180":"")})})})]}),(0,K.jsx)("div",{className:"mt-1 text-xs font-bold",children:n.type})]}),(0,K.jsx)(J.M,{children:r?(0,K.jsx)($.E.pre,{initial:{opacity:0,transform:"blur(4px)"},animate:{opacity:1,transform:"blur(0px)"},exit:{opacity:0,transform:"blur(4px)"},className:"overflow-x-auto rounded-md bg-token-main-surface-tertiary p-2 text-xs text-token-text-secondary",children:JSON.stringify(n.payload,null,2)}):null})]})})}let ex={hidden:{opacity:0,x:100},animate:{opacity:1,x:0},exit:{opacity:0,x:100}};function ev(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function eb(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ev(Object(n),!0).forEach(function(t){(0,y.Z)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ev(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}i=Worker,r=class extends i{constructor(e,t){let n=String(e);super(n.includes("://")&&!n.startsWith(location.origin)?URL.createObjectURL(new Blob(["importScripts=((i)=>(...a)=>i(...a.map((u)=>''+new URL(u,\"".concat(n,'"))))(importScripts);importScripts("').concat(n,'")')],{type:"text/javascript"})):e,t)}};let ej=(0,g.memo)(function(){let e=(0,g.useRef)({keyProvider:new I.P6}).current,{0:t,1:s}=(0,g.useState)(!1),{token:a,url:l,e2eeKey:i}=R(e=>e.credentials),o=function(){let e=(0,g.useCallback)(()=>{P.debug("connected to room");let e=R.subscribe(e=>!!e.server.remoteState,t=>{t&&(R.setState(e=>{e.isStarting=!1}),e())})},[]);return{onConnected:e,onDisconnected:(0,g.useCallback)(()=>{P.debug("disconnected from room"),L()},[]),onError:(0,g.useCallback)(e=>{d.m.danger("Something went wrong"),P.error("an error occured within the room",e),L()},[]),onEncryptionError:(0,g.useCallback)(e=>{d.m.danger("Something went wrong"),P.error("an encryption error occured within the room",e),L()},[])}}();return((0,g.useEffect)(()=>{let n=a&&l&&i;!t&&n?e.keyProvider.setKey(i).then(()=>{s(!0)}):t&&!n&&s(!1)},[a,l,i,t,e]),t&&a&&l)?(0,K.jsxs)(F.IC,eb(eb({},o),{},{connect:!0,token:a,serverUrl:l,audio:{deviceId:{ideal:"default",exact:"default"},noiseSuppression:!0,echoCancellation:!0},options:{e2ee:{keyProvider:e.keyProvider,worker:new r(n.tu(new URL(n.p+n.u(1087),n.b)))}},children:[(0,K.jsx)(H,{}),(0,K.jsx)(F.Z5,{})]})):null});function ey(e){let{conversationId:t,renderTurns:n}=e,{0:r,1:s}=(0,g.useState)(!1),a=M();return(0,K.jsxs)(K.Fragment,{children:[(0,K.jsx)(J.M,{children:a?(0,K.jsx)($.E.div,{className:"fixed left-0 top-0 z-50 flex h-full w-full flex-col bg-token-main-surface-primary",initial:"hidden",animate:"visible",exit:"hidden",variants:ew,children:(0,K.jsxs)($.E.div,{className:"relative h-full w-full",variants:ew,children:[(0,K.jsxs)($.E.div,{variants:ew,className:"flex h-full w-full flex-nowrap gap-2",children:[(0,K.jsx)("div",{className:"flex h-full w-full flex-col",children:(0,K.jsx)(Y.I,{children:(0,K.jsx)("div",{className:"pointer-events-none pb-24 pt-9",children:n()})})}),(0,K.jsx)(J.M,{children:r?(0,K.jsx)(ec,{}):null})]}),(0,K.jsx)($.E.div,{className:"absolute left-0 top-0 flex w-full justify-end p-4",variants:ew,children:(0,K.jsx)(er,{conversationId:t})}),(0,K.jsx)($.E.div,{className:"absolute bottom-0 right-0 flex w-full justify-end p-4",variants:ew,children:(0,K.jsx)(u.y4,{onClick:()=>s(e=>!e),children:(0,K.jsx)(c.FxN,{})})})]})}):null}),(0,K.jsx)(ej,{})]})}let ew={hidden:{opacity:0,transform:"blur(4px)"},visible:{transform:"blur(0px)",opacity:1}}},3107:function(e){e.exports={"jidori-editor":"ProseMirror_jidori-editor__qe4qb","generated-text":"ProseMirror_generated-text___vj5n","highlighted-edit":"ProseMirror_highlighted-edit__XlnRz",dark:"ProseMirror_dark__iBd2U","highlighted-delete":"ProseMirror_highlighted-delete__p_chl"}}}]);
//# sourceMappingURL=sso.6f28731a488dcab8.js.map